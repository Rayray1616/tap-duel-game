import{j as e}from"./index-M7FXpbwm.js";import{r as t,R as n}from"./index-d-HLcqzF.js";import{g as r,a as s}from"./_commonjsHelpers-Dvrxj_Zk.js";import{r as i}from"./index-B_Fx466Z.js";import{A as a,c as o,_ as l,a as c,b as u,d,T as h,e as p,h as f,i as g,f as m,P as y,g as v}from"./AppRoot-BC8Shg2Z.js";var w,b={exports:{}};var _,x=(w||(w=1,_=b,function(e,t){_.exports?_.exports=t():(e.nacl||(e.nacl={}),e.nacl.util=t())}(b.exports,function(){var e={};function t(e){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(e))throw new TypeError("invalid encoding")}return e.decodeUTF8=function(e){if("string"!=typeof e)throw new TypeError("expected string");var t,n=unescape(encodeURIComponent(e)),r=new Uint8Array(n.length);for(t=0;t<n.length;t++)r[t]=n.charCodeAt(t);return r},e.encodeUTF8=function(e){var t,n=[];for(t=0;t<e.length;t++)n.push(String.fromCharCode(e[t]));return decodeURIComponent(escape(n.join("")))},"undefined"==typeof atob?void 0!==Buffer.from?(e.encodeBase64=function(e){return Buffer.from(e).toString("base64")},e.decodeBase64=function(e){return t(e),new Uint8Array(Array.prototype.slice.call(Buffer.from(e,"base64"),0))}):(e.encodeBase64=function(e){return new Buffer(e).toString("base64")},e.decodeBase64=function(e){return t(e),new Uint8Array(Array.prototype.slice.call(new Buffer(e,"base64"),0))}):(e.encodeBase64=function(e){var t,n=[],r=e.length;for(t=0;t<r;t++)n.push(String.fromCharCode(e[t]));return btoa(n.join(""))},e.decodeBase64=function(e){t(e);var n,r=atob(e),s=new Uint8Array(r.length);for(n=0;n<r.length;n++)s[n]=r.charCodeAt(n);return s}),e})),b.exports);const S=r(x);function k(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var j={exports:{}};const E=s(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var T;var R=(T||(T=1,function(e){var t=function(e){var t,n=new Float64Array(16);if(e)for(t=0;t<e.length;t++)n[t]=e[t];return n},n=function(){throw new Error("no PRNG")},r=new Uint8Array(16),s=new Uint8Array(32);s[0]=9;var i=t(),a=t([1]),o=t([56129,1]),l=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),c=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),u=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),d=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),h=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function p(e,t,n,r){e[t]=n>>24&255,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n,e[t+4]=r>>24&255,e[t+5]=r>>16&255,e[t+6]=r>>8&255,e[t+7]=255&r}function f(e,t,n,r,s){var i,a=0;for(i=0;i<s;i++)a|=e[t+i]^n[r+i];return(1&a-1>>>8)-1}function g(e,t,n,r){return f(e,t,n,r,16)}function m(e,t,n,r){return f(e,t,n,r,32)}function y(e,t,n,r){!function(e,t,n,r){for(var s,i=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,o=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,l=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,c=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,u=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,h=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,p=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,g=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,m=255&n[16]|(255&n[17])<<8|(255&n[18])<<16|(255&n[19])<<24,y=255&n[20]|(255&n[21])<<8|(255&n[22])<<16|(255&n[23])<<24,v=255&n[24]|(255&n[25])<<8|(255&n[26])<<16|(255&n[27])<<24,w=255&n[28]|(255&n[29])<<8|(255&n[30])<<16|(255&n[31])<<24,b=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,_=i,x=a,S=o,k=l,j=c,E=u,T=d,R=h,C=p,O=f,I=g,N=m,A=y,P=v,U=w,$=b,L=0;L<20;L+=2)_^=(s=(A^=(s=(C^=(s=(j^=(s=_+A|0)<<7|s>>>25)+_|0)<<9|s>>>23)+j|0)<<13|s>>>19)+C|0)<<18|s>>>14,E^=(s=(x^=(s=(P^=(s=(O^=(s=E+x|0)<<7|s>>>25)+E|0)<<9|s>>>23)+O|0)<<13|s>>>19)+P|0)<<18|s>>>14,I^=(s=(T^=(s=(S^=(s=(U^=(s=I+T|0)<<7|s>>>25)+I|0)<<9|s>>>23)+U|0)<<13|s>>>19)+S|0)<<18|s>>>14,$^=(s=(N^=(s=(R^=(s=(k^=(s=$+N|0)<<7|s>>>25)+$|0)<<9|s>>>23)+k|0)<<13|s>>>19)+R|0)<<18|s>>>14,_^=(s=(k^=(s=(S^=(s=(x^=(s=_+k|0)<<7|s>>>25)+_|0)<<9|s>>>23)+x|0)<<13|s>>>19)+S|0)<<18|s>>>14,E^=(s=(j^=(s=(R^=(s=(T^=(s=E+j|0)<<7|s>>>25)+E|0)<<9|s>>>23)+T|0)<<13|s>>>19)+R|0)<<18|s>>>14,I^=(s=(O^=(s=(C^=(s=(N^=(s=I+O|0)<<7|s>>>25)+I|0)<<9|s>>>23)+N|0)<<13|s>>>19)+C|0)<<18|s>>>14,$^=(s=(U^=(s=(P^=(s=(A^=(s=$+U|0)<<7|s>>>25)+$|0)<<9|s>>>23)+A|0)<<13|s>>>19)+P|0)<<18|s>>>14;_=_+i|0,x=x+a|0,S=S+o|0,k=k+l|0,j=j+c|0,E=E+u|0,T=T+d|0,R=R+h|0,C=C+p|0,O=O+f|0,I=I+g|0,N=N+m|0,A=A+y|0,P=P+v|0,U=U+w|0,$=$+b|0,e[0]=_>>>0&255,e[1]=_>>>8&255,e[2]=_>>>16&255,e[3]=_>>>24&255,e[4]=x>>>0&255,e[5]=x>>>8&255,e[6]=x>>>16&255,e[7]=x>>>24&255,e[8]=S>>>0&255,e[9]=S>>>8&255,e[10]=S>>>16&255,e[11]=S>>>24&255,e[12]=k>>>0&255,e[13]=k>>>8&255,e[14]=k>>>16&255,e[15]=k>>>24&255,e[16]=j>>>0&255,e[17]=j>>>8&255,e[18]=j>>>16&255,e[19]=j>>>24&255,e[20]=E>>>0&255,e[21]=E>>>8&255,e[22]=E>>>16&255,e[23]=E>>>24&255,e[24]=T>>>0&255,e[25]=T>>>8&255,e[26]=T>>>16&255,e[27]=T>>>24&255,e[28]=R>>>0&255,e[29]=R>>>8&255,e[30]=R>>>16&255,e[31]=R>>>24&255,e[32]=C>>>0&255,e[33]=C>>>8&255,e[34]=C>>>16&255,e[35]=C>>>24&255,e[36]=O>>>0&255,e[37]=O>>>8&255,e[38]=O>>>16&255,e[39]=O>>>24&255,e[40]=I>>>0&255,e[41]=I>>>8&255,e[42]=I>>>16&255,e[43]=I>>>24&255,e[44]=N>>>0&255,e[45]=N>>>8&255,e[46]=N>>>16&255,e[47]=N>>>24&255,e[48]=A>>>0&255,e[49]=A>>>8&255,e[50]=A>>>16&255,e[51]=A>>>24&255,e[52]=P>>>0&255,e[53]=P>>>8&255,e[54]=P>>>16&255,e[55]=P>>>24&255,e[56]=U>>>0&255,e[57]=U>>>8&255,e[58]=U>>>16&255,e[59]=U>>>24&255,e[60]=$>>>0&255,e[61]=$>>>8&255,e[62]=$>>>16&255,e[63]=$>>>24&255}(e,t,n,r)}function v(e,t,n,r){!function(e,t,n,r){for(var s,i=255&r[0]|(255&r[1])<<8|(255&r[2])<<16|(255&r[3])<<24,a=255&n[0]|(255&n[1])<<8|(255&n[2])<<16|(255&n[3])<<24,o=255&n[4]|(255&n[5])<<8|(255&n[6])<<16|(255&n[7])<<24,l=255&n[8]|(255&n[9])<<8|(255&n[10])<<16|(255&n[11])<<24,c=255&n[12]|(255&n[13])<<8|(255&n[14])<<16|(255&n[15])<<24,u=255&r[4]|(255&r[5])<<8|(255&r[6])<<16|(255&r[7])<<24,d=255&t[0]|(255&t[1])<<8|(255&t[2])<<16|(255&t[3])<<24,h=255&t[4]|(255&t[5])<<8|(255&t[6])<<16|(255&t[7])<<24,p=255&t[8]|(255&t[9])<<8|(255&t[10])<<16|(255&t[11])<<24,f=255&t[12]|(255&t[13])<<8|(255&t[14])<<16|(255&t[15])<<24,g=255&r[8]|(255&r[9])<<8|(255&r[10])<<16|(255&r[11])<<24,m=255&n[16]|(255&n[17])<<8|(255&n[18])<<16|(255&n[19])<<24,y=255&n[20]|(255&n[21])<<8|(255&n[22])<<16|(255&n[23])<<24,v=255&n[24]|(255&n[25])<<8|(255&n[26])<<16|(255&n[27])<<24,w=255&n[28]|(255&n[29])<<8|(255&n[30])<<16|(255&n[31])<<24,b=255&r[12]|(255&r[13])<<8|(255&r[14])<<16|(255&r[15])<<24,_=0;_<20;_+=2)i^=(s=(y^=(s=(p^=(s=(c^=(s=i+y|0)<<7|s>>>25)+i|0)<<9|s>>>23)+c|0)<<13|s>>>19)+p|0)<<18|s>>>14,u^=(s=(a^=(s=(v^=(s=(f^=(s=u+a|0)<<7|s>>>25)+u|0)<<9|s>>>23)+f|0)<<13|s>>>19)+v|0)<<18|s>>>14,g^=(s=(d^=(s=(o^=(s=(w^=(s=g+d|0)<<7|s>>>25)+g|0)<<9|s>>>23)+w|0)<<13|s>>>19)+o|0)<<18|s>>>14,b^=(s=(m^=(s=(h^=(s=(l^=(s=b+m|0)<<7|s>>>25)+b|0)<<9|s>>>23)+l|0)<<13|s>>>19)+h|0)<<18|s>>>14,i^=(s=(l^=(s=(o^=(s=(a^=(s=i+l|0)<<7|s>>>25)+i|0)<<9|s>>>23)+a|0)<<13|s>>>19)+o|0)<<18|s>>>14,u^=(s=(c^=(s=(h^=(s=(d^=(s=u+c|0)<<7|s>>>25)+u|0)<<9|s>>>23)+d|0)<<13|s>>>19)+h|0)<<18|s>>>14,g^=(s=(f^=(s=(p^=(s=(m^=(s=g+f|0)<<7|s>>>25)+g|0)<<9|s>>>23)+m|0)<<13|s>>>19)+p|0)<<18|s>>>14,b^=(s=(w^=(s=(v^=(s=(y^=(s=b+w|0)<<7|s>>>25)+b|0)<<9|s>>>23)+y|0)<<13|s>>>19)+v|0)<<18|s>>>14;e[0]=i>>>0&255,e[1]=i>>>8&255,e[2]=i>>>16&255,e[3]=i>>>24&255,e[4]=u>>>0&255,e[5]=u>>>8&255,e[6]=u>>>16&255,e[7]=u>>>24&255,e[8]=g>>>0&255,e[9]=g>>>8&255,e[10]=g>>>16&255,e[11]=g>>>24&255,e[12]=b>>>0&255,e[13]=b>>>8&255,e[14]=b>>>16&255,e[15]=b>>>24&255,e[16]=d>>>0&255,e[17]=d>>>8&255,e[18]=d>>>16&255,e[19]=d>>>24&255,e[20]=h>>>0&255,e[21]=h>>>8&255,e[22]=h>>>16&255,e[23]=h>>>24&255,e[24]=p>>>0&255,e[25]=p>>>8&255,e[26]=p>>>16&255,e[27]=p>>>24&255,e[28]=f>>>0&255,e[29]=f>>>8&255,e[30]=f>>>16&255,e[31]=f>>>24&255}(e,t,n,r)}var w=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function b(e,t,n,r,s,i,a){var o,l,c=new Uint8Array(16),u=new Uint8Array(64);for(l=0;l<16;l++)c[l]=0;for(l=0;l<8;l++)c[l]=i[l];for(;s>=64;){for(y(u,c,a,w),l=0;l<64;l++)e[t+l]=n[r+l]^u[l];for(o=1,l=8;l<16;l++)o=o+(255&c[l])|0,c[l]=255&o,o>>>=8;s-=64,t+=64,r+=64}if(s>0)for(y(u,c,a,w),l=0;l<s;l++)e[t+l]=n[r+l]^u[l];return 0}function _(e,t,n,r,s){var i,a,o=new Uint8Array(16),l=new Uint8Array(64);for(a=0;a<16;a++)o[a]=0;for(a=0;a<8;a++)o[a]=r[a];for(;n>=64;){for(y(l,o,s,w),a=0;a<64;a++)e[t+a]=l[a];for(i=1,a=8;a<16;a++)i=i+(255&o[a])|0,o[a]=255&i,i>>>=8;n-=64,t+=64}if(n>0)for(y(l,o,s,w),a=0;a<n;a++)e[t+a]=l[a];return 0}function x(e,t,n,r,s){var i=new Uint8Array(32);v(i,r,s,w);for(var a=new Uint8Array(8),o=0;o<8;o++)a[o]=r[o+16];return _(e,t,n,a,i)}function S(e,t,n,r,s,i,a){var o=new Uint8Array(32);v(o,i,a,w);for(var l=new Uint8Array(8),c=0;c<8;c++)l[c]=i[c+16];return b(e,t,n,r,s,l,o)}var j=function(e){var t,n,r,s,i,a,o,l;this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0,t=255&e[0]|(255&e[1])<<8,this.r[0]=8191&t,n=255&e[2]|(255&e[3])<<8,this.r[1]=8191&(t>>>13|n<<3),r=255&e[4]|(255&e[5])<<8,this.r[2]=7939&(n>>>10|r<<6),s=255&e[6]|(255&e[7])<<8,this.r[3]=8191&(r>>>7|s<<9),i=255&e[8]|(255&e[9])<<8,this.r[4]=255&(s>>>4|i<<12),this.r[5]=i>>>1&8190,a=255&e[10]|(255&e[11])<<8,this.r[6]=8191&(i>>>14|a<<2),o=255&e[12]|(255&e[13])<<8,this.r[7]=8065&(a>>>11|o<<5),l=255&e[14]|(255&e[15])<<8,this.r[8]=8191&(o>>>8|l<<8),this.r[9]=l>>>5&127,this.pad[0]=255&e[16]|(255&e[17])<<8,this.pad[1]=255&e[18]|(255&e[19])<<8,this.pad[2]=255&e[20]|(255&e[21])<<8,this.pad[3]=255&e[22]|(255&e[23])<<8,this.pad[4]=255&e[24]|(255&e[25])<<8,this.pad[5]=255&e[26]|(255&e[27])<<8,this.pad[6]=255&e[28]|(255&e[29])<<8,this.pad[7]=255&e[30]|(255&e[31])<<8};function T(e,t,n,r,s,i){var a=new j(i);return a.update(n,r,s),a.finish(e,t),0}function R(e,t,n,r,s,i){var a=new Uint8Array(16);return T(a,0,n,r,s,i),g(e,t,a,0)}function C(e,t,n,r,s){var i;if(n<32)return-1;for(S(e,0,t,0,n,r,s),T(e,16,e,32,n-32,e),i=0;i<16;i++)e[i]=0;return 0}function O(e,t,n,r,s){var i,a=new Uint8Array(32);if(n<32)return-1;if(x(a,0,32,r,s),0!==R(t,16,t,32,n-32,a))return-1;for(S(e,0,t,0,n,r,s),i=0;i<32;i++)e[i]=0;return 0}function I(e,t){var n;for(n=0;n<16;n++)e[n]=0|t[n]}function N(e){var t,n,r=1;for(t=0;t<16;t++)n=e[t]+r+65535,r=Math.floor(n/65536),e[t]=n-65536*r;e[0]+=r-1+37*(r-1)}function A(e,t,n){for(var r,s=~(n-1),i=0;i<16;i++)r=s&(e[i]^t[i]),e[i]^=r,t[i]^=r}function P(e,n){var r,s,i,a=t(),o=t();for(r=0;r<16;r++)o[r]=n[r];for(N(o),N(o),N(o),s=0;s<2;s++){for(a[0]=o[0]-65517,r=1;r<15;r++)a[r]=o[r]-65535-(a[r-1]>>16&1),a[r-1]&=65535;a[15]=o[15]-32767-(a[14]>>16&1),i=a[15]>>16&1,a[14]&=65535,A(o,a,1-i)}for(r=0;r<16;r++)e[2*r]=255&o[r],e[2*r+1]=o[r]>>8}function U(e,t){var n=new Uint8Array(32),r=new Uint8Array(32);return P(n,e),P(r,t),m(n,0,r,0)}function $(e){var t=new Uint8Array(32);return P(t,e),1&t[0]}function L(e,t){var n;for(n=0;n<16;n++)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}function D(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]+n[r]}function M(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]-n[r]}function B(e,t,n){var r,s,i=0,a=0,o=0,l=0,c=0,u=0,d=0,h=0,p=0,f=0,g=0,m=0,y=0,v=0,w=0,b=0,_=0,x=0,S=0,k=0,j=0,E=0,T=0,R=0,C=0,O=0,I=0,N=0,A=0,P=0,U=0,$=n[0],L=n[1],D=n[2],M=n[3],B=n[4],W=n[5],q=n[6],K=n[7],z=n[8],F=n[9],H=n[10],G=n[11],J=n[12],V=n[13],Y=n[14],Z=n[15];i+=(r=t[0])*$,a+=r*L,o+=r*D,l+=r*M,c+=r*B,u+=r*W,d+=r*q,h+=r*K,p+=r*z,f+=r*F,g+=r*H,m+=r*G,y+=r*J,v+=r*V,w+=r*Y,b+=r*Z,a+=(r=t[1])*$,o+=r*L,l+=r*D,c+=r*M,u+=r*B,d+=r*W,h+=r*q,p+=r*K,f+=r*z,g+=r*F,m+=r*H,y+=r*G,v+=r*J,w+=r*V,b+=r*Y,_+=r*Z,o+=(r=t[2])*$,l+=r*L,c+=r*D,u+=r*M,d+=r*B,h+=r*W,p+=r*q,f+=r*K,g+=r*z,m+=r*F,y+=r*H,v+=r*G,w+=r*J,b+=r*V,_+=r*Y,x+=r*Z,l+=(r=t[3])*$,c+=r*L,u+=r*D,d+=r*M,h+=r*B,p+=r*W,f+=r*q,g+=r*K,m+=r*z,y+=r*F,v+=r*H,w+=r*G,b+=r*J,_+=r*V,x+=r*Y,S+=r*Z,c+=(r=t[4])*$,u+=r*L,d+=r*D,h+=r*M,p+=r*B,f+=r*W,g+=r*q,m+=r*K,y+=r*z,v+=r*F,w+=r*H,b+=r*G,_+=r*J,x+=r*V,S+=r*Y,k+=r*Z,u+=(r=t[5])*$,d+=r*L,h+=r*D,p+=r*M,f+=r*B,g+=r*W,m+=r*q,y+=r*K,v+=r*z,w+=r*F,b+=r*H,_+=r*G,x+=r*J,S+=r*V,k+=r*Y,j+=r*Z,d+=(r=t[6])*$,h+=r*L,p+=r*D,f+=r*M,g+=r*B,m+=r*W,y+=r*q,v+=r*K,w+=r*z,b+=r*F,_+=r*H,x+=r*G,S+=r*J,k+=r*V,j+=r*Y,E+=r*Z,h+=(r=t[7])*$,p+=r*L,f+=r*D,g+=r*M,m+=r*B,y+=r*W,v+=r*q,w+=r*K,b+=r*z,_+=r*F,x+=r*H,S+=r*G,k+=r*J,j+=r*V,E+=r*Y,T+=r*Z,p+=(r=t[8])*$,f+=r*L,g+=r*D,m+=r*M,y+=r*B,v+=r*W,w+=r*q,b+=r*K,_+=r*z,x+=r*F,S+=r*H,k+=r*G,j+=r*J,E+=r*V,T+=r*Y,R+=r*Z,f+=(r=t[9])*$,g+=r*L,m+=r*D,y+=r*M,v+=r*B,w+=r*W,b+=r*q,_+=r*K,x+=r*z,S+=r*F,k+=r*H,j+=r*G,E+=r*J,T+=r*V,R+=r*Y,C+=r*Z,g+=(r=t[10])*$,m+=r*L,y+=r*D,v+=r*M,w+=r*B,b+=r*W,_+=r*q,x+=r*K,S+=r*z,k+=r*F,j+=r*H,E+=r*G,T+=r*J,R+=r*V,C+=r*Y,O+=r*Z,m+=(r=t[11])*$,y+=r*L,v+=r*D,w+=r*M,b+=r*B,_+=r*W,x+=r*q,S+=r*K,k+=r*z,j+=r*F,E+=r*H,T+=r*G,R+=r*J,C+=r*V,O+=r*Y,I+=r*Z,y+=(r=t[12])*$,v+=r*L,w+=r*D,b+=r*M,_+=r*B,x+=r*W,S+=r*q,k+=r*K,j+=r*z,E+=r*F,T+=r*H,R+=r*G,C+=r*J,O+=r*V,I+=r*Y,N+=r*Z,v+=(r=t[13])*$,w+=r*L,b+=r*D,_+=r*M,x+=r*B,S+=r*W,k+=r*q,j+=r*K,E+=r*z,T+=r*F,R+=r*H,C+=r*G,O+=r*J,I+=r*V,N+=r*Y,A+=r*Z,w+=(r=t[14])*$,b+=r*L,_+=r*D,x+=r*M,S+=r*B,k+=r*W,j+=r*q,E+=r*K,T+=r*z,R+=r*F,C+=r*H,O+=r*G,I+=r*J,N+=r*V,A+=r*Y,P+=r*Z,b+=(r=t[15])*$,a+=38*(x+=r*D),o+=38*(S+=r*M),l+=38*(k+=r*B),c+=38*(j+=r*W),u+=38*(E+=r*q),d+=38*(T+=r*K),h+=38*(R+=r*z),p+=38*(C+=r*F),f+=38*(O+=r*H),g+=38*(I+=r*G),m+=38*(N+=r*J),y+=38*(A+=r*V),v+=38*(P+=r*Y),w+=38*(U+=r*Z),i=(r=(i+=38*(_+=r*L))+(s=1)+65535)-65536*(s=Math.floor(r/65536)),a=(r=a+s+65535)-65536*(s=Math.floor(r/65536)),o=(r=o+s+65535)-65536*(s=Math.floor(r/65536)),l=(r=l+s+65535)-65536*(s=Math.floor(r/65536)),c=(r=c+s+65535)-65536*(s=Math.floor(r/65536)),u=(r=u+s+65535)-65536*(s=Math.floor(r/65536)),d=(r=d+s+65535)-65536*(s=Math.floor(r/65536)),h=(r=h+s+65535)-65536*(s=Math.floor(r/65536)),p=(r=p+s+65535)-65536*(s=Math.floor(r/65536)),f=(r=f+s+65535)-65536*(s=Math.floor(r/65536)),g=(r=g+s+65535)-65536*(s=Math.floor(r/65536)),m=(r=m+s+65535)-65536*(s=Math.floor(r/65536)),y=(r=y+s+65535)-65536*(s=Math.floor(r/65536)),v=(r=v+s+65535)-65536*(s=Math.floor(r/65536)),w=(r=w+s+65535)-65536*(s=Math.floor(r/65536)),b=(r=b+s+65535)-65536*(s=Math.floor(r/65536)),i=(r=(i+=s-1+37*(s-1))+(s=1)+65535)-65536*(s=Math.floor(r/65536)),a=(r=a+s+65535)-65536*(s=Math.floor(r/65536)),o=(r=o+s+65535)-65536*(s=Math.floor(r/65536)),l=(r=l+s+65535)-65536*(s=Math.floor(r/65536)),c=(r=c+s+65535)-65536*(s=Math.floor(r/65536)),u=(r=u+s+65535)-65536*(s=Math.floor(r/65536)),d=(r=d+s+65535)-65536*(s=Math.floor(r/65536)),h=(r=h+s+65535)-65536*(s=Math.floor(r/65536)),p=(r=p+s+65535)-65536*(s=Math.floor(r/65536)),f=(r=f+s+65535)-65536*(s=Math.floor(r/65536)),g=(r=g+s+65535)-65536*(s=Math.floor(r/65536)),m=(r=m+s+65535)-65536*(s=Math.floor(r/65536)),y=(r=y+s+65535)-65536*(s=Math.floor(r/65536)),v=(r=v+s+65535)-65536*(s=Math.floor(r/65536)),w=(r=w+s+65535)-65536*(s=Math.floor(r/65536)),b=(r=b+s+65535)-65536*(s=Math.floor(r/65536)),i+=s-1+37*(s-1),e[0]=i,e[1]=a,e[2]=o,e[3]=l,e[4]=c,e[5]=u,e[6]=d,e[7]=h,e[8]=p,e[9]=f,e[10]=g,e[11]=m,e[12]=y,e[13]=v,e[14]=w,e[15]=b}function W(e,t){B(e,t,t)}function q(e,n){var r,s=t();for(r=0;r<16;r++)s[r]=n[r];for(r=253;r>=0;r--)W(s,s),2!==r&&4!==r&&B(s,s,n);for(r=0;r<16;r++)e[r]=s[r]}function K(e,n){var r,s=t();for(r=0;r<16;r++)s[r]=n[r];for(r=250;r>=0;r--)W(s,s),1!==r&&B(s,s,n);for(r=0;r<16;r++)e[r]=s[r]}function z(e,n,r){var s,i,a=new Uint8Array(32),l=new Float64Array(80),c=t(),u=t(),d=t(),h=t(),p=t(),f=t();for(i=0;i<31;i++)a[i]=n[i];for(a[31]=127&n[31]|64,a[0]&=248,L(l,r),i=0;i<16;i++)u[i]=l[i],h[i]=c[i]=d[i]=0;for(c[0]=h[0]=1,i=254;i>=0;--i)A(c,u,s=a[i>>>3]>>>(7&i)&1),A(d,h,s),D(p,c,d),M(c,c,d),D(d,u,h),M(u,u,h),W(h,p),W(f,c),B(c,d,c),B(d,u,p),D(p,c,d),M(c,c,d),W(u,c),M(d,h,f),B(c,d,o),D(c,c,h),B(d,d,c),B(c,h,f),B(h,u,l),W(u,p),A(c,u,s),A(d,h,s);for(i=0;i<16;i++)l[i+16]=c[i],l[i+32]=d[i],l[i+48]=u[i],l[i+64]=h[i];var g=l.subarray(32),m=l.subarray(16);return q(g,g),B(m,m,g),P(e,m),0}function F(e,t){return z(e,t,s)}function H(e,t){return n(t,32),F(e,t)}function G(e,t,n){var s=new Uint8Array(32);return z(s,n,t),v(e,r,s,w)}j.prototype.blocks=function(e,t,n){for(var r,s,i,a,o,l,c,u,d,h,p,f,g,m,y,v,w,b,_,x=this.fin?0:2048,S=this.h[0],k=this.h[1],j=this.h[2],E=this.h[3],T=this.h[4],R=this.h[5],C=this.h[6],O=this.h[7],I=this.h[8],N=this.h[9],A=this.r[0],P=this.r[1],U=this.r[2],$=this.r[3],L=this.r[4],D=this.r[5],M=this.r[6],B=this.r[7],W=this.r[8],q=this.r[9];n>=16;)h=d=0,h+=(S+=8191&(r=255&e[t+0]|(255&e[t+1])<<8))*A,h+=(k+=8191&(r>>>13|(s=255&e[t+2]|(255&e[t+3])<<8)<<3))*(5*q),h+=(j+=8191&(s>>>10|(i=255&e[t+4]|(255&e[t+5])<<8)<<6))*(5*W),h+=(E+=8191&(i>>>7|(a=255&e[t+6]|(255&e[t+7])<<8)<<9))*(5*B),d=(h+=(T+=8191&(a>>>4|(o=255&e[t+8]|(255&e[t+9])<<8)<<12))*(5*M))>>>13,h&=8191,h+=(R+=o>>>1&8191)*(5*D),h+=(C+=8191&(o>>>14|(l=255&e[t+10]|(255&e[t+11])<<8)<<2))*(5*L),h+=(O+=8191&(l>>>11|(c=255&e[t+12]|(255&e[t+13])<<8)<<5))*(5*$),h+=(I+=8191&(c>>>8|(u=255&e[t+14]|(255&e[t+15])<<8)<<8))*(5*U),p=d+=(h+=(N+=u>>>5|x)*(5*P))>>>13,p+=S*P,p+=k*A,p+=j*(5*q),p+=E*(5*W),d=(p+=T*(5*B))>>>13,p&=8191,p+=R*(5*M),p+=C*(5*D),p+=O*(5*L),p+=I*(5*$),d+=(p+=N*(5*U))>>>13,p&=8191,f=d,f+=S*U,f+=k*P,f+=j*A,f+=E*(5*q),d=(f+=T*(5*W))>>>13,f&=8191,f+=R*(5*B),f+=C*(5*M),f+=O*(5*D),f+=I*(5*L),g=d+=(f+=N*(5*$))>>>13,g+=S*$,g+=k*U,g+=j*P,g+=E*A,d=(g+=T*(5*q))>>>13,g&=8191,g+=R*(5*W),g+=C*(5*B),g+=O*(5*M),g+=I*(5*D),m=d+=(g+=N*(5*L))>>>13,m+=S*L,m+=k*$,m+=j*U,m+=E*P,d=(m+=T*A)>>>13,m&=8191,m+=R*(5*q),m+=C*(5*W),m+=O*(5*B),m+=I*(5*M),y=d+=(m+=N*(5*D))>>>13,y+=S*D,y+=k*L,y+=j*$,y+=E*U,d=(y+=T*P)>>>13,y&=8191,y+=R*A,y+=C*(5*q),y+=O*(5*W),y+=I*(5*B),v=d+=(y+=N*(5*M))>>>13,v+=S*M,v+=k*D,v+=j*L,v+=E*$,d=(v+=T*U)>>>13,v&=8191,v+=R*P,v+=C*A,v+=O*(5*q),v+=I*(5*W),w=d+=(v+=N*(5*B))>>>13,w+=S*B,w+=k*M,w+=j*D,w+=E*L,d=(w+=T*$)>>>13,w&=8191,w+=R*U,w+=C*P,w+=O*A,w+=I*(5*q),b=d+=(w+=N*(5*W))>>>13,b+=S*W,b+=k*B,b+=j*M,b+=E*D,d=(b+=T*L)>>>13,b&=8191,b+=R*$,b+=C*U,b+=O*P,b+=I*A,_=d+=(b+=N*(5*q))>>>13,_+=S*q,_+=k*W,_+=j*B,_+=E*M,d=(_+=T*D)>>>13,_&=8191,_+=R*L,_+=C*$,_+=O*U,_+=I*P,S=h=8191&(d=(d=((d+=(_+=N*A)>>>13)<<2)+d|0)+(h&=8191)|0),k=p+=d>>>=13,j=f&=8191,E=g&=8191,T=m&=8191,R=y&=8191,C=v&=8191,O=w&=8191,I=b&=8191,N=_&=8191,t+=16,n-=16;this.h[0]=S,this.h[1]=k,this.h[2]=j,this.h[3]=E,this.h[4]=T,this.h[5]=R,this.h[6]=C,this.h[7]=O,this.h[8]=I,this.h[9]=N},j.prototype.finish=function(e,t){var n,r,s,i,a=new Uint16Array(10);if(this.leftover){for(i=this.leftover,this.buffer[i++]=1;i<16;i++)this.buffer[i]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(n=this.h[1]>>>13,this.h[1]&=8191,i=2;i<10;i++)this.h[i]+=n,n=this.h[i]>>>13,this.h[i]&=8191;for(this.h[0]+=5*n,n=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=n,n=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=n,a[0]=this.h[0]+5,n=a[0]>>>13,a[0]&=8191,i=1;i<10;i++)a[i]=this.h[i]+n,n=a[i]>>>13,a[i]&=8191;for(a[9]-=8192,r=(1^n)-1,i=0;i<10;i++)a[i]&=r;for(r=~r,i=0;i<10;i++)this.h[i]=this.h[i]&r|a[i];for(this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5),s=this.h[0]+this.pad[0],this.h[0]=65535&s,i=1;i<8;i++)s=(this.h[i]+this.pad[i]|0)+(s>>>16)|0,this.h[i]=65535&s;e[t+0]=this.h[0]>>>0&255,e[t+1]=this.h[0]>>>8&255,e[t+2]=this.h[1]>>>0&255,e[t+3]=this.h[1]>>>8&255,e[t+4]=this.h[2]>>>0&255,e[t+5]=this.h[2]>>>8&255,e[t+6]=this.h[3]>>>0&255,e[t+7]=this.h[3]>>>8&255,e[t+8]=this.h[4]>>>0&255,e[t+9]=this.h[4]>>>8&255,e[t+10]=this.h[5]>>>0&255,e[t+11]=this.h[5]>>>8&255,e[t+12]=this.h[6]>>>0&255,e[t+13]=this.h[6]>>>8&255,e[t+14]=this.h[7]>>>0&255,e[t+15]=this.h[7]>>>8&255},j.prototype.update=function(e,t,n){var r,s;if(this.leftover){for((s=16-this.leftover)>n&&(s=n),r=0;r<s;r++)this.buffer[this.leftover+r]=e[t+r];if(n-=s,t+=s,this.leftover+=s,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(n>=16&&(s=n-n%16,this.blocks(e,t,s),t+=s,n-=s),n){for(r=0;r<n;r++)this.buffer[this.leftover+r]=e[t+r];this.leftover+=n}};var J=C,V=O,Y=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Z(e,t,n,r){for(var s,i,a,o,l,c,u,d,h,p,f,g,m,y,v,w,b,_,x,S,k,j,E,T,R,C,O=new Int32Array(16),I=new Int32Array(16),N=e[0],A=e[1],P=e[2],U=e[3],$=e[4],L=e[5],D=e[6],M=e[7],B=t[0],W=t[1],q=t[2],K=t[3],z=t[4],F=t[5],H=t[6],G=t[7],J=0;r>=128;){for(x=0;x<16;x++)S=8*x+J,O[x]=n[S+0]<<24|n[S+1]<<16|n[S+2]<<8|n[S+3],I[x]=n[S+4]<<24|n[S+5]<<16|n[S+6]<<8|n[S+7];for(x=0;x<80;x++)if(s=N,i=A,a=P,o=U,l=$,c=L,u=D,h=B,p=W,f=q,g=K,m=z,y=F,v=H,E=65535&(j=G),T=j>>>16,R=65535&(k=M),C=k>>>16,E+=65535&(j=(z>>>14|$<<18)^(z>>>18|$<<14)^($>>>9|z<<23)),T+=j>>>16,R+=65535&(k=($>>>14|z<<18)^($>>>18|z<<14)^(z>>>9|$<<23)),C+=k>>>16,E+=65535&(j=z&F^~z&H),T+=j>>>16,R+=65535&(k=$&L^~$&D),C+=k>>>16,E+=65535&(j=Y[2*x+1]),T+=j>>>16,R+=65535&(k=Y[2*x]),C+=k>>>16,k=O[x%16],T+=(j=I[x%16])>>>16,R+=65535&k,C+=k>>>16,R+=(T+=(E+=65535&j)>>>16)>>>16,E=65535&(j=_=65535&E|T<<16),T=j>>>16,R=65535&(k=b=65535&R|(C+=R>>>16)<<16),C=k>>>16,E+=65535&(j=(B>>>28|N<<4)^(N>>>2|B<<30)^(N>>>7|B<<25)),T+=j>>>16,R+=65535&(k=(N>>>28|B<<4)^(B>>>2|N<<30)^(B>>>7|N<<25)),C+=k>>>16,T+=(j=B&W^B&q^W&q)>>>16,R+=65535&(k=N&A^N&P^A&P),C+=k>>>16,d=65535&(R+=(T+=(E+=65535&j)>>>16)>>>16)|(C+=R>>>16)<<16,w=65535&E|T<<16,E=65535&(j=g),T=j>>>16,R=65535&(k=o),C=k>>>16,T+=(j=_)>>>16,R+=65535&(k=b),C+=k>>>16,A=s,P=i,U=a,$=o=65535&(R+=(T+=(E+=65535&j)>>>16)>>>16)|(C+=R>>>16)<<16,L=l,D=c,M=u,N=d,W=h,q=p,K=f,z=g=65535&E|T<<16,F=m,H=y,G=v,B=w,x%16==15)for(S=0;S<16;S++)k=O[S],E=65535&(j=I[S]),T=j>>>16,R=65535&k,C=k>>>16,k=O[(S+9)%16],E+=65535&(j=I[(S+9)%16]),T+=j>>>16,R+=65535&k,C+=k>>>16,b=O[(S+1)%16],E+=65535&(j=((_=I[(S+1)%16])>>>1|b<<31)^(_>>>8|b<<24)^(_>>>7|b<<25)),T+=j>>>16,R+=65535&(k=(b>>>1|_<<31)^(b>>>8|_<<24)^b>>>7),C+=k>>>16,b=O[(S+14)%16],T+=(j=((_=I[(S+14)%16])>>>19|b<<13)^(b>>>29|_<<3)^(_>>>6|b<<26))>>>16,R+=65535&(k=(b>>>19|_<<13)^(_>>>29|b<<3)^b>>>6),C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,O[S]=65535&R|C<<16,I[S]=65535&E|T<<16;E=65535&(j=B),T=j>>>16,R=65535&(k=N),C=k>>>16,k=e[0],T+=(j=t[0])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[0]=N=65535&R|C<<16,t[0]=B=65535&E|T<<16,E=65535&(j=W),T=j>>>16,R=65535&(k=A),C=k>>>16,k=e[1],T+=(j=t[1])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[1]=A=65535&R|C<<16,t[1]=W=65535&E|T<<16,E=65535&(j=q),T=j>>>16,R=65535&(k=P),C=k>>>16,k=e[2],T+=(j=t[2])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[2]=P=65535&R|C<<16,t[2]=q=65535&E|T<<16,E=65535&(j=K),T=j>>>16,R=65535&(k=U),C=k>>>16,k=e[3],T+=(j=t[3])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[3]=U=65535&R|C<<16,t[3]=K=65535&E|T<<16,E=65535&(j=z),T=j>>>16,R=65535&(k=$),C=k>>>16,k=e[4],T+=(j=t[4])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[4]=$=65535&R|C<<16,t[4]=z=65535&E|T<<16,E=65535&(j=F),T=j>>>16,R=65535&(k=L),C=k>>>16,k=e[5],T+=(j=t[5])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[5]=L=65535&R|C<<16,t[5]=F=65535&E|T<<16,E=65535&(j=H),T=j>>>16,R=65535&(k=D),C=k>>>16,k=e[6],T+=(j=t[6])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[6]=D=65535&R|C<<16,t[6]=H=65535&E|T<<16,E=65535&(j=G),T=j>>>16,R=65535&(k=M),C=k>>>16,k=e[7],T+=(j=t[7])>>>16,R+=65535&k,C+=k>>>16,C+=(R+=(T+=(E+=65535&j)>>>16)>>>16)>>>16,e[7]=M=65535&R|C<<16,t[7]=G=65535&E|T<<16,J+=128,r-=128}return r}function X(e,t,n){var r,s=new Int32Array(8),i=new Int32Array(8),a=new Uint8Array(256),o=n;for(s[0]=1779033703,s[1]=3144134277,s[2]=1013904242,s[3]=2773480762,s[4]=1359893119,s[5]=2600822924,s[6]=528734635,s[7]=1541459225,i[0]=4089235720,i[1]=2227873595,i[2]=4271175723,i[3]=1595750129,i[4]=2917565137,i[5]=725511199,i[6]=4215389547,i[7]=327033209,Z(s,i,t,n),n%=128,r=0;r<n;r++)a[r]=t[o-n+r];for(a[n]=128,a[(n=256-128*(n<112?1:0))-9]=0,p(a,n-8,o/536870912|0,o<<3),Z(s,i,a,n),r=0;r<8;r++)p(e,8*r,s[r],i[r]);return 0}function Q(e,n){var r=t(),s=t(),i=t(),a=t(),o=t(),l=t(),u=t(),d=t(),h=t();M(r,e[1],e[0]),M(h,n[1],n[0]),B(r,r,h),D(s,e[0],e[1]),D(h,n[0],n[1]),B(s,s,h),B(i,e[3],n[3]),B(i,i,c),B(a,e[2],n[2]),D(a,a,a),M(o,s,r),M(l,a,i),D(u,a,i),D(d,s,r),B(e[0],o,l),B(e[1],d,u),B(e[2],u,l),B(e[3],o,d)}function ee(e,t,n){var r;for(r=0;r<4;r++)A(e[r],t[r],n)}function te(e,n){var r=t(),s=t(),i=t();q(i,n[2]),B(r,n[0],i),B(s,n[1],i),P(e,s),e[31]^=$(r)<<7}function ne(e,t,n){var r,s;for(I(e[0],i),I(e[1],a),I(e[2],a),I(e[3],i),s=255;s>=0;--s)ee(e,t,r=n[s/8|0]>>(7&s)&1),Q(t,e),Q(e,e),ee(e,t,r)}function re(e,n){var r=[t(),t(),t(),t()];I(r[0],u),I(r[1],d),I(r[2],a),B(r[3],u,d),ne(e,r,n)}function se(e,r,s){var i,a=new Uint8Array(64),o=[t(),t(),t(),t()];for(s||n(r,32),X(a,r,32),a[0]&=248,a[31]&=127,a[31]|=64,re(o,a),te(e,o),i=0;i<32;i++)r[i+32]=e[i];return 0}var ie=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ae(e,t){var n,r,s,i;for(r=63;r>=32;--r){for(n=0,s=r-32,i=r-12;s<i;++s)t[s]+=n-16*t[r]*ie[s-(r-32)],n=Math.floor((t[s]+128)/256),t[s]-=256*n;t[s]+=n,t[r]=0}for(n=0,s=0;s<32;s++)t[s]+=n-(t[31]>>4)*ie[s],n=t[s]>>8,t[s]&=255;for(s=0;s<32;s++)t[s]-=n*ie[s];for(r=0;r<32;r++)t[r+1]+=t[r]>>8,e[r]=255&t[r]}function oe(e){var t,n=new Float64Array(64);for(t=0;t<64;t++)n[t]=e[t];for(t=0;t<64;t++)e[t]=0;ae(e,n)}function le(e,n,r,s){var i,a,o=new Uint8Array(64),l=new Uint8Array(64),c=new Uint8Array(64),u=new Float64Array(64),d=[t(),t(),t(),t()];X(o,s,32),o[0]&=248,o[31]&=127,o[31]|=64;var h=r+64;for(i=0;i<r;i++)e[64+i]=n[i];for(i=0;i<32;i++)e[32+i]=o[32+i];for(X(c,e.subarray(32),r+32),oe(c),re(d,c),te(e,d),i=32;i<64;i++)e[i]=s[i];for(X(l,e,r+64),oe(l),i=0;i<64;i++)u[i]=0;for(i=0;i<32;i++)u[i]=c[i];for(i=0;i<32;i++)for(a=0;a<32;a++)u[i+a]+=l[i]*o[a];return ae(e.subarray(32),u),h}function ce(e,n,r,s){var o,c=new Uint8Array(32),u=new Uint8Array(64),d=[t(),t(),t(),t()],p=[t(),t(),t(),t()];if(r<64)return-1;if(function(e,n){var r=t(),s=t(),o=t(),c=t(),u=t(),d=t(),p=t();return I(e[2],a),L(e[1],n),W(o,e[1]),B(c,o,l),M(o,o,e[2]),D(c,e[2],c),W(u,c),W(d,u),B(p,d,u),B(r,p,o),B(r,r,c),K(r,r),B(r,r,o),B(r,r,c),B(r,r,c),B(e[0],r,c),W(s,e[0]),B(s,s,c),U(s,o)&&B(e[0],e[0],h),W(s,e[0]),B(s,s,c),U(s,o)?-1:($(e[0])===n[31]>>7&&M(e[0],i,e[0]),B(e[3],e[0],e[1]),0)}(p,s))return-1;for(o=0;o<r;o++)e[o]=n[o];for(o=0;o<32;o++)e[o+32]=s[o];if(X(u,e,r),oe(u),ne(d,p,u),re(p,n.subarray(32)),Q(d,p),te(c,d),r-=64,m(n,0,c,0)){for(o=0;o<r;o++)e[o]=0;return-1}for(o=0;o<r;o++)e[o]=n[o+64];return r}var ue=16,de=64,he=32,pe=64;function fe(e,t){if(32!==e.length)throw new Error("bad key size");if(24!==t.length)throw new Error("bad nonce size")}function ge(){for(var e=0;e<arguments.length;e++)if(!(arguments[e]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function me(e){for(var t=0;t<e.length;t++)e[t]=0}e.lowlevel={crypto_core_hsalsa20:v,crypto_stream_xor:S,crypto_stream:x,crypto_stream_salsa20_xor:b,crypto_stream_salsa20:_,crypto_onetimeauth:T,crypto_onetimeauth_verify:R,crypto_verify_16:g,crypto_verify_32:m,crypto_secretbox:C,crypto_secretbox_open:O,crypto_scalarmult:z,crypto_scalarmult_base:F,crypto_box_beforenm:G,crypto_box_afternm:J,crypto_box:function(e,t,n,r,s,i){var a=new Uint8Array(32);return G(a,s,i),J(e,t,n,r,a)},crypto_box_open:function(e,t,n,r,s,i){var a=new Uint8Array(32);return G(a,s,i),V(e,t,n,r,a)},crypto_box_keypair:H,crypto_hash:X,crypto_sign:le,crypto_sign_keypair:se,crypto_sign_open:ce,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:ue,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:de,crypto_sign_PUBLICKEYBYTES:he,crypto_sign_SECRETKEYBYTES:pe,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:l,L:ie,pack25519:P,unpack25519:L,M:B,A:D,S:W,Z:M,pow2523:K,add:Q,set25519:I,modL:ae,scalarmult:ne,scalarbase:re},e.randomBytes=function(e){var t=new Uint8Array(e);return n(t,e),t},e.secretbox=function(e,t,n){ge(e,t,n),fe(n,t);for(var r=new Uint8Array(32+e.length),s=new Uint8Array(r.length),i=0;i<e.length;i++)r[i+32]=e[i];return C(s,r,r.length,t,n),s.subarray(ue)},e.secretbox.open=function(e,t,n){ge(e,t,n),fe(n,t);for(var r=new Uint8Array(ue+e.length),s=new Uint8Array(r.length),i=0;i<e.length;i++)r[i+ue]=e[i];return r.length<32||0!==O(s,r,r.length,t,n)?null:s.subarray(32)},e.secretbox.keyLength=32,e.secretbox.nonceLength=24,e.secretbox.overheadLength=ue,e.scalarMult=function(e,t){if(ge(e,t),32!==e.length)throw new Error("bad n size");if(32!==t.length)throw new Error("bad p size");var n=new Uint8Array(32);return z(n,e,t),n},e.scalarMult.base=function(e){if(ge(e),32!==e.length)throw new Error("bad n size");var t=new Uint8Array(32);return F(t,e),t},e.scalarMult.scalarLength=32,e.scalarMult.groupElementLength=32,e.box=function(t,n,r,s){var i=e.box.before(r,s);return e.secretbox(t,n,i)},e.box.before=function(e,t){ge(e,t),function(e,t){if(32!==e.length)throw new Error("bad public key size");if(32!==t.length)throw new Error("bad secret key size")}(e,t);var n=new Uint8Array(32);return G(n,e,t),n},e.box.after=e.secretbox,e.box.open=function(t,n,r,s){var i=e.box.before(r,s);return e.secretbox.open(t,n,i)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var e=new Uint8Array(32),t=new Uint8Array(32);return H(e,t),{publicKey:e,secretKey:t}},e.box.keyPair.fromSecretKey=function(e){if(ge(e),32!==e.length)throw new Error("bad secret key size");var t=new Uint8Array(32);return F(t,e),{publicKey:t,secretKey:new Uint8Array(e)}},e.box.publicKeyLength=32,e.box.secretKeyLength=32,e.box.sharedKeyLength=32,e.box.nonceLength=24,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(e,t){if(ge(e,t),t.length!==pe)throw new Error("bad secret key size");var n=new Uint8Array(de+e.length);return le(n,e,e.length,t),n},e.sign.open=function(e,t){if(ge(e,t),t.length!==he)throw new Error("bad public key size");var n=new Uint8Array(e.length),r=ce(n,e,e.length,t);if(r<0)return null;for(var s=new Uint8Array(r),i=0;i<s.length;i++)s[i]=n[i];return s},e.sign.detached=function(t,n){for(var r=e.sign(t,n),s=new Uint8Array(de),i=0;i<s.length;i++)s[i]=r[i];return s},e.sign.detached.verify=function(e,t,n){if(ge(e,t,n),t.length!==de)throw new Error("bad signature size");if(n.length!==he)throw new Error("bad public key size");var r,s=new Uint8Array(de+e.length),i=new Uint8Array(de+e.length);for(r=0;r<de;r++)s[r]=t[r];for(r=0;r<e.length;r++)s[r+de]=e[r];return ce(i,s,s.length,n)>=0},e.sign.keyPair=function(){var e=new Uint8Array(he),t=new Uint8Array(pe);return se(e,t),{publicKey:e,secretKey:t}},e.sign.keyPair.fromSecretKey=function(e){if(ge(e),e.length!==pe)throw new Error("bad secret key size");for(var t=new Uint8Array(he),n=0;n<t.length;n++)t[n]=e[32+n];return{publicKey:t,secretKey:new Uint8Array(e)}},e.sign.keyPair.fromSeed=function(e){if(ge(e),32!==e.length)throw new Error("bad seed size");for(var t=new Uint8Array(he),n=new Uint8Array(pe),r=0;r<32;r++)n[r]=e[r];return se(t,n,!0),{publicKey:t,secretKey:n}},e.sign.publicKeyLength=he,e.sign.secretKeyLength=pe,e.sign.seedLength=32,e.sign.signatureLength=de,e.hash=function(e){ge(e);var t=new Uint8Array(64);return X(t,e,e.length),t},e.hash.hashLength=64,e.verify=function(e,t){return ge(e,t),0!==e.length&&0!==t.length&&e.length===t.length&&0===f(e,0,t,0,e.length)},e.setPRNG=function(e){n=e},function(){var t="undefined"!=typeof self?self.crypto||self.msCrypto:null;t&&t.getRandomValues?e.setPRNG(function(e,n){var r,s=new Uint8Array(n);for(r=0;r<n;r+=65536)t.getRandomValues(s.subarray(r,r+Math.min(n-r,65536)));for(r=0;r<n;r++)e[r]=s[r];me(s)}):void 0!==k&&(t=E)&&t.randomBytes&&e.setPRNG(function(e,n){var r,s=t.randomBytes(n);for(r=0;r<n;r++)e[r]=s[r];me(s)})}()}(j.exports?j.exports:self.nacl=self.nacl||{})),j.exports);const C=r(R);var O,I,N,A,P,U;!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",e[e.MANIFEST_NOT_FOUND_ERROR=2]="MANIFEST_NOT_FOUND_ERROR",e[e.MANIFEST_CONTENT_ERROR=3]="MANIFEST_CONTENT_ERROR",e[e.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",e[e.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",e[e.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"}(O||(O={})),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"}(I||(I={})),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",e[e.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",e[e.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",e[e.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"}(N||(N={})),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",e[e.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",e[e.USER_REJECTS_ERROR=300]="USER_REJECTS_ERROR",e[e.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"}(A||(A={})),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR",e[e.BAD_REQUEST_ERROR=1]="BAD_REQUEST_ERROR",e[e.UNKNOWN_APP_ERROR=100]="UNKNOWN_APP_ERROR",e[e.METHOD_NOT_SUPPORTED=400]="METHOD_NOT_SUPPORTED"}(P||(P={})),function(e){e.MAINNET="-239",e.TESTNET="-3"}(U||(U={}));const $={encode:function(e,t=!1){let n;return e instanceof Uint8Array?n=e:("string"!=typeof e&&(e=JSON.stringify(e)),n=S.decodeUTF8(e)),function(e,t){const n=S.encodeBase64(e);return t?encodeURIComponent(n):n}(n,t)},decode:function(e,t=!1){const n=function(e,t){return t&&(e=decodeURIComponent(e)),S.decodeBase64(e)}(e,t);return{toString:()=>S.encodeUTF8(n),toObject(){try{return JSON.parse(S.encodeUTF8(n))}catch(bl){return null}},toUint8Array:()=>n}}};function L(e){let t="";return e.forEach(e=>{t+=("0"+(255&e).toString(16)).slice(-2)}),t}function D(e){if(e.length%2!=0)throw new Error(`Cannot convert ${e} to bytesArray`);const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2)t[n/2]=parseInt(e.slice(n,n+2),16);return t}class M{constructor(e){this.nonceLength=24,this.keyPair=e?this.createKeypairFromString(e):this.createKeypair(),this.sessionId=L(this.keyPair.publicKey)}createKeypair(){return C.box.keyPair()}createKeypairFromString(e){return{publicKey:D(e.publicKey),secretKey:D(e.secretKey)}}createNonce(){return C.randomBytes(this.nonceLength)}encrypt(e,t){const n=(new TextEncoder).encode(e),r=this.createNonce();return function(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}(r,C.box(n,r,t,this.keyPair.secretKey))}decrypt(e,t){const[n,r]=function(e,t){if(t>=e.length)throw new Error("Index is out of buffer");return[e.slice(0,t),e.slice(t)]}(e,this.nonceLength),s=C.box.open(r,n,t,this.keyPair.secretKey);if(!s)throw new Error(`Decryption error: \n message: ${e.toString()} \n sender pubkey: ${t.toString()} \n keypair pubkey: ${this.keyPair.publicKey.toString()} \n keypair secretkey: ${this.keyPair.secretKey.toString()}`);return(new TextDecoder).decode(s)}stringifyKeypair(){return{publicKey:L(this.keyPair.publicKey),secretKey:L(this.keyPair.secretKey)}}}function B(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}function W(e,t,n,r){return new(n||(n=Promise))(function(t,s){function i(e){try{o(r.next(e))}catch(bl){s(bl)}}function a(e){try{o(r.throw(e))}catch(bl){s(bl)}}function o(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(i,a)}o((r=r.apply(e,[])).next())})}"function"==typeof SuppressedError&&SuppressedError;class q extends Error{get info(){return""}constructor(e,t){super(e,t),this.message=`${q.prefix} ${this.constructor.name}${this.info?": "+this.info:""}${e?"\n"+e:""}`,Object.setPrototypeOf(this,q.prototype)}}q.prefix="[TON_CONNECT_SDK_ERROR]";class K extends q{get info(){return"Passed DappMetadata is in incorrect format."}constructor(...e){super(...e),Object.setPrototypeOf(this,K.prototype)}}class z extends q{get info(){return"Passed `tonconnect-manifest.json` contains errors. Check format of your manifest. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,z.prototype)}}class F extends q{get info(){return"Manifest not found. Make sure you added `tonconnect-manifest.json` to the root of your app or passed correct manifestUrl. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest"}constructor(...e){super(...e),Object.setPrototypeOf(this,F.prototype)}}class H extends q{get info(){return"Wallet connection called but wallet already connected. To avoid the error, disconnect the wallet before doing a new connection."}constructor(...e){super(...e),Object.setPrototypeOf(this,H.prototype)}}class G extends q{get info(){return"Send transaction or other protocol methods called while wallet is not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,G.prototype)}}class J extends q{get info(){return"There is an attempt to connect to the injected wallet while it is not exists in the webpage."}constructor(...e){super(...e),Object.setPrototypeOf(this,J.prototype)}}class V extends q{get info(){return"Wallet doesn't support requested feature method."}constructor(e,t){super(e,t),Object.setPrototypeOf(this,V.prototype)}}class Y extends q{get info(){return"Missing required features. You need to update your wallet."}constructor(e,t){super(e,t),Object.setPrototypeOf(this,Y.prototype)}}class Z extends q{constructor(e,t){super(e,t),this.name="WalletWrongNetworkError",Object.setPrototypeOf(this,Z.prototype)}}class X extends q{get info(){return"User rejects the action in the wallet."}constructor(...e){super(...e),Object.setPrototypeOf(this,X.prototype)}}class Q extends q{get info(){return"Request to the wallet contains errors."}constructor(...e){super(...e),Object.setPrototypeOf(this,Q.prototype)}}class ee extends q{get info(){return"App tries to send rpc request to the injected wallet while not connected."}constructor(...e){super(...e),Object.setPrototypeOf(this,ee.prototype)}}class te extends q{get info(){return"An error occurred while fetching the wallets list."}constructor(...e){super(...e),Object.setPrototypeOf(this,te.prototype)}}class ne extends q{get info(){return"Passed address is in incorrect format."}constructor(...e){super(...e),Object.setPrototypeOf(this,ne.prototype)}}class re extends q{get info(){return"Passed hex is in incorrect format."}constructor(...e){super(...e),Object.setPrototypeOf(this,re.prototype)}}class se extends q{constructor(...e){super(...e),Object.setPrototypeOf(this,se.prototype)}}const ie={[O.UNKNOWN_ERROR]:se,[O.USER_REJECTS_ERROR]:X,[O.BAD_REQUEST_ERROR]:Q,[O.UNKNOWN_APP_ERROR]:ee,[O.MANIFEST_NOT_FOUND_ERROR]:F,[O.MANIFEST_CONTENT_ERROR]:z};const ae=new class{parseError(e){let t=se;return e.code in ie&&(t=ie[e.code]||se),new t(e.message)}};class oe{isError(e){return"error"in e}}const le={[N.UNKNOWN_ERROR]:se,[N.USER_REJECTS_ERROR]:X,[N.BAD_REQUEST_ERROR]:Q,[N.UNKNOWN_APP_ERROR]:ee};const ce=new class extends oe{convertToRpcRequest(e){return{method:"sendTransaction",params:[JSON.stringify(e)]}}parseAndThrowError(e){let t=se;throw e.error.code in le&&(t=le[e.error.code]||se),new t(e.error.message)}convertFromRpcResponse(e){return{boc:e.result}}},ue={[A.UNKNOWN_ERROR]:se,[A.USER_REJECTS_ERROR]:X,[A.BAD_REQUEST_ERROR]:Q,[A.UNKNOWN_APP_ERROR]:ee};const de=new class extends oe{convertToRpcRequest(e){return{method:"signData",params:[JSON.stringify(e)]}}parseAndThrowError(e){let t=se;throw e.error.code in ue&&(t=ue[e.error.code]||se),new t(e.error.message)}convertFromRpcResponse(e){return e.result}};class he{constructor(e,t){this.storage=e,this.storeKey="ton-connect-storage_http-bridge-gateway::"+t}storeLastEventId(e){return W(this,0,void 0,function*(){return this.storage.setItem(this.storeKey,e)})}removeLastEventId(){return W(this,0,void 0,function*(){return this.storage.removeItem(this.storeKey)})}getLastEventId(){return W(this,0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);return e||null})}}function pe(e,t){return function(e){return"/"===e.slice(-1)?e.slice(0,-1):e}(e)+"/"+t}function fe(e,t){return W(this,0,void 0,function*(){return new Promise((t,n)=>{setTimeout(()=>t(),e)})})}function ge(e){const t=new AbortController;return(null==e?void 0:e.aborted)?t.abort():null==e||e.addEventListener("abort",()=>t.abort(),{once:!0}),t}function me(e,t){return W(this,0,void 0,function*(){var n,r;const s=null!==(n=null==t?void 0:t.attempts)&&void 0!==n?n:10,i=null!==(r=null==t?void 0:t.delayMs)&&void 0!==r?r:200,a=ge(null==t?void 0:t.signal);if("function"!=typeof e)throw new q("Expected a function, got "+typeof e);let o,l=0;for(;l<s;){if(a.signal.aborted)throw new q(`Aborted after attempts ${l}`);try{return yield e({signal:a.signal})}catch(c){o=c,l++,l<s&&(yield fe(i))}}throw o})}function ye(...e){try{console.debug("[TON_CONNECT_SDK]",...e)}catch(t){}}function ve(...e){try{console.error("[TON_CONNECT_SDK]",...e)}catch(t){}}class we{get isReady(){const e=this.eventSource.current();return(null==e?void 0:e.readyState)===EventSource.OPEN}get isClosed(){const e=this.eventSource.current();return(null==e?void 0:e.readyState)!==EventSource.OPEN}get isConnecting(){const e=this.eventSource.current();return(null==e?void 0:e.readyState)===EventSource.CONNECTING}constructor(e,t,n,r,s,i){this.bridgeUrl=t,this.sessionId=n,this.listener=r,this.errorsListener=s,this.ssePath="events",this.postPath="message",this.heartbeatMessage="heartbeat",this.defaultTtl=300,this.defaultReconnectDelay=2e3,this.defaultResendDelay=5e3,this.eventSource=function(e,t){let n=null,r=null,s=null,i=null,a=null;const o=(o,...l)=>W(this,0,void 0,function*(){if(i=null!=o?o:null,null==a||a.abort(),a=ge(o),a.signal.aborted)throw new q("Resource creation was aborted");r=null!=l?l:null;const c=e(a.signal,...l);s=c;const u=yield c;if(s!==c&&u!==n)throw yield t(u),new q("Resource creation was aborted by a new resource creation");return n=u,n});return{create:o,current:()=>null!=n?n:null,dispose:()=>W(this,0,void 0,function*(){try{const e=n;n=null;const r=s;s=null;try{null==a||a.abort()}catch(bl){}yield Promise.allSettled([e?t(e):Promise.resolve(),r?t(yield r):Promise.resolve()])}catch(bl){}}),recreate:e=>W(this,0,void 0,function*(){const t=n,a=s,l=r,c=i;if(yield fe(e),t===n&&a===s&&l===r&&c===i)return yield o(i,...null!=l?l:[]);throw new q("Resource recreation was aborted by a new resource creation")})}}((e,t,n)=>W(this,0,void 0,function*(){const r={bridgeUrl:this.bridgeUrl,ssePath:this.ssePath,sessionId:this.sessionId,bridgeGatewayStorage:this.bridgeGatewayStorage,errorHandler:this.errorsHandler.bind(this),messageHandler:this.messagesHandler.bind(this),signal:e,openingDeadlineMS:t,traceId:n};return yield function(e){return W(this,0,void 0,function*(){return yield function(e,t){const n=null==t?void 0:t.timeout,r=ge(null==t?void 0:t.signal);return new Promise((t,s)=>W(this,0,void 0,function*(){if(r.signal.aborted)return void s(new q("Operation aborted"));let i;void 0!==n&&(i=setTimeout(()=>{r.abort(),s(new q(`Timeout after ${n}ms`))},n)),r.signal.addEventListener("abort",()=>{clearTimeout(i),s(new q("Operation aborted"))},{once:!0});const a={timeout:n,abort:r.signal};yield e((...e)=>{clearTimeout(i),t(...e)},()=>{clearTimeout(i),s()},a)}))}((t,n,r)=>W(this,0,void 0,function*(){var s;const i=ge(r.signal).signal;if(i.aborted)return void n(new q("Bridge connection aborted"));const a=new URL(pe(e.bridgeUrl,e.ssePath));a.searchParams.append("client_id",e.sessionId);const o=yield e.bridgeGatewayStorage.getLastEventId();if(o&&a.searchParams.append("last_event_id",o),e.traceId&&a.searchParams.append("trace_id",e.traceId),i.aborted)return void n(new q("Bridge connection aborted"));const l=new EventSource(a.toString());l.onerror=r=>W(this,0,void 0,function*(){if(i.aborted)return l.close(),void n(new q("Bridge connection aborted"));try{const n=yield e.errorHandler(l,r);n!==l&&l.close(),n&&n!==l&&t(n)}catch(bl){l.close(),n(bl)}}),l.onopen=()=>{if(i.aborted)return l.close(),void n(new q("Bridge connection aborted"));t(l)},l.onmessage=t=>{if(i.aborted)return l.close(),void n(new q("Bridge connection aborted"));e.messageHandler(t)},null===(s=e.signal)||void 0===s||s.addEventListener("abort",()=>{l.close(),n(new q("Bridge connection aborted"))})}),{timeout:e.openingDeadlineMS,signal:e.signal})})}(r)}),e=>W(this,0,void 0,function*(){e.close()})),this.bridgeGatewayStorage=new he(e,t),this.analytics=null==i?void 0:i.scoped({bridge_url:t,client_id:n})}registerSession(e){return W(this,0,void 0,function*(){var t,n,r;try{null===(t=this.analytics)||void 0===t||t.emitBridgeClientConnectStarted({trace_id:null==e?void 0:e.traceId});const r=Date.now();yield this.eventSource.create(null==e?void 0:e.signal,null==e?void 0:e.openingDeadlineMS,null==e?void 0:e.traceId);const s=Date.now()-r;null===(n=this.analytics)||void 0===n||n.emitBridgeClientConnectEstablished({bridge_connect_duration:s,trace_id:null==e?void 0:e.traceId})}catch(s){throw null===(r=this.analytics)||void 0===r||r.emitBridgeClientConnectError({trace_id:null==e?void 0:e.traceId,error_message:String(s)}),s}})}send(e,t,n,r){return W(this,0,void 0,function*(){var s;const i={};"number"==typeof r?i.ttl=r:(i.ttl=null==r?void 0:r.ttl,i.signal=null==r?void 0:r.signal,i.attempts=null==r?void 0:r.attempts,i.traceId=null==r?void 0:r.traceId);const a=new URL(pe(this.bridgeUrl,this.postPath));a.searchParams.append("client_id",this.sessionId),a.searchParams.append("to",t),a.searchParams.append("ttl",((null==i?void 0:i.ttl)||this.defaultTtl).toString()),a.searchParams.append("topic",n),(null==i?void 0:i.traceId)&&a.searchParams.append("trace_id",i.traceId);const o=$.encode(e);yield me(e=>W(this,0,void 0,function*(){const t=yield this.post(a,o,e.signal);if(!t.ok)throw new q(`Bridge send failed, status ${t.status}`)}),{attempts:null!==(s=null==i?void 0:i.attempts)&&void 0!==s?s:Number.MAX_SAFE_INTEGER,delayMs:this.defaultResendDelay,signal:null==i?void 0:i.signal})})}pause(){this.eventSource.dispose().catch(e=>ve(`Bridge pause failed, ${e}`))}unPause(){return W(this,0,void 0,function*(){yield this.eventSource.recreate(0)})}close(){return W(this,0,void 0,function*(){yield this.eventSource.dispose().catch(e=>ve(`Bridge close failed, ${e}`))})}setListener(e){this.listener=e}setErrorsListener(e){this.errorsListener=e}post(e,t,n){return W(this,0,void 0,function*(){const r=yield fetch(e,{method:"post",body:t,signal:n});if(!r.ok)throw new q(`Bridge send failed, status ${r.status}`);return r})}errorsHandler(e,t){return W(this,0,void 0,function*(){if(this.isConnecting)throw e.close(),new q("Bridge error, failed to connect");if(!this.isReady){if(this.isClosed)return e.close(),ye(`Bridge reconnecting, ${this.defaultReconnectDelay}ms delay`),yield this.eventSource.recreate(this.defaultReconnectDelay);throw new q("Bridge error, unknown state")}try{this.errorsListener(t)}catch(t){}})}messagesHandler(e){return W(this,0,void 0,function*(){if(e.data===this.heartbeatMessage)return;if(yield this.bridgeGatewayStorage.storeLastEventId(e.lastEventId),this.isClosed)return;let t;try{const n=JSON.parse(e.data);t={message:n.message,from:n.from,traceId:n.trace_id}}catch(n){throw new q(`Bridge message parse failed, message ${e.data}`)}this.listener(t)})}}function be(e){return!("connectEvent"in e)}let _e;const xe=new Uint8Array(16);const Se=[];for(let Il=0;Il<256;++Il)Se.push((Il+256).toString(16).slice(1));const ke={};function je(e,t,n){let r;{const e=Date.now(),s=function(){if(!_e){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");_e=crypto.getRandomValues.bind(crypto)}return _e(xe)}();!function(e,t,n){var r,s;null!==(r=e.msecs)&&void 0!==r||(e.msecs=-1/0),null!==(s=e.seq)&&void 0!==s||(e.seq=0),t>e.msecs?(e.seq=n[6]<<23|n[7]<<16|n[8]<<8|n[9],e.msecs=t):(e.seq=e.seq+1|0,0===e.seq&&e.msecs++)}(ke,e,s),r=function(e,t,n,r,s=0){if(e.length<16)throw new Error("Random bytes length must be >= 16");if(r){if(s<0||s+16>r.length)throw new RangeError(`UUID byte range ${s}:${s+15} is out of buffer bounds`)}else r=new Uint8Array(16),s=0;return null!=t||(t=Date.now()),null!=n||(n=127*e[6]<<24|e[7]<<16|e[8]<<8|e[9]),r[s++]=t/1099511627776&255,r[s++]=t/4294967296&255,r[s++]=t/16777216&255,r[s++]=t/65536&255,r[s++]=t/256&255,r[s++]=255&t,r[s++]=112|n>>>28&15,r[s++]=n>>>20&255,r[s++]=128|n>>>14&63,r[s++]=n>>>6&255,r[s++]=n<<2&255|3&e[10],r[s++]=e[11],r[s++]=e[12],r[s++]=e[13],r[s++]=e[14],r[s++]=e[15],r}(s,ke.msecs,ke.seq,t,n)}return function(e,t=0){return(Se[e[t+0]]+Se[e[t+1]]+Se[e[t+2]]+Se[e[t+3]]+"-"+Se[e[t+4]]+Se[e[t+5]]+"-"+Se[e[t+6]]+Se[e[t+7]]+"-"+Se[e[t+8]]+Se[e[t+9]]+"-"+Se[e[t+10]]+Se[e[t+11]]+Se[e[t+12]]+Se[e[t+13]]+Se[e[t+14]]+Se[e[t+15]]).toLowerCase()}(r)}class Ee{static fromStorage(e,t){return W(this,0,void 0,function*(){const n=yield e.getHttpConnection();return be(n)?new Ee(e,n.connectionSource,t):new Ee(e,{bridgeUrl:n.session.bridgeUrl},t)})}constructor(e,t,n){var r;this.connectionStorage=e,this.walletConnectionSource=t,this.analyticsManager=n,this.type="http",this.standardUniversalLink="tc://",this.pendingRequests=new Map,this.session=null,this.gateway=null,this.pendingGateways=[],this.listeners=[],this.defaultOpeningDeadlineMS=12e3,this.defaultRetryTimeoutMS=2e3,this.optionalOpenGateways=3,this.analytics=null===(r=this.analyticsManager)||void 0===r?void 0:r.scoped()}connect(e,t){var n,r;const s=null!==(n=null==t?void 0:t.traceId)&&void 0!==n?n:je(),i=ge(null==t?void 0:t.signal);null===(r=this.abortController)||void 0===r||r.abort(),this.abortController=i,this.closeGateways();const a=new M;this.session={sessionCrypto:a,bridgeUrl:"bridgeUrl"in this.walletConnectionSource?this.walletConnectionSource.bridgeUrl:""},this.connectionStorage.storeConnection({type:"http",connectionSource:this.walletConnectionSource,sessionCrypto:a}).then(()=>W(this,0,void 0,function*(){i.signal.aborted||(yield me(e=>{var n;return this.openGateways(a,{openingDeadlineMS:null!==(n=null==t?void 0:t.openingDeadlineMS)&&void 0!==n?n:this.defaultOpeningDeadlineMS,signal:null==e?void 0:e.signal,traceId:s})},{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:i.signal}))}));const o="universalLink"in this.walletConnectionSource&&this.walletConnectionSource.universalLink?this.walletConnectionSource.universalLink:this.standardUniversalLink;return this.generateUniversalLink(o,e,{traceId:s})}restoreConnection(e){return W(this,0,void 0,function*(){var t,n,r;const s=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je(),i=ge(null==e?void 0:e.signal);if(null===(n=this.abortController)||void 0===n||n.abort(),this.abortController=i,i.signal.aborted)return;this.closeGateways();const a=yield this.connectionStorage.getHttpConnection();if(!a)return;if(i.signal.aborted)return;const o=null!==(r=null==e?void 0:e.openingDeadlineMS)&&void 0!==r?r:this.defaultOpeningDeadlineMS;if(be(a))return this.session={sessionCrypto:a.sessionCrypto,bridgeUrl:"bridgeUrl"in this.walletConnectionSource?this.walletConnectionSource.bridgeUrl:""},yield this.openGateways(a.sessionCrypto,{openingDeadlineMS:o,signal:null==i?void 0:i.signal,traceId:null==e?void 0:e.traceId});if(Array.isArray(this.walletConnectionSource))throw new q("Internal error. Connection source is array while WalletConnectionSourceHTTP was expected.");if(this.session=a.session,this.gateway&&(ye("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.gateway=new we(this.connectionStorage.storage,this.walletConnectionSource.bridgeUrl,a.session.sessionCrypto.sessionId,this.gatewayListener.bind(this),this.gatewayErrorsListener.bind(this),this.analyticsManager),!i.signal.aborted){this.listeners.forEach(e=>e(Object.assign(Object.assign({},a.connectEvent),{traceId:s})));try{yield me(e=>this.gateway.registerSession({openingDeadlineMS:o,signal:e.signal,traceId:s}),{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:i.signal})}catch(bl){return void(yield this.disconnect({signal:i.signal,traceId:s}))}}})}sendRequest(e,t){var n;const r={};return"function"==typeof t?r.onRequestSent=t:(r.onRequestSent=null==t?void 0:t.onRequestSent,r.signal=null==t?void 0:t.signal,r.attempts=null==t?void 0:t.attempts,r.traceId=null==t?void 0:t.traceId),null!==(n=r.traceId)&&void 0!==n||(r.traceId=je()),new Promise((t,n)=>W(this,0,void 0,function*(){var s,i;if(!this.gateway||!this.session||!("walletPublicKey"in this.session))throw new q("Trying to send bridge request without session");const a=(yield this.connectionStorage.getNextRpcRequestId()).toString();yield this.connectionStorage.increaseNextRpcRequestId(),ye("Send http-bridge request:",Object.assign(Object.assign({},e),{id:a}));const o=this.session.sessionCrypto.encrypt(JSON.stringify(Object.assign(Object.assign({},e),{id:a})),D(this.session.walletPublicKey));try{null===(s=this.analytics)||void 0===s||s.emitBridgeClientMessageSent({bridge_url:this.gateway.bridgeUrl,client_id:this.session.sessionCrypto.sessionId,wallet_id:this.session.walletPublicKey,message_id:a,request_type:e.method,trace_id:r.traceId}),yield this.gateway.send(o,this.session.walletPublicKey,e.method,{attempts:null==r?void 0:r.attempts,signal:null==r?void 0:r.signal,traceId:r.traceId}),null===(i=null==r?void 0:r.onRequestSent)||void 0===i||i.call(r),this.pendingRequests.set(a.toString(),t)}catch(bl){n(bl)}}))}closeConnection(){this.closeGateways(),this.listeners=[],this.session=null,this.gateway=null}disconnect(e){return W(this,0,void 0,function*(){var t;const n=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je();return new Promise(t=>W(this,0,void 0,function*(){let r=!1,s=null;const i=()=>{r||(r=!0,this.removeBridgeAndSession().then(t))};try{this.closeGateways();const t=ge(null==e?void 0:e.signal);s=setTimeout(()=>{t.abort()},this.defaultOpeningDeadlineMS),yield this.sendRequest({method:"disconnect",params:[]},{onRequestSent:i,signal:t.signal,attempts:1,traceId:n})}catch(bl){ye("Disconnect error:",bl),r||this.removeBridgeAndSession().then(t)}finally{s&&clearTimeout(s),i()}}))})}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(t=>t!==e)}pause(){var e;null===(e=this.gateway)||void 0===e||e.pause(),this.pendingGateways.forEach(e=>e.pause())}unPause(){return W(this,0,void 0,function*(){const e=this.pendingGateways.map(e=>e.unPause());this.gateway&&e.push(this.gateway.unPause()),yield Promise.all(e)})}pendingGatewaysListener(e,t,n){return W(this,0,void 0,function*(){if(this.pendingGateways.includes(e))return this.closeGateways({except:e}),this.gateway&&(ye("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.session.bridgeUrl=t,this.gateway=e,this.gateway.setErrorsListener(this.gatewayErrorsListener.bind(this)),this.gateway.setListener(this.gatewayListener.bind(this)),this.gatewayListener(n);yield e.close()})}gatewayListener(e){return W(this,0,void 0,function*(){var t,n,r;const s=null!==(t=e.traceId)&&void 0!==t?t:je();let i;try{i=JSON.parse(this.session.sessionCrypto.decrypt($.decode(e.message).toUint8Array(),D(e.from)))}catch(l){throw null===(n=this.analytics)||void 0===n||n.emitBridgeClientMessageDecodeError({bridge_url:this.session.bridgeUrl,client_id:this.session.sessionCrypto.sessionId,wallet_id:e.from,error_message:String(l),trace_id:null==e?void 0:e.traceId}),l}ye("Wallet message received:",i);const a="event"in i?i.event:"";if(null===(r=this.analytics)||void 0===r||r.emitBridgeClientMessageReceived({bridge_url:this.session.bridgeUrl,client_id:this.session.sessionCrypto.sessionId,wallet_id:e.from,message_id:String(i.id),request_type:a,trace_id:null==e?void 0:e.traceId}),!("event"in i)){const e=i.id.toString(),t=this.pendingRequests.get(e);return t?(t(Object.assign(Object.assign({},i),{traceId:s})),void this.pendingRequests.delete(e)):void ye(`Response id ${e} doesn't match any request's id`)}if(void 0!==i.id){const e=yield this.connectionStorage.getLastWalletEventId();if(void 0!==e&&i.id<=e)return void ve(`Received event id (=${i.id}) must be greater than stored last wallet event id (=${e}) `);"connect"!==i.event&&(yield this.connectionStorage.storeLastWalletEventId(i.id))}const o=this.listeners;"connect"===i.event&&(yield this.updateSession(i,e.from)),"disconnect"===i.event&&(ye("Removing bridge and session: received disconnect event"),yield this.removeBridgeAndSession()),o.forEach(e=>e(Object.assign(Object.assign({},i),{traceId:s})))})}gatewayErrorsListener(e){return W(this,0,void 0,function*(){throw new q(`Bridge error ${JSON.stringify(e)}`)})}updateSession(e,t){return W(this,0,void 0,function*(){this.session=Object.assign(Object.assign({},this.session),{walletPublicKey:t});const n=e.payload.items.find(e=>"ton_addr"===e.name),r=Object.assign(Object.assign({},e),{payload:Object.assign(Object.assign({},e.payload),{items:[n]})});yield this.connectionStorage.storeConnection({type:"http",session:this.session,lastWalletEventId:e.id,connectEvent:r,nextRpcRequestId:0})})}removeBridgeAndSession(){return W(this,0,void 0,function*(){this.closeConnection(),yield this.connectionStorage.removeConnection()})}generateUniversalLink(e,t,n){return function(e){if(!e)return!1;const t=new URL(e);return"tg:"===t.protocol||"t.me"===t.hostname}(e)?this.generateTGUniversalLink(e,t,n):this.generateRegularUniversalLink(e,t,n)}generateRegularUniversalLink(e,t,n){const r=new URL(e);return r.searchParams.append("v",2..toString()),r.searchParams.append("id",this.session.sessionCrypto.sessionId),r.searchParams.append("trace_id",n.traceId),r.searchParams.append("r",JSON.stringify(t)),r.toString()}generateTGUniversalLink(e,t,n){const r=this.generateRegularUniversalLink("about:blank",t,n).split("?")[1],s="tonconnect-"+r.replaceAll(".","%2E").replaceAll("-","%2D").replaceAll("_","%5F").replaceAll("&","-").replaceAll("=","__").replaceAll("%","--");const i=this.convertToDirectLink(e),a=new URL(i);return a.searchParams.append("startapp",s),a.toString()}convertToDirectLink(e){const t=new URL(e);return t.searchParams.has("attach")&&(t.searchParams.delete("attach"),t.pathname+="/start"),t.toString()}openGateways(e,t){return W(this,0,void 0,function*(){var n;const r=null!==(n=null==t?void 0:t.traceId)&&void 0!==n?n:je();if(Array.isArray(this.walletConnectionSource)){this.pendingGateways.map(e=>e.close().catch()),this.pendingGateways=this.walletConnectionSource.map(t=>{const n=new we(this.connectionStorage.storage,t.bridgeUrl,e.sessionId,()=>{},()=>{},this.analyticsManager);return n.setListener(e=>this.pendingGatewaysListener(n,t.bridgeUrl,e)),n});const n=Math.max(this.pendingGateways.length-this.optionalOpenGateways,1);return void(yield function(e,t){return W(this,0,void 0,function*(){if(t<=0)return[];if(t>e.length)throw new RangeError("count cannot be greater than the number of promises");const n=new Array(e.length);let r=0;return new Promise(s=>{e.forEach((e,i)=>{Promise.resolve(e).then(e=>({status:"fulfilled",value:e})).catch(e=>({status:"rejected",reason:e})).then(e=>{n[i]=e,r++,r===t&&s(n)})})})})}(this.pendingGateways.map(e=>me(n=>{var s;return this.pendingGateways.some(t=>t===e)?e.registerSession({openingDeadlineMS:null!==(s=null==t?void 0:t.openingDeadlineMS)&&void 0!==s?s:this.defaultOpeningDeadlineMS,signal:n.signal,traceId:r}):e.close()},{attempts:Number.MAX_SAFE_INTEGER,delayMs:this.defaultRetryTimeoutMS,signal:null==t?void 0:t.signal})),n))}return this.gateway&&(ye("Gateway is already opened, closing previous gateway"),yield this.gateway.close()),this.gateway=new we(this.connectionStorage.storage,this.walletConnectionSource.bridgeUrl,e.sessionId,this.gatewayListener.bind(this),this.gatewayErrorsListener.bind(this),this.analyticsManager),yield this.gateway.registerSession({openingDeadlineMS:null==t?void 0:t.openingDeadlineMS,signal:null==t?void 0:t.signal,traceId:r})})}closeGateways(e){var t;null===(t=this.gateway)||void 0===t||t.close(),this.pendingGateways.filter(t=>t!==(null==e?void 0:e.except)).forEach(e=>e.close()),this.pendingGateways=[]}}function Te(e,t){return Re(e,[t])}function Re(e,t){return!(!e||"object"!=typeof e)&&t.every(t=>t in e)}class Ce{static getInstance(){return Ce.instance||(Ce.instance=new Ce),Ce.instance}constructor(){this.storage={}}get length(){return Object.keys(this.storage).length}clear(){this.storage={}}getItem(e){var t;return null!==(t=this.storage[e])&&void 0!==t?t:null}key(e){var t;const n=Object.keys(this.storage);return e<0||e>=n.length?null:null!==(t=n[e])&&void 0!==t?t:null}removeItem(e){delete this.storage[e]}setItem(e,t){this.storage[e]=t}}function Oe(){if("undefined"!=typeof window)return window}function Ie(){if("undefined"!=typeof document)return document}function Ne(){var e,t,n,r;const s=null===(t=null===(e=Oe())||void 0===e?void 0:e.location)||void 0===t?void 0:t.origin,i=null===(r=null===(n=Oe())||void 0===n?void 0:n.location)||void 0===r?void 0:r.pathname;return s&&i?s+i:""}function Ae(){if(function(){try{return"undefined"!=typeof localStorage}catch(e){return!1}}())return localStorage;if("undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node)throw new q("`localStorage` is unavailable, but it is required for TonConnect. For more details, see https://github.com/ton-connect/sdk/tree/main/packages/sdk#init-connector");return Ce.getInstance()}class Pe{static fromStorage(e,t){return W(this,0,void 0,function*(){const n=yield e.getInjectedConnection();return new Pe(e,n.jsBridgeKey,t)})}static isWalletInjected(e){return Pe.isWindowContainsWallet(this.window,e)}static isInsideWalletBrowser(e){return!!Pe.isWindowContainsWallet(this.window,e)&&this.window[e].tonconnect.isWalletBrowser}static getCurrentlyInjectedWallets(){if(!this.window)return[];return function(){const e=Oe();if(!e)return[];try{return Object.entries(e)}catch(t){return[]}}().filter(([e,t])=>function(e){try{return!(!Te(e,"tonconnect")||!Te(e.tonconnect,"walletInfo"))&&Re(e.tonconnect.walletInfo,["name","app_name","image","about_url","platforms"])}catch(t){return!1}}(t)).map(([e,t])=>({name:t.tonconnect.walletInfo.name,appName:t.tonconnect.walletInfo.app_name,aboutUrl:t.tonconnect.walletInfo.about_url,imageUrl:t.tonconnect.walletInfo.image,tondns:t.tonconnect.walletInfo.tondns,jsBridgeKey:e,injected:!0,embedded:t.tonconnect.isWalletBrowser,platforms:t.tonconnect.walletInfo.platforms,features:t.tonconnect.walletInfo.features}))}static isWindowContainsWallet(e,t){return!!e&&t in e&&"object"==typeof e[t]&&"tonconnect"in e[t]}constructor(e,t,n){this.connectionStorage=e,this.injectedWalletKey=t,this.type="injected",this.unsubscribeCallback=null,this.listenSubscriptions=!1,this.listeners=[];const r=Pe.window;if(!Pe.isWindowContainsWallet(r,t))throw new J;this.injectedWallet=r[t].tonconnect,n&&(this.analytics=n.scoped({bridge_key:t,wallet_app_name:this.injectedWallet.deviceInfo.appName,wallet_app_version:this.injectedWallet.deviceInfo.appVersion}))}connect(e,t){this._connect(2,e,t)}restoreConnection(e){return W(this,0,void 0,function*(){var t,n,r,s;const i=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je();try{ye("Injected Provider restoring connection..."),null===(n=this.analytics)||void 0===n||n.emitJsBridgeCall({js_bridge_method:"restoreConnection",trace_id:i});const e=yield this.injectedWallet.restoreConnection();null===(r=this.analytics)||void 0===r||r.emitJsBridgeResponse({js_bridge_method:"restoreConnection",trace_id:i}),ye("Injected Provider restoring connection response",e),"connect"===e.event?(this.makeSubscriptions({traceId:i}),this.listeners.forEach(t=>t(Object.assign(Object.assign({},e),{traceId:i})))):yield this.connectionStorage.removeConnection()}catch(bl){null===(s=this.analytics)||void 0===s||s.emitJsBridgeError({js_bridge_method:"restoreConnection",error_message:String(bl),trace_id:i}),yield this.connectionStorage.removeConnection(),console.error(bl)}})}closeConnection(){this.listenSubscriptions&&this.injectedWallet.disconnect(),this.closeAllListeners()}disconnect(e){return W(this,0,void 0,function*(){var t;const n=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je();return new Promise(e=>{const t=()=>{this.closeAllListeners(),this.connectionStorage.removeConnection().then(e)};try{this.injectedWallet.disconnect(),t()}catch(bl){ye(bl),this.sendRequest({method:"disconnect",params:[]},{onRequestSent:t,traceId:n})}})})}closeAllListeners(){var e;this.listenSubscriptions=!1,this.listeners=[],null===(e=this.unsubscribeCallback)||void 0===e||e.call(this)}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(t=>t!==e)}sendRequest(e,t){return W(this,0,void 0,function*(){var n,r,s;const i={};"function"==typeof t?(i.onRequestSent=t,i.traceId=je()):(i.onRequestSent=null==t?void 0:t.onRequestSent,i.signal=null==t?void 0:t.signal,i.attempts=null==t?void 0:t.attempts,i.traceId=null!==(n=null==t?void 0:t.traceId)&&void 0!==n?n:je());const a=(yield this.connectionStorage.getNextRpcRequestId()).toString();yield this.connectionStorage.increaseNextRpcRequestId(),ye("Send injected-bridge request:",Object.assign(Object.assign({},e),{id:a})),null===(r=this.analytics)||void 0===r||r.emitJsBridgeCall({js_bridge_method:"send"});const o=this.injectedWallet.send(Object.assign(Object.assign({},e),{id:a}));return o.then(e=>{var t;null===(t=this.analytics)||void 0===t||t.emitJsBridgeResponse({js_bridge_method:"send"}),ye("Wallet message received:",e)}).catch(e=>{var t;null===(t=this.analytics)||void 0===t||t.emitJsBridgeError({js_bridge_method:"send",error_message:String(e)})}),null===(s=null==i?void 0:i.onRequestSent)||void 0===s||s.call(i),o})}_connect(e,t,n){return W(this,0,void 0,function*(){var r,s,i,a;const o=null!==(r=null==n?void 0:n.traceId)&&void 0!==r?r:je();try{ye(`Injected Provider connect request: protocolVersion: ${e}, message:`,t),null===(s=this.analytics)||void 0===s||s.emitJsBridgeCall({js_bridge_method:"connect",trace_id:o});const n=yield this.injectedWallet.connect(e,t);null===(i=this.analytics)||void 0===i||i.emitJsBridgeResponse({js_bridge_method:"connect"}),ye("Injected Provider connect response:",n),"connect"===n.event&&(yield this.updateSession(),this.makeSubscriptions({traceId:o})),this.listeners.forEach(e=>e(Object.assign(Object.assign({},n),{traceId:o})))}catch(bl){null===(a=this.analytics)||void 0===a||a.emitJsBridgeError({js_bridge_method:"connect",error_message:String(bl),trace_id:o}),ye("Injected Provider connect error:",bl);const t={event:"connect_error",payload:{code:0,message:null==bl?void 0:bl.toString()}};this.listeners.forEach(e=>e(Object.assign(Object.assign({},t),{traceId:o})))}})}makeSubscriptions(e){var t,n,r;this.listenSubscriptions=!0,null===(t=this.analytics)||void 0===t||t.emitJsBridgeCall({js_bridge_method:"listen",trace_id:e.traceId});try{this.unsubscribeCallback=this.injectedWallet.listen(e=>{var t;const n=null!==(t=e.traceId)&&void 0!==t?t:je();ye("Wallet message received:",e),this.listenSubscriptions&&this.listeners.forEach(t=>t(Object.assign(Object.assign({},e),{traceId:n}))),"disconnect"===e.event&&this.disconnect({traceId:n})}),null===(n=this.analytics)||void 0===n||n.emitJsBridgeResponse({js_bridge_method:"listen",trace_id:e.traceId})}catch(s){throw null===(r=this.analytics)||void 0===r||r.emitJsBridgeError({js_bridge_method:"listen",error_message:String(s),trace_id:e.traceId}),s}}updateSession(){return this.connectionStorage.storeConnection({type:"injected",jsBridgeKey:this.injectedWalletKey,nextRpcRequestId:0})}}Pe.window=Oe();class Ue{constructor(e,t){this.storage=e,this.walletsListManager=t,this.storeKey="ton-connect-storage_bridge-connection"}storeConnection(e){return W(this,0,void 0,function*(){if("injected"===e.type||"wallet-connect"===e.type)return this.storage.setItem(this.storeKey,JSON.stringify(e));if(!be(e)){const t={sessionKeyPair:e.session.sessionCrypto.stringifyKeypair(),walletPublicKey:e.session.walletPublicKey,bridgeUrl:e.session.bridgeUrl},n={type:"http",connectEvent:e.connectEvent,session:t,lastWalletEventId:e.lastWalletEventId,nextRpcRequestId:e.nextRpcRequestId};return this.storage.setItem(this.storeKey,JSON.stringify(n))}const t={type:"http",connectionSource:e.connectionSource,sessionCrypto:e.sessionCrypto.stringifyKeypair(),createdAt:Date.now()};return this.storage.setItem(this.storeKey,JSON.stringify(t))})}removeConnection(){return W(this,0,void 0,function*(){return this.storage.removeItem(this.storeKey)})}getConnection(){return W(this,0,void 0,function*(){try{const e=yield this.storage.getItem(this.storeKey);if(!e)return null;const t=JSON.parse(e);if("injected"===t.type||"wallet-connect"===t.type)return t;if(!function(e){return!("connectEvent"in e)}(t)){const e=new M(t.session.sessionKeyPair);return yield this.actualizeBridgeConnection({type:"http",connectEvent:t.connectEvent,lastWalletEventId:t.lastWalletEventId,nextRpcRequestId:t.nextRpcRequestId,session:{sessionCrypto:e,bridgeUrl:t.session.bridgeUrl,walletPublicKey:t.session.walletPublicKey}})}return function(e){var t;return Date.now()-(null!==(t=e.createdAt)&&void 0!==t?t:0)>3e5}(t)?(yield this.removeConnection(),null):{type:"http",sessionCrypto:new M(t.sessionCrypto),connectionSource:t.connectionSource}}catch(e){return ye("Error retrieving connection",e),null}})}getHttpConnection(){return W(this,0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new q("Trying to read HTTP connection source while nothing is stored");if("http"!==e.type)throw new q(`Trying to read HTTP connection source while ${e.type} connection is stored`);return e})}getHttpPendingConnection(){return W(this,0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new q("Trying to read HTTP connection source while nothing is stored");if("http"!==e.type)throw new q(`Trying to read HTTP connection source while ${e.type} connection is stored`);if(!be(e))throw new q("Trying to read HTTP-pending connection while http connection is stored");return e})}getInjectedConnection(){return W(this,0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new q("Trying to read Injected bridge connection source while nothing is stored");if("injected"!==(null==e?void 0:e.type))throw new q(`Trying to read Injected bridge connection source while ${e.type} connection is stored`);return e})}getWalletConnectConnection(){return W(this,0,void 0,function*(){const e=yield this.getConnection();if(!e)throw new q("Trying to read wallet connect bridge connection source while nothing is stored");if("wallet-connect"!==(null==e?void 0:e.type))throw new q(`Trying to read wallet connect bridge connection source while ${e.type} connection is stored`);return e})}storedConnectionType(){return W(this,0,void 0,function*(){const e=yield this.storage.getItem(this.storeKey);if(!e)return null;return JSON.parse(e).type})}storeLastWalletEventId(e){return W(this,0,void 0,function*(){const t=yield this.getConnection();if(t&&"http"===t.type&&!be(t))return t.lastWalletEventId=e,this.storeConnection(t)})}getLastWalletEventId(){return W(this,0,void 0,function*(){const e=yield this.getConnection();if(e&&"lastWalletEventId"in e)return e.lastWalletEventId})}increaseNextRpcRequestId(){return W(this,0,void 0,function*(){const e=yield this.getConnection();if(e&&"nextRpcRequestId"in e){const t=e.nextRpcRequestId||0;return e.nextRpcRequestId=t+1,this.storeConnection(e)}})}getNextRpcRequestId(){return W(this,0,void 0,function*(){const e=yield this.getConnection();return e&&"nextRpcRequestId"in e&&e.nextRpcRequestId||0})}actualizeBridgeConnection(e){return W(this,0,void 0,function*(){try{const t=e.connectEvent.payload.device.appName,n=yield this.walletsListManager.getRemoteWallet(t);if(n.bridgeUrl===e.session.bridgeUrl)return e;const r=Object.assign(Object.assign({},e),{session:Object.assign(Object.assign({},e.session),{bridgeUrl:n.bridgeUrl})});return yield this.storeConnection(r),r}catch(t){return ye("Failed to actualize bridge connection",t),e}})}}class $e{constructor(){this.localStorage=Ae()}getItem(e){return W(this,0,void 0,function*(){return this.localStorage.getItem(e)})}removeItem(e){return W(this,0,void 0,function*(){this.localStorage.removeItem(e)})}setItem(e,t){return W(this,0,void 0,function*(){this.localStorage.setItem(e,t)})}}function Le(e){return function(e){return function(e){return"jsBridgeKey"in e}(e)&&e.injected}(e)&&e.embedded}const De=[{app_name:"telegram-wallet",name:"Wallet",image:"https://wallet.tg/images/logo-288.png",about_url:"https://wallet.tg/",universal_url:"https://t.me/wallet?attach=wallet",bridge:[{type:"sse",url:"https://walletbot.me/tonconnect-bridge/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!0},{name:"SignData",types:["text","binary","cell"]}]},{app_name:"tonkeeper",name:"Tonkeeper",image:"https://tonkeeper.com/assets/tonconnect-icon.png",tondns:"tonkeeper.ton",about_url:"https://tonkeeper.com",universal_url:"https://app.tonkeeper.com/ton-connect",deepLink:"tonkeeper-tc://",bridge:[{type:"sse",url:"https://bridge.tonapi.io/bridge"},{type:"js",key:"tonkeeper"}],platforms:["ios","android","chrome","firefox","macos"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!0},{name:"SignData",types:["text","binary","cell"]}]},{app_name:"mytonwallet",name:"MyTonWallet",image:"https://static.mytonwallet.io/icon-256.png",about_url:"https://mytonwallet.io",universal_url:"https://connect.mytonwallet.org",deepLink:"mytonwallet-tc://",bridge:[{type:"js",key:"mytonwallet"},{type:"sse",url:"https://tonconnectbridge.mytonwallet.org/bridge/"}],platforms:["chrome","windows","macos","linux","ios","android","firefox"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1},{name:"SignData",types:["text","binary","cell"]}]},{app_name:"tonhub",name:"Tonhub",image:"https://tonhub.com/tonconnect_logo.png",about_url:"https://tonhub.com",universal_url:"https://tonhub.com/ton-connect",bridge:[{type:"js",key:"tonhub"},{type:"sse",url:"https://connect.tonhubapi.com/tonconnect"}],platforms:["ios","android"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!0},{name:"SignData",types:["text","binary","cell"]}]},{app_name:"bitgetTonWallet",name:"Bitget Wallet",image:"https://raw.githubusercontent.com/bitgetwallet/download/refs/heads/main/logo/png/bitget_wallet_logo_288_mini.png",about_url:"https://web3.bitget.com",deepLink:"bitkeep://",bridge:[{type:"js",key:"bitgetTonWallet"},{type:"sse",url:"https://ton-connect-bridge.bgwapi.io/bridge"}],platforms:["ios","android","chrome"],universal_url:"https://bkcode.vip/ton-connect",features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"okxMiniWallet",name:"OKX Mini Wallet",image:"https://static.okx.com/cdn/assets/imgs/2411/8BE1A4A434D8F58A.png",about_url:"https://www.okx.com/web3",universal_url:"https://t.me/OKX_WALLET_BOT?attach=wallet",bridge:[{type:"sse",url:"https://www.okx.com/tonbridge/discover/rpc/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"binanceWeb3TonWallet",name:"Binance Wallet",image:"https://public.bnbstatic.com/static/binance-w3w/ton-provider/binancew3w.png",about_url:"https://www.binance.com/en/web3wallet",deepLink:"bnc://app.binance.com/cedefi/ton-connect",bridge:[{type:"js",key:"binancew3w"},{type:"sse",url:"https://wallet.binance.com/tonbridge/bridge"}],platforms:["ios","android","macos","windows","linux"],universal_url:"https://app.binance.com/cedefi/ton-connect",features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"fintopio-tg",name:"Fintopio",image:"https://raw.githubusercontent.com/fintopio/ton-pub/refs/heads/main/logos/tonconnect-icon.png",about_url:"https://fintopio.com",universal_url:"https://t.me/fintopio?attach=wallet",bridge:[{type:"sse",url:"https://wallet-bridge.fintopio.com/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"okxTonWallet",name:"OKX Wallet",image:"https://static.okx.com/cdn/assets/imgs/247/58E63FEA47A2B7D7.png",about_url:"https://www.okx.com/web3",universal_url:"https://www.okx.com/download?appendQuery=true&deeplink=okx://web3/wallet/tonconnect",bridge:[{type:"js",key:"okxTonWallet"},{type:"sse",url:"https://www.okx.com/tonbridge/discover/rpc/bridge"}],platforms:["chrome","safari","firefox","ios","android"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"hot",name:"HOT",image:"https://raw.githubusercontent.com/hot-dao/media/main/logo.png",about_url:"https://hot-labs.org/",universal_url:"https://t.me/herewalletbot?attach=wallet",bridge:[{type:"sse",url:"https://sse-bridge.hot-labs.org"},{type:"js",key:"hotWallet"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"bybitTonWallet",name:"Bybit Wallet",image:"https://raw.githubusercontent.com/bybit-web3/bybit-web3.github.io/main/docs/images/bybit-logo.png",about_url:"https://www.bybit.com/web3",universal_url:"https://app.bybit.com/ton-connect",deepLink:"bybitapp://",bridge:[{type:"js",key:"bybitTonWallet"},{type:"sse",url:"https://api-node.bybit.com/spot/api/web3/bridge/ton/bridge"}],platforms:["ios","android","chrome"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"dewallet",name:"DeWallet",image:"https://raw.githubusercontent.com/delab-team/manifests-images/main/WalletAvatar.png",about_url:"https://delabwallet.com",universal_url:"https://t.me/dewallet?attach=wallet",bridge:[{type:"sse",url:"https://bridge.dewallet.pro/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"safepalwallet",name:"SafePal",image:"https://s.pvcliping.com/web/public_image/SafePal_x288.png",tondns:"",about_url:"https://www.safepal.com",universal_url:"https://link.safepal.io/ton-connect",deepLink:"safepal-tc://",bridge:[{type:"sse",url:"https://ton-bridge.safepal.com/tonbridge/v1/bridge"},{type:"js",key:"safepalwallet"}],platforms:["ios","android","chrome","firefox"],features:[{name:"SendTransaction",maxMessages:1,extraCurrencySupported:!1}]},{app_name:"GateWallet",name:"GateWallet",image:"https://img.gatedataimg.com/prd-ordinal-imgs/036f07bb8730716e/gateio-0925.png",about_url:"https://www.gate.io/",bridge:[{type:"js",key:"gatetonwallet"},{type:"sse",url:"https://dapp.gateio.services/tonbridge_api/bridge/v1"}],platforms:["ios","android"],universal_url:"https://gate.onelink.me/Hls0/web3?gate_web3_wallet_universal_type=ton_connect",features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"openmask",name:"OpenMask",image:"https://raw.githubusercontent.com/OpenProduct/openmask-extension/main/public/openmask-logo-288.png",about_url:"https://www.openmask.app/",bridge:[{type:"js",key:"openmask"}],platforms:["chrome"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"BitgetWeb3",name:"BitgetWeb3",image:"https://img.bitgetimg.com/image/third/1731638059795.png",about_url:"https://www.bitget.com",universal_url:"https://t.me/BitgetOfficialBot?attach=wallet",bridge:[{type:"sse",url:"https://ton-connect-bridge.bgwapi.io/bridge"}],platforms:["ios","android","windows","macos","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"xtonwallet",name:"XTONWallet",image:"https://xtonwallet.com/assets/img/icon-256-back.png",about_url:"https://xtonwallet.com",bridge:[{type:"js",key:"xtonwallet"}],platforms:["chrome","firefox"],features:[{name:"SendTransaction",maxMessages:1,extraCurrencySupported:!1}]},{app_name:"tonwallet",name:"TON Wallet",image:"https://wallet.ton.org/assets/ui/qr-logo.png",about_url:"https://chrome.google.com/webstore/detail/ton-wallet/nphplpgoakhhjchkkhmiggakijnkhfnd",bridge:[{type:"js",key:"tonwallet"}],platforms:["chrome"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"bitgetWalletLite",name:"Bitget Wallet Lite",image:"https://raw.githubusercontent.com/bitgetwallet/download/refs/heads/main/logo/png/bitget_wallet_lite_logo_288.png",about_url:"https://web3.bitget.com",universal_url:"https://t.me/BitgetWallet_TGBot?attach=wallet",bridge:[{type:"sse",url:"https://ton-connect-bridge.bgwapi.io/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1}]},{app_name:"tomoWallet",name:"Tomo Wallet",image:"https://pub.tomo.inc/logo.png",about_url:"https://www.tomo.inc/",universal_url:"https://t.me/tomowalletbot?attach=wallet",bridge:[{type:"sse",url:"https://go-bridge.tomo.inc/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"miraiapp-tg",name:"Mirai Mini App",image:"https://cdn.mirailabs.co/miraihub/miraiapp-tg-icon-288.png",about_url:"https://mirai.app",universal_url:"https://t.me/MiraiAppBot?attach=wallet",bridge:[{type:"sse",url:"https://bridge.mirai.app"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1},{name:"SignData",types:["text","binary","cell"]}]},{app_name:"Architec.ton",name:"Architec.ton",image:"https://raw.githubusercontent.com/Architec-Ton/wallet-tma/refs/heads/dev/public/images/arcwallet_logo.png",about_url:"https://architecton.tech",universal_url:"https://t.me/architec_ton_bot?attach=wallet",bridge:[{type:"sse",url:"https://tc.architecton.su/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1}]},{app_name:"tokenpocket",name:"TokenPocket",image:"https://hk.tpstatic.net/logo/tokenpocket.png",about_url:"https://www.tokenpocket.pro",universal_url:"https://tp-lab.tptool.pro/ton-connect/",bridge:[{type:"js",key:"tokenpocket"},{type:"sse",url:"https://ton-connect.mytokenpocket.vip/bridge"}],platforms:["ios","android"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"uxuyWallet",name:"UXUY Wallet",image:"https://chain-cdn.uxuy.com/logo/square_288.png",about_url:"https://docs.uxuy.com",universal_url:"https://t.me/UXUYbot?attach=wallet",bridge:[{type:"sse",url:"https://bridge.uxuy.me/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"tonkeeper-pro",name:"Tonkeeper Pro",image:"https://tonkeeper.com/assets/tonconnect-icon-pro.png",tondns:"tonkeeper.ton",about_url:"https://tonkeeper.com/pro",universal_url:"https://app.tonkeeper.com/pro/ton-connect",deepLink:"tonkeeper-pro-tc://",bridge:[{type:"sse",url:"https://bridge.tonapi.io/bridge"}],platforms:["ios","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!0},{name:"SignData",types:["text","binary","cell"]}]},{app_name:"nicegramWallet",name:"Nicegram Wallet",image:"https://static.nicegram.app/icon.png",about_url:"https://nicegram.app",universal_url:"https://nicegram.app/tc",deepLink:"nicegram-tc://",bridge:[{type:"sse",url:"https://tc.nicegram.app/bridge"},{type:"js",key:"nicegramWallet"}],platforms:["ios","android"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1}]},{app_name:"echoooTonWallet",name:"EchoooWallet",image:"https://cdn.echooo.xyz/front-end/source/images/logo/echooo-ton.png",about_url:"https://www.echooo.xyz",universal_url:"https://www.echooo.xyz/ton-connect",deepLink:"echooo://",bridge:[{type:"js",key:"echoooTonWallet"},{type:"sse",url:"https://ton-connect-bridge.echooo.link/bridge"}],platforms:["ios","android"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1}]},{app_name:"blitzwallet",name:"BLITZ wallet",image:"https://blitzwallet.cfd/wallet/public/logo.png",about_url:"https://blitzwallet.cfd",universal_url:"https://t.me/blitz_wallet_bot?attach=wallet",bridge:[{type:"sse",url:"https://blitzwallet.cfd/bridge/"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]},{app_name:"koloWeb3Wallet",name:"Kolo",image:"https://raw.githubusercontent.com/onidev1/tc-assets/refs/heads/main/kolo_logo_288.png",about_url:"https://kolo.xyz",universal_url:"https://t.me/kolo?attach=wallet",bridge:[{type:"sse",url:"https://web3-bridge.kolo.in/bridge"}],platforms:["ios","android","macos","windows","linux"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1}]},{app_name:"imToken",name:"imToken",image:"https://aws-v2-cdn.token.im/orbit/token-v2/icons/logo-ton-connect.png",about_url:"https://token.im",universal_url:"https://connect.token.im/link/ton-connect",deepLink:"imtokenv2://link/ton-connect",bridge:[{type:"sse",url:"https://connect.token.im/tonbridge"},{type:"js",key:"imToken"}],platforms:["ios","android"],features:[{name:"SendTransaction",maxMessages:255,extraCurrencySupported:!1}]},{app_name:"cactuslink",name:"Cactus Link",image:"https://downloads.mycactus.com/288_cactus_link.png",about_url:"https://www.mycactus.com/defi-connector",bridge:[{type:"js",key:"cactuslink_ton"}],platforms:["chrome"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1},{name:"SignData",types:["text","binary"]}]},{app_name:"onekey",name:"OneKey",image:"https://uni.onekey-asset.com/static/logo/onekey-x288.png",about_url:"https://onekey.so",bridge:[{type:"js",key:"onekeyTonWallet"}],platforms:["chrome"],features:[{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}]}];class Me{constructor(e){var t;this.walletsListDTOCache=null,this.walletsListDTOCacheCreationTimestamp=null,this.walletsListSource=null!==(t=null==e?void 0:e.walletsListSource)&&void 0!==t?t:"https://config.ton.org/wallets-v2.json",this.cacheTTLMs=null==e?void 0:e.cacheTTLMs,this.onDownloadDurationMeasured=null==e?void 0:e.onDownloadDurationMeasured}getWallets(){return W(this,0,void 0,function*(){const[e,t]=yield Promise.all([this.fetchWalletsListDTO(),this.getCurrentlyInjectedWallets()]);return this.mergeWalletsLists(this.walletConfigDTOListToWalletConfigList(e),t)})}getEmbeddedWallet(){return W(this,0,void 0,function*(){const e=(yield this.getWallets()).filter(Le);return 1===e.length?e[0]:null})}fetchWalletsListDTO(){return W(this,0,void 0,function*(){return this.cacheTTLMs&&this.walletsListDTOCacheCreationTimestamp&&Date.now()>this.walletsListDTOCacheCreationTimestamp+this.cacheTTLMs&&(this.walletsListDTOCache=null),this.walletsListDTOCache||(this.walletsListDTOCache=this.fetchWalletsListFromSource(),this.walletsListDTOCache.then(()=>{this.walletsListDTOCacheCreationTimestamp=Date.now()}).catch(()=>{this.walletsListDTOCache=null,this.walletsListDTOCacheCreationTimestamp=null})),this.walletsListDTOCache})}getRemoteWallet(e){return W(this,0,void 0,function*(){const t=(yield this.getWallets()).find(t=>t.appName===e);if(!t)throw new q(`Wallet info not found for appName: "${e}"`);if(!("bridgeUrl"in t))throw new q(`Wallet "${e}" is not remote`);return t})}fetchWalletsListFromSource(){return W(this,0,void 0,function*(){var e,t;let n=[];const r=performance.now();try{const t=yield fetch(this.walletsListSource);if(n=yield t.json(),!Array.isArray(n))throw new te("Wrong wallets list format, wallets list must be an array.");const s=n.filter(e=>!this.isCorrectWalletConfigDTO(e));s.length&&(ve(`Wallet(s) ${s.map(e=>(null==e?void 0:e.name)||"unknown").join(", ")} config format is wrong. They were removed from the wallets list.`),n=n.filter(e=>this.isCorrectWalletConfigDTO(e)));const i=performance.now(),a=Math.round(i-r);null===(e=this.onDownloadDurationMeasured)||void 0===e||e.call(this,a)}catch(bl){ve(bl),n=De,null===(t=this.onDownloadDurationMeasured)||void 0===t||t.call(this,void 0)}return n})}getCurrentlyInjectedWallets(){return[]}walletConfigDTOListToWalletConfigList(e){return e.map(e=>{const t={name:e.name,appName:e.app_name,imageUrl:e.image,aboutUrl:e.about_url,tondns:e.tondns,platforms:e.platforms,features:e.features};return e.bridge.forEach(n=>{if("sse"===n.type&&(t.bridgeUrl=n.url,t.universalLink=e.universal_url,t.deepLink=e.deepLink),"js"===n.type){const e=n.key;t.jsBridgeKey=e,t.injected=Pe.isWalletInjected(e),t.embedded=Pe.isInsideWalletBrowser(e)}}),t})}mergeWalletsLists(e,t){return[...new Set(e.concat(t).map(e=>e.name)).values()].map(n=>{const r=e.find(e=>e.name===n),s=t.find(e=>e.name===n);return Object.assign(Object.assign({},r&&Object.assign({},r)),s&&Object.assign({},s))})}isCorrectWalletConfigDTO(e){if(!e||"object"!=typeof e)return!1;if(!("name"in e&&"image"in e&&"about_url"in e&&"platforms"in e&&"app_name"in e))return!1;if(!e.platforms||!Array.isArray(e.platforms)||!e.platforms.length)return!1;if(!("bridge"in e)||!Array.isArray(e.bridge)||!e.bridge.length)return!1;const t=e.bridge;if(t.some(e=>!e||"object"!=typeof e||!("type"in e)))return!1;const n=t.find(e=>"sse"===e.type);if(n&&("object"!=typeof n||!("url"in n)||!n.url||!e.universal_url))return!1;const r=t.find(e=>"js"===e.type);return!!(!r||"object"==typeof r&&"key"in r&&r.key)}}function Be(e,t){const n=e.includes("SendTransaction"),r=qe(e,"SendTransaction"),s={minMessages:t.requiredMessagesNumber,extraCurrencyRequired:t.requireExtraCurrencies};if(!n&&!r)throw new V("Wallet doesn't support SendTransaction feature.",{cause:{requiredFeature:{featureName:"SendTransaction",value:s}}});if(t.requireExtraCurrencies&&(!r||!r.extraCurrencySupported))throw new V("Wallet is not able to handle such SendTransaction request. Extra currencies support is required.",{cause:{requiredFeature:{featureName:"SendTransaction",value:s}}});if(r&&void 0!==r.maxMessages){if(r.maxMessages<t.requiredMessagesNumber)throw new V(`Wallet is not able to handle such SendTransaction request. Max support messages number is ${r.maxMessages}, but ${t.requiredMessagesNumber} is required.`,{cause:{requiredFeature:{featureName:"SendTransaction",value:s}}})}else!function(...e){try{console.warn("[TON_CONNECT_SDK]",...e)}catch(t){}}("Connected wallet didn't provide information about max allowed messages in the SendTransaction request. Request may be rejected by the wallet.")}function We(e,t){if("object"!=typeof t)return!0;const{sendTransaction:n,signData:r}=t;if(n){const t=qe(e,"SendTransaction");if(!t)return!1;if(!function(e,t){const n=void 0===t.minMessages||t.minMessages<=e.maxMessages,r=!t.extraCurrencyRequired||e.extraCurrencySupported;return!(!n||!r)}(t,n))return!1}if(r){const t=qe(e,"SignData");if(!t)return!1;if(!function(e,t){return t.types.every(t=>e.types.includes(t))}(t,r))return!1}return!0}function qe(e,t){return e.find(e=>e&&"object"==typeof e&&e.name===t)}function Ke(e){return{ton_connect_sdk_lib:e.ton_connect_sdk_lib,ton_connect_ui_lib:e.ton_connect_ui_lib}}function ze(e,t,n){var r,s,i,a,o,l,c,u,d,h,p;const f=(null===(r=null==t?void 0:t.connectItems)||void 0===r?void 0:r.tonProof)&&"proof"in t.connectItems.tonProof?"ton_proof":"ton_addr";return{wallet_address:null!==(i=null===(s=null==t?void 0:t.account)||void 0===s?void 0:s.address)&&void 0!==i?i:null,wallet_state_init:null!==(a=null==t?void 0:t.account.walletStateInit)&&void 0!==a?a:null,wallet_type:null!==(o=null==t?void 0:t.device.appName)&&void 0!==o?o:null,wallet_version:null!==(l=null==t?void 0:t.device.appVersion)&&void 0!==l?l:null,auth_type:f,custom_data:Object.assign({client_id:null!==(c=null==n?void 0:n.clientId)&&void 0!==c?c:null,wallet_id:null!==(u=null==n?void 0:n.walletId)&&void 0!==u?u:null,chain_id:null!==(h=null===(d=null==t?void 0:t.account)||void 0===d?void 0:d.chain)&&void 0!==h?h:null,provider:null!==(p=null==t?void 0:t.provider)&&void 0!==p?p:null},Ke(e))}}function Fe(e,t){var n,r,s,i;return{valid_until:null!==(n=String(t.validUntil))&&void 0!==n?n:null,from:null!==(i=null!==(r=t.from)&&void 0!==r?r:null===(s=null==e?void 0:e.account)||void 0===s?void 0:s.address)&&void 0!==i?i:null,messages:t.messages.map(e=>{var t,n;return{address:null!==(t=e.address)&&void 0!==t?t:null,amount:null!==(n=e.amount)&&void 0!==n?n:null}})}}function He(e,t,n,r,s,i,a){return Object.assign(Object.assign({type:"transaction-signing-failed",is_success:!1,error_message:r,error_code:null!=s?s:null,trace_id:null!=a?a:null},ze(e,t,i)),function(e,t){var n,r,s,i;return{valid_until:null!==(n=String(t.validUntil))&&void 0!==n?n:null,from:null!==(i=null!==(r=t.from)&&void 0!==r?r:null===(s=null==e?void 0:e.account)||void 0===s?void 0:s.address)&&void 0!==i?i:null,messages:t.messages.map(e=>{var t,n,r,s;return{address:null!==(t=e.address)&&void 0!==t?t:null,amount:null!==(n=e.amount)&&void 0!==n?n:null,payload:null!==(r=e.payload)&&void 0!==r?r:null,state_init:null!==(s=e.stateInit)&&void 0!==s?s:null}})}}(t,n))}class Ge{get version(){return Ke({ton_connect_sdk_lib:this.tonConnectSdkVersion,ton_connect_ui_lib:this.tonConnectUiVersion})}constructor(e){this.eventPrefix="ton-connect-",this.tonConnectUiVersion=null,this.eventDispatcher=null==e?void 0:e.eventDispatcher,this.tonConnectSdkVersion=e.tonConnectSdkVersion,this.init().catch()}init(){return W(this,0,void 0,function*(){try{yield this.setRequestVersionHandler(),this.tonConnectUiVersion=yield this.requestTonConnectUiVersion()}catch(bl){}})}setRequestVersionHandler(){return W(this,0,void 0,function*(){yield this.eventDispatcher.addEventListener("ton-connect-request-version",()=>W(this,0,void 0,function*(){yield this.eventDispatcher.dispatchEvent("ton-connect-response-version",function(e){return{type:"response-version",version:e}}(this.tonConnectSdkVersion))}))})}requestTonConnectUiVersion(){return W(this,0,void 0,function*(){return new Promise((e,t)=>W(this,0,void 0,function*(){try{yield this.eventDispatcher.addEventListener("ton-connect-ui-response-version",t=>{e(t.detail.version)},{once:!0}),yield this.eventDispatcher.dispatchEvent("ton-connect-ui-request-version",{type:"request-version"})}catch(bl){t(bl)}}))})}dispatchUserActionEvent(e){try{this.eventDispatcher.dispatchEvent(`${this.eventPrefix}${e.type}`,e).catch()}catch(bl){}}trackConnectionStarted(...e){try{const t=function(e,t){return{type:"connection-started",custom_data:Ke(e),trace_id:null!=t?t:null}}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackConnectionCompleted(...e){try{const t=function(e,t,n,r){return Object.assign({type:"connection-completed",is_success:!0,trace_id:null!=r?r:null},ze(e,t,n))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackConnectionError(...e){try{const t=function(e,t,n,r,s){var i,a;return{type:"connection-error",is_success:!1,error_message:t,error_code:null!=n?n:null,trace_id:null!=s?s:null,custom_data:Object.assign({client_id:null!==(i=null==r?void 0:r.clientId)&&void 0!==i?i:null,wallet_id:null!==(a=null==r?void 0:r.walletId)&&void 0!==a?a:null},Ke(e))}}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackConnectionRestoringStarted(...e){try{const t=function(e,t){return{type:"connection-restoring-started",custom_data:Ke(e),trace_id:null!=t?t:null}}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackConnectionRestoringCompleted(...e){try{const t=function(e,t,n,r){return Object.assign({type:"connection-restoring-completed",is_success:!0,trace_id:null!=r?r:null},ze(e,t,n))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackConnectionRestoringError(...e){try{const t=function(e,t,n){return{type:"connection-restoring-error",is_success:!1,error_message:t,trace_id:null!=n?n:null,custom_data:Ke(e)}}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackDisconnection(...e){try{const t=function(e,t,n,r,s){return Object.assign({type:"disconnection",scope:n,trace_id:null!=s?s:null},ze(e,t,r))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackTransactionSentForSignature(...e){try{const t=function(e,t,n,r,s){return Object.assign(Object.assign({type:"transaction-sent-for-signature",trace_id:null!=s?s:null},ze(e,t,r)),Fe(t,n))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackTransactionSigned(...e){try{const t=function(e,t,n,r,s,i){return Object.assign(Object.assign({type:"transaction-signed",is_success:!0,signed_transaction:r.boc,trace_id:null!=i?i:null},ze(e,t,s)),Fe(t,n))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackTransactionSigningFailed(...e){try{const t=He(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackDataSentForSignature(...e){try{const t=function(e,t,n,r,s){return Object.assign({type:"sign-data-request-initiated",data:n,trace_id:null!=s?s:null},ze(e,t,r))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackDataSigned(...e){try{const t=function(e,t,n,r,s,i){return Object.assign({type:"sign-data-request-completed",is_success:!0,data:n,signed_data:r,trace_id:null!=i?i:null},ze(e,t,s))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}trackDataSigningFailed(...e){try{const t=function(e,t,n,r,s,i,a){return Object.assign({type:"sign-data-request-failed",is_success:!1,data:n,error_message:r,error_code:null!=s?s:null,trace_id:null!=a?a:null},ze(e,t,i))}(this.version,...e);this.dispatchUserActionEvent(t)}catch(bl){}}}const Je="3.4.1";function Ve(e){try{return Ze(e),!0}catch(t){return!1}}function Ye(e){try{return function(e){if(!e.includes(":"))throw new ne(`Wrong address ${e}. Address must include ":".`);const t=e.split(":");if(2!==t.length)throw new ne(`Wrong address ${e}. Address must include ":" only once.`);const n=parseInt(t[0]);if(0!==n&&-1!==n)throw new ne(`Wrong address ${e}. WC must be eq 0 or -1, but ${n} received.`);const r=t[1];if(64!==(null==r?void 0:r.length))throw new ne(`Wrong address ${e}. Hex part must be 64bytes length, but ${null==r?void 0:r.length} received.`);Qe(r)}(e),!0}catch(t){return!1}}function Ze(e){const t=e.replace(/-/g,"+").replace(/_/g,"/");let n;try{n=$.decode(t).toUint8Array()}catch(d){throw new ne(`Invalid base64 encoding in address: ${e}`)}if(36!==n.length)throw new ne(`Invalid address length: ${e}`);const r=n.slice(0,34),s=n.slice(34,36),i=function(e){const t=4129;let n=0;const r=new Uint8Array(e.length+2);r.set(e);for(let s of r){let e=128;for(;e>0;)n<<=1,s&e&&(n+=1),e>>=1,n>65535&&(n&=65535,n^=t)}return new Uint8Array([Math.floor(n/256),n%256])}(r);if(!s.every((e,t)=>e===i[t]))throw new ne(`Invalid checksum in address: ${e}`);let a=r[0],o=!1,l=!1;if(128&a&&(o=!0,a^=128),17!==a&&81!==a)throw new ne(`Unknown address tag: ${a}`);l=17===a;let c=null;c=255===r[1]?-1:r[1];const u=r.slice(2);if(0!==c&&-1!==c)throw new ne(`Invalid workchain: ${c}`);return{wc:c,hex:Array.from(u).map(e=>e.toString(16).padStart(2,"0")).join(""),testOnly:o,isBounceable:l}}const Xe={};for(let Il=0;Il<=255;Il++){let e=Il.toString(16);e.length<2&&(e="0"+e),Xe[e]=Il}function Qe(e){const t=(e=e.toLowerCase()).length;if(t%2!=0)throw new re("Hex string must have length a multiple of 2: "+e);const n=t/2,r=new Uint8Array(n);for(let s=0;s<n;s++){const t=2*s,n=e.substring(t,t+2);if(!Xe.hasOwnProperty(n))throw new re("Invalid hex character: "+n);r[s]=Xe[n]}return r}const et=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,tt=/^[A-Za-z0-9\-_]+$/,nt=/^-?\d+$/,rt=/^\d+$/;function st(e){return"number"==typeof e&&!isNaN(e)}function it(e){return"string"==typeof e&&e.length>0}function at(e){return it(e)&&(Ye(e)||Ve(e))}function ot(e){return it(e)&&/^-?\d+$/.test(e)}function lt(e){return"string"==typeof e&&(et.test(e)||tt.test(e))&&e.startsWith("te6cc")}function ct(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ut(e,t){return Object.keys(e).some(e=>!t.includes(e))}function dt(e){if(!ct(e))return"Request must be an object";if(ut(e,["validUntil","network","from","messages"]))return"Request contains extra properties";if(e.validUntil){if(!st(e.validUntil))return"Incorrect 'validUntil'";const t=Math.floor(Date.now()/1e3),n=t+300;e.validUntil>n&&console.warn(`validUntil (${e.validUntil}) is more than 5 minutes from now (${t})`)}if(void 0!==e.network&&!ot(e.network))return"Invalid 'network' format";if(void 0!==e.from&&!at(e.from))return"Invalid 'from' address format";if(t=e.messages,!Array.isArray(t)||0===e.messages.length)return"'messages' is required";var t;for(let n=0;n<e.messages.length;n++){const t=ht(e.messages[n],n);if(t)return t}return null}function ht(e,t){if(!ct(e))return`Message at index ${t} must be an object`;if(ut(e,["address","amount","stateInit","payload","extraCurrency"]))return`Message at index ${t} contains extra properties`;if(!it(e.address))return`'address' is required in message at index ${t}`;if(!Ve(e.address))return`Wrong 'address' format in message at index ${t}`;if(!it(e.amount))return`'amount' is required in message at index ${t}`;if(!/^[0-9]+$/.test(e.amount))return`Incorrect 'amount' in message at index ${t}`;if(!(void 0===e.stateInit||it(e.stateInit)&&lt(e.stateInit)))return`Invalid 'stateInit' in message at index ${t}`;if(!(void 0===e.payload||it(e.payload)&&lt(e.payload)))return`Invalid 'payload' in message at index ${t}`;if(void 0!==e.extraCurrency){if(!ct(e.extraCurrency))return`Invalid 'extraCurrency' in message at index ${t}`;for(const[n,r]of Object.entries(e.extraCurrency))if(!nt.test(n)||"string"!=typeof r||!rt.test(r))return`Invalid 'extraCurrency' format in message at index ${t}`}return null}function pt(e){if(!ct(e))return"Request must be an object";if(ut(e,["tonProof"]))return"Request contains extra properties";if(void 0!==e.tonProof){if("string"!=typeof e.tonProof)return"Invalid 'tonProof'";const t=e.tonProof;if(0===t.length)return"Empty 'tonProof' payload";const n=function(){try{return"undefined"!=typeof window&&window.location?window.location.hostname:null}catch(e){return null}}();if(!n)return null;const r=(new TextEncoder).encode(n).length;if(r>128)return"Current domain exceeds 128 bytes limit";const s=(new TextEncoder).encode(t).length;if(s>128)return"'tonProof' payload exceeds 128 bytes limit";if(r+s>222)return"'tonProof' domain + payload exceeds 222 bytes limit"}return null}function ft(e){if(!ct(e))return"Payload must be an object";if(!it(e.type))return"'type' is required";switch(e.type){case"text":return function(e){if(ut(e,["type","text","network","from"]))return"Text payload contains extra properties";if(!it(e.text))return"'text' is required";if(void 0!==e.network&&!ot(e.network))return"Invalid 'network' format";if(void 0!==e.from&&!at(e.from))return"Invalid 'from'";return null}(e);case"binary":return function(e){if(ut(e,["type","bytes","network","from"]))return"Binary payload contains extra properties";if(!it(e.bytes))return"'bytes' is required";if(void 0!==e.network&&!ot(e.network))return"Invalid 'network' format";if(void 0!==e.from&&!at(e.from))return"Invalid 'from'";return null}(e);case"cell":return function(e){if(ut(e,["type","schema","cell","network","from"]))return"Cell payload contains extra properties";if(!it(e.schema))return"'schema' is required";if(!it(e.cell))return"'cell' is required";if(!lt(e.cell))return"Invalid 'cell' format (must be valid base64)";if(void 0!==e.network&&!ot(e.network))return"Invalid 'network' format";if(void 0!==e.from&&!at(e.from))return"Invalid 'from'";return null}(e);default:return"Invalid 'type' value"}}function gt(e){if("string"!=typeof e)return;const t=e.length+(4-e.length%4)%4;return e.replace(/-/g,"+").replace(/_/g,"/").padEnd(t,"=")}class mt{constructor(e={}){var t,n,r,s,i,a;this.events=[],this.timeoutId=null,this.isProcessing=!1,this.backoff=1,this.shouldSend=!0,this.batchTimeoutMs=null!==(t=e.batchTimeoutMs)&&void 0!==t?t:2e3,this.currentBatchTimeoutMs=this.batchTimeoutMs,this.maxBatchSize=null!==(n=e.maxBatchSize)&&void 0!==n?n:100,this.analyticsUrl=null!==(r=e.analyticsUrl)&&void 0!==r?r:"https://analytics.ton.org/events",this.mode=null!==(s=e.mode)&&void 0!==s?s:"telemetry",this.baseEvent=Object.assign({subsystem:"dapp-sdk",version:Je,client_environment:null===(a=null===(i=e.environment)||void 0===i?void 0:i.getClientEnvironment)||void 0===a?void 0:a.call(i)},function(){const e={};try{const t=performance.getEntriesByType("navigation");if(t.length>0){const n=t[0];n.responseStart&&n.requestStart&&(e.conn_ttfb=Math.round(n.responseStart-n.requestStart))}}catch(bl){}return e}()),this.addWindowFocusAndBlurSubscriptions()}scoped(e){return new Proxy(this,{get(t,n){const r=n.toString();if(r.startsWith("emit")){const n=r.replace("emit",""),s=n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();return function(n){const r=Object.fromEntries(Object.entries(null!=e?e:{}).map(([e,t])=>[e,"function"==typeof t?t():t]));return t.emit(Object.assign(Object.assign({event_name:s},r),n))}}return t[n]}})}emit(e){var t;if("off"===this.mode)return;const n=null!==(t=e.trace_id)&&void 0!==t?t:je(),r=function(){const e={};try{const t=navigator,n=t.connection||t.mozConnection||t.webkitConnection;n&&(void 0!==n.rtt&&(e.conn_rtt=n.rtt),n.effectiveType?e.conn_network_type=n.effectiveType:n.type&&(e.conn_network_type=n.type))}catch(bl){}return e}(),s=Object.assign(Object.assign(Object.assign(Object.assign({},this.baseEvent),r),e),{event_id:je(),client_timestamp:Math.floor(Date.now()/1e3),trace_id:n}),i="telemetry"===this.mode?this.filterFullModeFields(s):s;this.events.push(i),this.events.length>=this.maxBatchSize?this.flush():this.startTimeout()}startTimeout(){this.timeoutId||this.isProcessing||(this.timeoutId=setTimeout(()=>{this.flush()},this.currentBatchTimeoutMs))}flush(){return W(this,0,void 0,function*(){if(this.isProcessing||0===this.events.length||!this.shouldSend)return;this.clearTimeout(),this.isProcessing=!0;const e=this.extractEventsToSend();try{yield this.processEventsBatch(e),ye("Analytics events sent successfully")}catch(t){this.restoreEvents(e),ve("Failed to send analytics events:",t)}finally{this.isProcessing=!1,this.scheduleNextFlushIfNeeded()}})}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)}extractEventsToSend(){const e=this.events.slice(0,this.maxBatchSize);return this.events=this.events.slice(this.maxBatchSize),e}processEventsBatch(e){return W(this,0,void 0,function*(){ye("Sending analytics events...",e.length);try{const t=yield this.sendEvents(e);this.handleResponse(t)}catch(t){this.handleUnknownError(t)}})}handleResponse(e){const{status:t,statusText:n}=e;this.isTooManyRequests(t)?this.handleTooManyRequests(t,n):this.isClientError(t)?this.handleClientError(t,n):this.isServerError(t)&&this.handleUnknownError({status:t,statusText:n})}restoreEvents(e){this.events.unshift(...e)}scheduleNextFlushIfNeeded(){this.events.length>0&&this.startTimeout()}sendEvents(e){return W(this,0,void 0,function*(){return yield fetch(this.analyticsUrl,{method:"POST",headers:{"Content-Type":"application/json","X-Client-Timestamp":Math.floor(Date.now()/1e3).toString()},body:JSON.stringify(e)})})}isClientError(e){return e>=mt.HTTP_STATUS.CLIENT_ERROR_START&&e<mt.HTTP_STATUS.SERVER_ERROR_START}isServerError(e){return e>=mt.HTTP_STATUS.SERVER_ERROR_START}isTooManyRequests(e){return e===mt.HTTP_STATUS.TOO_MANY_REQUESTS}handleClientError(e,t){ve("Failed to send analytics events:",new q(`Analytics API error: ${e} ${t}`))}handleUnknownError(e){if(this.backoff<mt.MAX_BACKOFF_ATTEMPTS)throw this.backoff++,this.currentBatchTimeoutMs*=mt.BACKOFF_MULTIPLIER,new q(`Unknown analytics API error: ${e}`);return this.currentBatchTimeoutMs=this.batchTimeoutMs,void(this.backoff=1)}handleTooManyRequests(e,t){throw new q(`Analytics API error: ${e} ${t}`)}addWindowFocusAndBlurSubscriptions(){const e=Ie();if(e)try{e.addEventListener("visibilitychange",()=>{e.hidden?(this.clearTimeout(),this.shouldSend=!1):(this.shouldSend=!0,this.scheduleNextFlushIfNeeded())})}catch(bl){ve("Cannot subscribe to the document.visibilitychange: ",bl)}}getMode(){return this.mode}getPendingEventsCount(){return this.events.length}filterFullModeFields(e){const t=Object.assign({},e);for(const r of mt.FULL_MODE_FIELDS)delete t[r];const n="event_name"in e?String(e.event_name):"";return!("error_code"in e||"error_message"in e||n.includes("error")||"connection-error"===n||"transaction-signing-failed"===n||"sign-data-request-failed"===n)&&"wallet_address"in t&&delete t.wallet_address,t}setWalletListDownloadDuration(e){this.baseEvent=Object.assign(Object.assign({},this.baseEvent),{wallet_list_download_duration:e})}}mt.HTTP_STATUS={TOO_MANY_REQUESTS:429,CLIENT_ERROR_START:400,SERVER_ERROR_START:500},mt.MAX_BACKOFF_ATTEMPTS=5,mt.BACKOFF_MULTIPLIER=2,mt.FULL_MODE_FIELDS=["user_id","tg_id","locale","tma_is_premium"];class yt{constructor(){this.window=Oe()}dispatchEvent(e,t){return W(this,0,void 0,function*(){var n;const r=new CustomEvent(e,{detail:t});null===(n=this.window)||void 0===n||n.dispatchEvent(r)})}addEventListener(e,t,n){return W(this,0,void 0,function*(){var r;return null===(r=this.window)||void 0===r||r.addEventListener(e,t,n),()=>{var n;return null===(n=this.window)||void 0===n?void 0:n.removeEventListener(e,t)}})}}function vt(e){return{"@tonconnect/sdk":e.ton_connect_sdk_lib||"","@tonconnect/ui":e.ton_connect_ui_lib||""}}function wt(e){var t,n,r,s,i,a,o,l;return{versions:vt(e.custom_data),network_id:null!==(t=e.custom_data.chain_id)&&void 0!==t?t:"",client_id:null!==(n=e.custom_data.client_id)&&void 0!==n?n:"",wallet_id:null!==(r=e.custom_data.wallet_id)&&void 0!==r?r:"",wallet_address:null!==(s=e.wallet_address)&&void 0!==s?s:"",wallet_app_name:null!==(i=e.wallet_type)&&void 0!==i?i:"",wallet_app_version:null!==(a=e.wallet_version)&&void 0!==a?a:"",wallet_state_init:null!==(o=e.wallet_state_init)&&void 0!==o?o:"",trace_id:null!==(l=e.trace_id)&&void 0!==l?l:void 0}}class bt{getClientEnvironment(){return""}getBrowser(){return""}getLocale(){return""}getPlatform(){return""}getTelegramUser(){}}const _t={};const xt="0";class St{constructor(e){this.connectionStorage=e,this.type="injected",this.listeners=[],this.connector=void 0;const{projectId:t,metadata:n}=function(){if(void 0===_t.walletConnectOptions)throw new q("Wallet Connect is not initialized.");return _t.walletConnectOptions}();this.config={networks:[{namespace:"ton",chains:[{id:-239,chainNamespace:"ton",caipNetworkId:"ton:-239",name:"TON",nativeCurrency:{name:"TON",symbol:"TON",decimals:9},rpcUrls:{default:{http:[]}}},{id:-3,chainNamespace:"ton",caipNetworkId:"ton:-3",name:"TON",nativeCurrency:{name:"TON",symbol:"TON",decimals:9},rpcUrls:{default:{http:[]}}}],methods:["ton_sendMessage","ton_signData"],events:[]}],projectId:t,metadata:n}}static fromStorage(e){return W(this,0,void 0,function*(){return new St(e)})}initialize(){return W(this,0,void 0,function*(){return this.connector||(this.connector=yield function(){if(void 0===_t.UniversalConnectorCls)throw new q("Wallet Connect is not initialized.");return _t.UniversalConnectorCls}().init(this.config)),this.connector})}connect(e,t){var n,r;const s=null!==(n=null==t?void 0:t.traceId)&&void 0!==n?n:je(),i=ge(null==t?void 0:t.signal);null===(r=this.abortController)||void 0===r||r.abort(),this.abortController=i,this._connect(e,{traceId:s,signal:i.signal,abortController:i}).catch(e=>ye("WalletConnect connect unexpected error",e))}_connect(e,t){return W(this,0,void 0,function*(){var n,r;const s=yield this.initialize();if(null===(n=t.signal)||void 0===n?void 0:n.aborted)return ye("WalletConnect connect aborted before start"),void this.clearAbortController(t.abortController);const i=e.items.find(e=>"ton_proof"===e.name),a=i?[{domain:new URL(this.config.metadata.url).hostname,chains:["ton:-239"],nonce:"",uri:"ton_proof",ttl:0,statement:i.payload}]:void 0;ye("Connecting through this.connector.connect");try{yield s.connect({authentication:a})}catch(o){if(null===(r=t.signal)||void 0===r?void 0:r.aborted)return ye("WalletConnect connect aborted via signal"),void this.clearAbortController(t.abortController);ye("WalletConnect connect error",o);const e={id:0,event:"connect_error",traceId:t.traceId,payload:{code:O.USER_REJECTS_ERROR,message:"User declined the connection"}};return ye("WalletConnect connect response:",e),this.emit(e),void this.clearAbortController(t.abortController)}ye("Connected through this.connector.connect");try{yield this.onConnect(s,Object.assign(Object.assign({},t),{includeTonProof:!0}))}catch(o){ye("WalletConnect onConnect error",o),yield this.disconnect({traceId:t.traceId,signal:t.signal})}finally{this.clearAbortController(t.abortController)}})}restoreConnection(e){return W(this,0,void 0,function*(){var t,n;const r=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je(),s=ge(null==e?void 0:e.signal);if(null===(n=this.abortController)||void 0===n||n.abort(),this.abortController=s,!s.signal.aborted)try{ye("Restoring WalletConnect connection...");if(!(yield this.connectionStorage.getWalletConnectConnection())||s.signal.aborted)return;const e=yield this.initialize();if(s.signal.aborted)return;yield this.onConnect(e,{includeTonProof:!1,traceId:r,signal:s.signal}),ye("WalletConnect successfully restored.")}catch(i){ye("WalletConnect restore error",i),yield this.disconnect({traceId:r,signal:s.signal})}finally{this.clearAbortController(s)}})}closeConnection(){var e;null===(e=this.abortController)||void 0===e||e.abort(),this.abortController=void 0,this.disconnect()}disconnect(e){return W(this,0,void 0,function*(){var t,n;const r=ge(null==e?void 0:e.signal);if(null===(t=this.abortController)||void 0===t||t.abort(),this.abortController=r,!r.signal.aborted)try{if(yield this.connectionStorage.removeConnection(),r.signal.aborted)return;yield null===(n=this.connector)||void 0===n?void 0:n.disconnect()}catch(s){ye("WalletConnect disconnect error",s)}finally{this.clearAbortController(r)}})}sendRequest(e,t){return W(this,0,void 0,function*(){var n,r,s,i;if(!this.connector)throw new q("Wallet Connect not initialized");const a={};"function"==typeof t?a.onRequestSent=t:(a.onRequestSent=null==t?void 0:t.onRequestSent,a.signal=null==t?void 0:t.signal,a.attempts=null==t?void 0:t.attempts,a.traceId=null==t?void 0:t.traceId),null!==(n=a.traceId)&&void 0!==n||(a.traceId=je());try{if(null===(r=a.signal)||void 0===r?void 0:r.aborted)throw new q("WalletConnect request aborted");if(ye("Send wallet-connect request:",Object.assign(Object.assign({},e),{id:xt})),"sendTransaction"===e.method){const t=JSON.parse(e.params[0]),{network:n}=t,r=B(t,["network"]),i=this.connector.request({method:"ton_sendMessage",params:r},`ton:${n}`);null===(s=null==a?void 0:a.onRequestSent)||void 0===s||s.call(a);const o=yield i;return ye("Wallet message received:",{result:o,id:xt}),{result:o,id:xt,traceId:a.traceId}}if("signData"===e.method){const t=JSON.parse(e.params[0]),{network:n}=t,r=B(t,["network"]),s=this.connector.request({method:"ton_signData",params:r},`ton:${n}`);null===(i=null==a?void 0:a.onRequestSent)||void 0===i||i.call(a);const o=yield s;return ye("Wallet message received:",{result:o,id:xt}),{result:o,traceId:a.traceId,id:xt}}if("disconnect"===e.method)return{id:xt,traceId:a.traceId}}catch(o){ye("WalletConnect request error",o,o.stack);const e=yield this.handleWalletConnectError(o,{traceId:a.traceId});return ye("Wallet message received:",e),e}return{id:xt,error:{code:P.UNKNOWN_ERROR,message:"Not implemented."},traceId:a.traceId}})}handleWalletConnectError(e,t){return W(this,0,void 0,function*(){if("object"==typeof e&&null!==e){const n=String("message"in e?e.message:"msg"in e?e.msg:e);return n.toLowerCase().includes("reject")?{id:xt,traceId:t.traceId,error:{code:N.USER_REJECTS_ERROR,message:n}}:n.toLowerCase().includes("tonvalidationerror")?{id:xt,traceId:t.traceId,error:{code:N.BAD_REQUEST_ERROR,message:n}}:{id:xt,traceId:t.traceId,error:{code:N.UNKNOWN_ERROR,message:n}}}return{id:xt,traceId:t.traceId,error:{code:N.UNKNOWN_ERROR,message:String(e)}}})}listen(e){return this.listeners.push(e),()=>this.listeners=this.listeners.filter(t=>t!==e)}buildTonProof(e){var t,n,r;const s=null===(t=e.provider.session.authentication)||void 0===t?void 0:t[0],i=null===(n=null==s?void 0:s.p)||void 0===n?void 0:n.iat,a=null===(r=null==s?void 0:s.p)||void 0===r?void 0:r.statement;if(!i||!a)return;const o=s.p.domain;return{name:"ton_proof",proof:{timestamp:Math.floor(new Date(i).getTime()/1e3),domain:{lengthBytes:o.length,value:o},payload:a,signature:s.s.s}}}onConnect(e,t){return W(this,0,void 0,function*(){var n,r,s,i;if(null===(n=t.signal)||void 0===n?void 0:n.aborted)return void ye("WalletConnect onConnect aborted");const a=e.provider.session,o=a.namespaces.ton;if(!(null===(r=null==o?void 0:o.accounts)||void 0===r?void 0:r[0]))return void(yield this.disconnectWithError({traceId:t.traceId,code:O.BAD_REQUEST_ERROR,message:"Connection error. No TON accounts connected."}));const l=o.accounts[0],[,c,u]=l.split(":",3),d=null===(s=a.sessionProperties)||void 0===s?void 0:s.ton_getPublicKey;if(!d)return void(yield this.disconnectWithError({traceId:t.traceId,code:O.BAD_REQUEST_ERROR,message:"Connection error. No sessionProperties.ton_getPublicKey provided."}));const h=null===(i=a.sessionProperties)||void 0===i?void 0:i.ton_getStateInit;if(!h)return void(yield this.disconnectWithError({traceId:t.traceId,code:O.BAD_REQUEST_ERROR,message:"Connection error. No sessionProperties.ton_getStateInit provided."}));e.provider.once("session_delete",()=>W(this,0,void 0,function*(){try{yield this.connectionStorage.removeConnection();const e={event:"disconnect",traceId:je(),payload:{}};ye("Wallet message received:",e),this.emit(e)}catch(e){ye("Error while deleting session",e)}}));const p=(null==t?void 0:t.includeTonProof)?this.buildTonProof(e):void 0,f={items:[{name:"ton_addr",address:Ve(u)?function({wc:e,hex:t}){return`${e}:${t}`}(Ze(u)):u,network:c,publicKey:d,walletStateInit:h},...p?[p]:[]],device:{appName:"wallet_connect",appVersion:"",maxProtocolVersion:2,features:this.buildFeatureList(o.methods),platform:"browser"}};ye("WalletConnect connect response:",{event:"connect",payload:f,id:0}),this.emit({event:"connect",payload:f,traceId:t.traceId}),yield this.storeConnection()})}buildFeatureList(e){const t=[];return e.includes("ton_sendMessage")&&t.push("SendTransaction",{name:"SendTransaction",maxMessages:4,extraCurrencySupported:!1}),e.includes("ton_signData")&&t.push({name:"SignData",types:["text","binary","cell"]}),t}disconnectWithError(e){return W(this,0,void 0,function*(){yield this.disconnect();const t={code:e.code,message:e.message};ye("WalletConnect connect response:",{event:"connect_error",id:0,payload:t}),this.emit({event:"connect_error",traceId:e.traceId,payload:t})})}clearAbortController(e){this.abortController===e&&(this.abortController=void 0)}emit(e,t){(null!=t?t:this.listeners).forEach(t=>t(e))}storeConnection(){return this.connectionStorage.storeConnection({type:"wallet-connect"})}}class kt{static getWallets(){return this.walletsList.getWallets()}get connected(){return null!==this._wallet}get account(){var e;return(null===(e=this._wallet)||void 0===e?void 0:e.account)||null}get wallet(){return this._wallet}set wallet(e){this._wallet=e,this.statusChangeSubscriptions.forEach(e=>e(this._wallet))}constructor(e){var t,n,r;this._wallet=null,this.provider=null,this.statusChangeSubscriptions=[],this.statusChangeErrorSubscriptions=[];const s=(null==e?void 0:e.manifestUrl)||function(){var e;const t=null===(e=Oe())||void 0===e?void 0:e.location.origin;return t?t+"/tonconnect-manifest.json":""}();this.dappSettings={manifestUrl:s,storage:(null==e?void 0:e.storage)||new $e},this.walletsRequiredFeatures=null==e?void 0:e.walletsRequiredFeatures,this.environment=null!==(t=null==e?void 0:e.environment)&&void 0!==t?t:new bt,this.walletsList=new Me({walletsListSource:null==e?void 0:e.walletsListSource,cacheTTLMs:null==e?void 0:e.walletsListCacheTTLMs,onDownloadDurationMeasured:e=>{var t;null===(t=this.analytics)||void 0===t||t.setWalletListDownloadDuration(e)}});const i=null!==(n=null==e?void 0:e.eventDispatcher)&&void 0!==n?n:new yt;if(this.tracker=new Ge({eventDispatcher:i,tonConnectSdkVersion:Je}),this.environment=null!==(r=null==e?void 0:e.environment)&&void 0!==r?r:new bt,this.initAnalytics(s,i,e),!this.dappSettings.manifestUrl)throw new K("Dapp tonconnect-manifest.json must be specified if window.location.origin is undefined. See more https://github.com/ton-connect/docs/blob/main/requests-responses.md#app-manifest");this.bridgeConnectionStorage=new Ue(this.dappSettings.storage,this.walletsList),(null==e?void 0:e.disableAutoPauseConnection)||this.addWindowFocusAndBlurSubscriptions()}getWallets(){return this.walletsList.getWallets()}onStatusChange(e,t){return this.statusChangeSubscriptions.push(e),t&&this.statusChangeErrorSubscriptions.push(t),()=>{this.statusChangeSubscriptions=this.statusChangeSubscriptions.filter(t=>t!==e),t&&(this.statusChangeErrorSubscriptions=this.statusChangeErrorSubscriptions.filter(e=>e!==t))}}connect(e,t,n){var r,s,i;const a=Object.assign({},n);if("object"==typeof t&&null!==t&&"tonProof"in t&&(a.request=t),"object"==typeof t&&null!==t&&("openingDeadlineMS"in t||"signal"in t||"request"in t||"traceId"in t)&&(a.request=null==t?void 0:t.request,a.openingDeadlineMS=null==t?void 0:t.openingDeadlineMS,a.signal=null==t?void 0:t.signal),a.request){const e=pt(a.request);if(e)throw new q("ConnectAdditionalRequest validation failed: "+e)}if(this.connected)throw new H;const o=ge(null==a?void 0:a.signal);if(null===(r=this.abortController)||void 0===r||r.abort(),this.abortController=o,o.signal.aborted)throw new q("Connection was aborted");null===(s=this.provider)||void 0===s||s.closeConnection(),this.provider=this.createProvider(e),o.signal.addEventListener("abort",()=>{var e;null===(e=this.provider)||void 0===e||e.closeConnection(),this.provider=null});const l=null!==(i=null==a?void 0:a.traceId)&&void 0!==i?i:je();return this.tracker.trackConnectionStarted(l),this.provider.connect(this.createConnectRequest(null==a?void 0:a.request),{openingDeadlineMS:null==a?void 0:a.openingDeadlineMS,signal:o.signal,traceId:l})}restoreConnection(e){return W(this,0,void 0,function*(){var t,n,r;const s=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je();this.tracker.trackConnectionRestoringStarted(s);const i=ge(null==e?void 0:e.signal);if(null===(n=this.abortController)||void 0===n||n.abort(),this.abortController=i,i.signal.aborted)return void this.tracker.trackConnectionRestoringError("Connection restoring was aborted",s);const[a,o]=yield Promise.all([this.bridgeConnectionStorage.storedConnectionType(),this.walletsList.getEmbeddedWallet()]);if(i.signal.aborted)return void this.tracker.trackConnectionRestoringError("Connection restoring was aborted",s);let l=null;try{switch(a){case"http":l=yield Ee.fromStorage(this.bridgeConnectionStorage,this.analytics);break;case"injected":l=yield Pe.fromStorage(this.bridgeConnectionStorage,this.analytics);break;case"wallet-connect":l=yield St.fromStorage(this.bridgeConnectionStorage);break;default:if(!o)return;l=this.createProvider(o)}}catch(h){return ye("Provider is not restored",h),this.tracker.trackConnectionRestoringError("Provider is not restored",s),yield this.bridgeConnectionStorage.removeConnection(),null==l||l.closeConnection(),void(l=null)}if(i.signal.aborted)return null==l||l.closeConnection(),void this.tracker.trackConnectionRestoringError("Connection restoring was aborted",s);if(!l)return ve("Provider is not restored"),void this.tracker.trackConnectionRestoringError("Provider is not restored",s);null===(r=this.provider)||void 0===r||r.closeConnection(),this.provider=l,l.listen(this.walletEventsListener.bind(this));const c=()=>{this.tracker.trackConnectionRestoringError("Connection restoring was aborted",s),null==l||l.closeConnection(),l=null};i.signal.addEventListener("abort",c);const u=me(t=>W(this,0,void 0,function*(){if(yield null==l?void 0:l.restoreConnection({openingDeadlineMS:null==e?void 0:e.openingDeadlineMS,signal:t.signal,traceId:s}),i.signal.removeEventListener("abort",c),this.connected){const e=this.getSessionInfo();this.tracker.trackConnectionRestoringCompleted(this.wallet,e,s)}else this.tracker.trackConnectionRestoringError("Connection restoring failed",s)}),{attempts:Number.MAX_SAFE_INTEGER,delayMs:2e3,signal:null==e?void 0:e.signal}),d=new Promise(e=>setTimeout(()=>e(),12e3));return Promise.race([u,d])})}sendTransaction(e,t){return W(this,0,void 0,function*(){var n,r,s;const i={};"function"==typeof t?i.onRequestSent=t:(i.onRequestSent=null==t?void 0:t.onRequestSent,i.signal=null==t?void 0:t.signal,i.traceId=null==t?void 0:t.traceId);const a=dt(e);if(a)throw new q("SendTransactionRequest validation failed: "+a);const o=ge(null==i?void 0:i.signal);if(o.signal.aborted)throw new q("Transaction sending was aborted");this.checkConnection();const l=e.messages.length,c=e.messages.some(e=>e.extraCurrency&&Object.keys(e.extraCurrency).length>0);Be(this.wallet.device.features,{requiredMessagesNumber:l,requireExtraCurrencies:c});const u=this.getSessionInfo(),d=null!==(n=null==i?void 0:i.traceId)&&void 0!==n?n:je();this.tracker.trackTransactionSentForSignature(this.wallet,e,u,d);const{validUntil:h,messages:p}=e,f=B(e,["validUntil","messages"]),g=e.from||this.account.address,m=e.network||this.account.chain;if((null===(r=this.wallet)||void 0===r?void 0:r.account.chain)&&m!==this.wallet.account.chain)throw new Z("Wallet connected to a wrong network",{cause:{expectedChainId:null===(s=this.wallet)||void 0===s?void 0:s.account.chain,actualChainId:m}});const y=yield this.provider.sendRequest(ce.convertToRpcRequest(Object.assign(Object.assign({},f),{from:g,network:m,valid_until:h,messages:p.map(e=>{var{extraCurrency:t,payload:n,stateInit:r}=e,s=B(e,["extraCurrency","payload","stateInit"]);return Object.assign(Object.assign({},s),{payload:gt(n),stateInit:gt(r),extra_currency:t})})})),{onRequestSent:i.onRequestSent,signal:o.signal,traceId:d});if(ce.isError(y))return this.tracker.trackTransactionSigningFailed(this.wallet,e,y.error.message,y.error.code,u,d),ce.parseAndThrowError(y);const v=ce.convertFromRpcResponse(y);return this.tracker.trackTransactionSigned(this.wallet,e,v,u,d),Object.assign(Object.assign({},v),{traceId:y.traceId})})}signData(e,t){return W(this,0,void 0,function*(){var n,r,s;const i=ge(null==t?void 0:t.signal);if(i.signal.aborted)throw new q("data sending was aborted");const a=ft(e);if(a)throw new q("SignDataPayload validation failed: "+a);this.checkConnection(),function(e,t){const n=e.find(e=>e&&"object"==typeof e&&"SignData"===e.name);if(!n)throw new V("Wallet doesn't support SignData feature.",{cause:{requiredFeature:{featureName:"SignData",value:{types:t.requiredTypes}}}});const r=t.requiredTypes.filter(e=>!n.types.includes(e));if(r.length)throw new V(`Wallet doesn't support required SignData types: ${r.join(", ")}.`,{cause:{requiredFeature:{featureName:"SignData",value:{types:r}}}})}(this.wallet.device.features,{requiredTypes:[e.type]});const o=this.getSessionInfo(),l=null!==(n=null==t?void 0:t.traceId)&&void 0!==n?n:je();this.tracker.trackDataSentForSignature(this.wallet,e,o,l);const c=e.from||this.account.address,u=e.network||this.account.chain;if((null===(r=this.wallet)||void 0===r?void 0:r.account.chain)&&u!==this.wallet.account.chain)throw new Z("Wallet connected to a wrong network",{cause:{expectedChainId:null===(s=this.wallet)||void 0===s?void 0:s.account.chain,actualChainId:u}});const d=yield this.provider.sendRequest(de.convertToRpcRequest(Object.assign(Object.assign(Object.assign({},e),"cell"===e.type?{cell:gt(e.cell)}:{}),{from:c,network:u})),{onRequestSent:null==t?void 0:t.onRequestSent,signal:i.signal,traceId:l});if(de.isError(d))return this.tracker.trackDataSigningFailed(this.wallet,e,d.error.message,d.error.code,o,l),de.parseAndThrowError(d);const h=de.convertFromRpcResponse(d);return this.tracker.trackDataSigned(this.wallet,e,h,o,l),Object.assign(Object.assign({},h),{traceId:l})})}setConnectionNetwork(e){if(this.connected)throw new q("Cannot change network while wallet is connected");this.desiredChainId=e}disconnect(e){return W(this,0,void 0,function*(){var t,n;if(!this.connected)throw new G;const r=ge(null==e?void 0:e.signal),s=this.abortController;if(this.abortController=r,r.signal.aborted)throw new q("Disconnect was aborted");const i=null!==(t=null==e?void 0:e.traceId)&&void 0!==t?t:je();this.onWalletDisconnected("dapp",{traceId:i}),yield null===(n=this.provider)||void 0===n?void 0:n.disconnect({signal:r.signal,traceId:i}),null==s||s.abort()})}getSessionId(){return W(this,0,void 0,function*(){if(!this.provider)return null;try{const e=yield this.bridgeConnectionStorage.getConnection();return e&&"http"===e.type?"sessionCrypto"in e?e.sessionCrypto.sessionId:e.session.sessionCrypto.sessionId:null}catch(e){return null}})}getSessionInfo(){var e;if("http"!==(null===(e=this.provider)||void 0===e?void 0:e.type))return null;if(!("session"in this.provider))return null;try{const e=this.provider.session;if(!e)return null;const t=e.sessionCrypto.sessionId;let n=null;return"walletPublicKey"in e&&(n=e.walletPublicKey),{clientId:t,walletId:n}}catch(t){return null}}pauseConnection(){var e;"http"===(null===(e=this.provider)||void 0===e?void 0:e.type)&&this.provider.pause()}unPauseConnection(){var e;return"http"!==(null===(e=this.provider)||void 0===e?void 0:e.type)?Promise.resolve():this.provider.unPause()}addWindowFocusAndBlurSubscriptions(){const e=Ie();if(e)try{e.addEventListener("visibilitychange",()=>{e.hidden?this.pauseConnection():this.unPauseConnection().catch(()=>{})})}catch(bl){ve("Cannot subscribe to the document.visibilitychange: ",bl)}}initAnalytics(e,t,n){var r;const s=null==n?void 0:n.analytics,i=null!==(r=null==s?void 0:s.mode)&&void 0!==r?r:"telemetry";if("off"===i)return;const a=new mt({environment:this.environment,mode:i});this.analytics=a;const o=this.environment.getTelegramUser(),l={browser:this.environment.getBrowser(),platform:this.environment.getPlatform(),manifest_json_url:e,origin_url:Ne,locale:this.environment.getLocale()};o&&(l.tg_id=o.id,l.tma_is_premium=o.isPremium),function(e,t){e.addEventListener("ton-connect-ui-wallet-modal-opened",e=>{var n;const{detail:r}=e;t.emitConnectionStarted({client_id:r.client_id||"",versions:vt(r.custom_data),main_screen:r.visible_wallets,trace_id:null!==(n=r.trace_id)&&void 0!==n?n:void 0})}),e.addEventListener("ton-connect-ui-selected-wallet",e=>{var n,r;const{detail:s}=e;t.emitConnectionSelectedWallet({client_id:s.client_id||"",versions:vt(s.custom_data),main_screen:s.visible_wallets,wallets_menu:s.wallets_menu,trace_id:null!==(n=s.trace_id)&&void 0!==n?n:void 0,wallet_app_name:null!==(r=s.wallet_type)&&void 0!==r?r:"",wallet_redirect_method:s.wallet_redirect_method,wallet_redirect_link:s.wallet_redirect_link})}),e.addEventListener("ton-connect-connection-completed",e=>{const{detail:n}=e;t.emitConnectionCompleted(wt(n))}),e.addEventListener("ton-connect-connection-error",e=>{var n,r;const{detail:s}=e;t.emitConnectionError({client_id:s.custom_data.client_id||"",wallet_id:s.custom_data.wallet_id||"",error_code:null!==(n=s.error_code)&&void 0!==n?n:0,error_message:s.error_message,trace_id:null!==(r=s.trace_id)&&void 0!==r?r:void 0})}),e.addEventListener("ton-connect-disconnection",e=>{const{detail:n}=e;t.emitDisconnection(wt(n))}),e.addEventListener("ton-connect-transaction-sent-for-signature",e=>{const{detail:n}=e;t.emitTransactionSent(wt(n))}),e.addEventListener("ton-connect-transaction-signed",e=>{const{detail:n}=e;t.emitTransactionSigned(Object.assign(Object.assign({},wt(n)),{signed_boc:e.detail.signed_transaction}))}),e.addEventListener("ton-connect-transaction-signing-failed",e=>{var n;const{detail:r}=e;t.emitTransactionSigningFailed(Object.assign(Object.assign({},wt(r)),{valid_until:Number(r.valid_until),messages:r.messages.map(e=>{var t,n,r,s;return{address:null!==(t=e.address)&&void 0!==t?t:"",amount:null!==(n=e.amount)&&void 0!==n?n:"",payload:null!==(r=e.payload)&&void 0!==r?r:"",state_init:null!==(s=e.state_init)&&void 0!==s?s:""}}),error_message:r.error_message,error_code:null!==(n=r.error_code)&&void 0!==n?n:0}))}),e.addEventListener("ton-connect-sign-data-request-initiated",e=>{const{detail:n}=e;null==t||t.emitSignDataRequestInitiated(wt(n))}),e.addEventListener("ton-connect-sign-data-request-completed",e=>{const{detail:n}=e;null==t||t.emitSignDataRequestCompleted(wt(n))}),e.addEventListener("ton-connect-sign-data-request-failed",e=>{var n;const{detail:r}=e;let s,i="";"text"===r.data.type&&(i=r.data.text),"cell"===r.data.type&&(i=r.data.cell,s=r.data.schema),"binary"===r.data.type&&(i=r.data.bytes),null==t||t.emitSignDataRequestFailed(Object.assign(Object.assign({},wt(r)),{sign_data_type:r.data.type,sign_data_value:i,sign_data_schema:s,error_code:null!==(n=r.error_code)&&void 0!==n?n:0,error_message:r.error_message}))})}(t,a.scoped(l))}createProvider(e){let t;return t=!Array.isArray(e)&&"jsBridgeKey"in e?new Pe(this.bridgeConnectionStorage,e.jsBridgeKey,this.analytics):!Array.isArray(e)&&function(e){return"type"in e&&"wallet-connect"===e.type}(e)?new St(this.bridgeConnectionStorage):new Ee(this.bridgeConnectionStorage,e,this.analytics),t.listen(this.walletEventsListener.bind(this)),t}walletEventsListener(e){switch(e.event){case"connect":this.onWalletConnected(e.payload,{traceId:e.traceId});break;case"connect_error":this.tracker.trackConnectionError(e.payload.message,e.payload.code,this.getSessionInfo(),e.traceId);const t=ae.parseError(e.payload);this.onWalletConnectError(t);break;case"disconnect":this.onWalletDisconnected("wallet",{traceId:e.traceId})}}onWalletConnected(e,t){var n,r;const s=e.items.find(e=>"ton_addr"===e.name),i=e.items.find(e=>"ton_proof"===e.name);if(!s)throw new q("ton_addr connection item was not found");if(!We(e.device.features,this.walletsRequiredFeatures))return null===(n=this.provider)||void 0===n||n.disconnect(),void this.onWalletConnectError(new Y("Wallet does not support required features",{cause:{connectEvent:e}}));const a={device:e.device,provider:this.provider.type,account:{address:s.address,chain:s.network,walletStateInit:s.walletStateInit,publicKey:s.publicKey}};if(this.desiredChainId&&a.account.chain!==this.desiredChainId){const e=this.desiredChainId,t=a.account.chain;return null===(r=this.provider)||void 0===r||r.disconnect(),void this.onWalletConnectError(new Z("Wallet connected to a wrong network",{cause:{expectedChainId:e,actualChainId:t}}))}if(i){const e=function(e){if(!ct(e))return"ton_proof item must be an object";if(ut(e,["error","proof","name"]))return"ton_proof item contains extra properties";const t=Object.prototype.hasOwnProperty.call(e,"proof"),r=Object.prototype.hasOwnProperty.call(e,"error");if(!t&&!r)return"'ton_proof' item must contain either 'proof' or 'error'";if(t&&r)return"'ton_proof' item must contain either 'proof' or 'error', not both";if(t){const t=e.proof;if(!ct(t))return"Invalid 'proof' object";if(!st(t.timestamp))return"Invalid 'proof.timestamp'";const r=t.domain;if(!ct(r))return"Invalid 'proof.domain'";if(!st(r.lengthBytes))return"Invalid 'proof.domain.lengthBytes'";if(!it(r.value))return"Invalid 'proof.domain.value'";try{if(("undefined"!=typeof TextEncoder?(new TextEncoder).encode(r.value).length:r.value.length)!==r.lengthBytes)return"'proof.domain.lengthBytes' does not match 'proof.domain.value'"}catch(n){}if(!it(t.payload))return"Invalid 'proof.payload'";if(!it(t.signature)||!et.test(t.signature))return"Invalid 'proof.signature' format"}if(r){const t=e.error;if(!ct(t))return"Invalid 'error' object";if(ut(t,["code","message"]))return"ton_proof error contains extra properties";if(!st(t.code))return"Invalid 'error.code'";if(!it(t.message))return"Invalid 'error.message'"}return null}(i);let t;if(e)t={name:"ton_proof",error:{code:I.UNKNOWN_ERROR,message:e}};else try{if("proof"in i)t={name:"ton_proof",proof:{timestamp:i.proof.timestamp,domain:{lengthBytes:i.proof.domain.lengthBytes,value:i.proof.domain.value},payload:i.proof.payload,signature:i.proof.signature}};else{if(!("error"in i))throw new q("Invalid data format");t={name:"ton_proof",error:{code:i.error.code,message:i.error.message}}}}catch(bl){t={name:"ton_proof",error:{code:I.UNKNOWN_ERROR,message:"Invalid data format"}}}a.connectItems={tonProof:t}}this.wallet=a;const o=this.getSessionInfo();this.tracker.trackConnectionCompleted(a,o,null==t?void 0:t.traceId)}onWalletConnectError(e){if(this.statusChangeErrorSubscriptions.forEach(t=>t(e)),ye(e),e instanceof F||e instanceof z)throw ve(e),e}onWalletDisconnected(e,t){const n=this.getSessionInfo();this.tracker.trackDisconnection(this.wallet,e,n,null==t?void 0:t.traceId),this.wallet=null}checkConnection(){if(!this.connected)throw new G}createConnectRequest(e){const t=[Object.assign({name:"ton_addr"},this.desiredChainId?{network:this.desiredChainId}:{})];return(null==e?void 0:e.tonProof)&&t.push({name:"ton_proof",payload:e.tonProof}),{manifestUrl:this.dappSettings.manifestUrl,items:t}}}kt.walletsList=new Me,kt.isWalletInjected=e=>Pe.isWalletInjected(e),kt.isInsideWalletBrowser=e=>Pe.isInsideWalletBrowser(e);let jt=null;const Et=t.createContext(null);function Tt({children:t}){const n=(jt||(jt=new kt({manifestUrl:"https://tap-duel-game-production.up.railway.app/tonconnect-manifest.json"})),jt);return e.jsx(Et.Provider,{value:n,children:t})}function Rt(){return t.useContext(Et)}
/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function Ct(){return Ct=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ct.apply(this,arguments)}var Ot;i(),function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(Ot||(Ot={}));const It="popstate";function Nt(e){return void 0===e&&(e={}),function(e,t,n,r){void 0===r&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,a=s.history,o=Ot.Pop,l=null,c=u();null==c&&(c=0,a.replaceState(Ct({},a.state,{idx:c}),""));function u(){return(a.state||{idx:null}).idx}function d(){o=Ot.Pop;let e=u(),t=null==e?null:e-c;c=e,l&&l({action:o,location:g.location,delta:t})}function h(e,t){o=Ot.Push;let r=$t(g.location,e,t);n&&n(r,e),c=u()+1;let d=Ut(r,c),h=g.createHref(r);try{a.pushState(d,"",h)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;s.location.assign(h)}i&&l&&l({action:o,location:g.location,delta:1})}function p(e,t){o=Ot.Replace;let r=$t(g.location,e,t);n&&n(r,e),c=u();let s=Ut(r,c),d=g.createHref(r);a.replaceState(s,"",d),i&&l&&l({action:o,location:g.location,delta:0})}function f(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,n="string"==typeof e?e:Lt(e);return n=n.replace(/ $/,"%20"),At(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}let g={get action(){return o},get location(){return e(s,a)},listen(e){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(It,d),l=e,()=>{s.removeEventListener(It,d),l=null}},createHref:e=>t(s,e),createURL:f,encodeLocation(e){let t=f(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:h,replace:p,go:e=>a.go(e)};return g}(function(e,t){let{pathname:n="/",search:r="",hash:s=""}=Dt(e.location.hash.substr(1));return n.startsWith("/")||n.startsWith(".")||(n="/"+n),$t("",{pathname:n,search:r,hash:s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){let n=e.document.querySelector("base"),r="";if(n&&n.getAttribute("href")){let t=e.location.href,n=t.indexOf("#");r=-1===n?t:t.slice(0,n)}return r+"#"+("string"==typeof t?t:Lt(t))},function(e,t){Pt("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")},e)}function At(e,t){if(!1===e||null==e)throw new Error(t)}function Pt(e,t){if(!e){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(bl){}}}function Ut(e,t){return{usr:e.state,key:e.key,idx:t}}function $t(e,t,n,r){return void 0===n&&(n=null),Ct({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?Dt(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function Lt(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function Dt(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var Mt;function Bt(e,t,n){return void 0===n&&(n="/"),function(e,t,n){let r="string"==typeof t?Dt(t):t,s=en(r.pathname||"/",n);if(null==s)return null;let i=Wt(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(i);let a=null;for(let o=0;null==a&&o<i.length;++o){let e=Qt(s);a=Zt(i[o],e)}return a}(e,t,n)}function Wt(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let s=(e,s,i)=>{let a={relativePath:void 0===i?e.path||"":i,caseSensitive:!0===e.caseSensitive,childrenIndex:s,route:e};a.relativePath.startsWith("/")&&(At(a.relativePath.startsWith(r),'Absolute route path "'+a.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(r.length));let o=ln([r,a.relativePath]),l=n.concat(a);e.children&&e.children.length>0&&(At(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),Wt(e.children,t,l,o)),(null!=e.path||e.index)&&t.push({path:o,score:Yt(o,e.index),routesMeta:l})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of qt(e.path))s(e,t,r);else s(e,t)}),t}function qt(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(0===r.length)return s?[i,""]:[i];let a=qt(r.join("/")),o=[];return o.push(...a.map(e=>""===e?i:[i,e].join("/"))),s&&o.push(...a),o.map(t=>e.startsWith("/")&&""===t?"/":t)}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(Mt||(Mt={}));const Kt=/^:[\w-]+$/,zt=3,Ft=2,Ht=1,Gt=10,Jt=-2,Vt=e=>"*"===e;function Yt(e,t){let n=e.split("/"),r=n.length;return n.some(Vt)&&(r+=Jt),t&&(r+=Ft),n.filter(e=>!Vt(e)).reduce((e,t)=>e+(Kt.test(t)?zt:""===t?Ht:Gt),r)}function Zt(e,t,n){let{routesMeta:r}=e,s={},i="/",a=[];for(let o=0;o<r.length;++o){let e=r[o],n=o===r.length-1,l="/"===i?t:t.slice(i.length)||"/",c=Xt({path:e.relativePath,caseSensitive:e.caseSensitive,end:n},l),u=e.route;if(!c)return null;Object.assign(s,c.params),a.push({params:s,pathname:ln([i,c.pathname]),pathnameBase:cn(ln([i,c.pathnameBase])),route:u}),"/"!==c.pathnameBase&&(i=ln([i,c.pathnameBase]))}return a}function Xt(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);Pt("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(r.push({paramName:"*"}),s+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":""!==e&&"/"!==e&&(s+="(?:(?=\\/|$))");let i=new RegExp(s,t?void 0:"i");return[i,r]}(e.path,e.caseSensitive,e.end),s=t.match(n);if(!s)return null;let i=s[0],a=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((e,t,n)=>{let{paramName:r,isOptional:s}=t;if("*"===r){let e=o[n]||"";a=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}const l=o[n];return e[r]=s&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:i,pathnameBase:a,pattern:e}}function Qt(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return Pt(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function en(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}const tn=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function nn(e,t){void 0===t&&(t="/");let n,{pathname:r,search:s="",hash:i=""}="string"==typeof e?Dt(e):e;if(r)if(a=r,tn.test(a))n=r;else{if(r.includes("//")){let e=r;r=r.replace(/\/\/+/g,"/"),Pt(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+r)}n=r.startsWith("/")?rn(r.substring(1),"/"):rn(r,t)}else n=t;var a;return{pathname:n,search:un(s),hash:dn(i)}}function rn(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}function sn(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function an(e,t){let n=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function on(e,t,n,r){let s;void 0===r&&(r=!1),"string"==typeof e?s=Dt(e):(s=Ct({},e),At(!s.pathname||!s.pathname.includes("?"),sn("?","pathname","search",s)),At(!s.pathname||!s.pathname.includes("#"),sn("#","pathname","hash",s)),At(!s.search||!s.search.includes("#"),sn("#","search","hash",s)));let i,a=""===e||""===s.pathname,o=a?"/":s.pathname;if(null==o)i=n;else{let e=t.length-1;if(!r&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}i=e>=0?t[e]:"/"}let l=nn(s,i),c=o&&"/"!==o&&o.endsWith("/"),u=(a||"."===o)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}const ln=e=>e.join("/").replace(/\/\/+/g,"/"),cn=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),un=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",dn=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";const hn=["post","put","patch","delete"];new Set(hn);const pn=["get",...hn];
/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function fn(){return fn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},fn.apply(this,arguments)}new Set(pn);const gn=t.createContext(null),mn=t.createContext(null),yn=t.createContext(null),vn=t.createContext(null),wn=t.createContext({outlet:null,matches:[],isDataRoute:!1}),bn=t.createContext(null);function _n(){return null!=t.useContext(vn)}function xn(){return _n()||At(!1),t.useContext(vn).location}function Sn(e){t.useContext(yn).static||t.useLayoutEffect(e)}function kn(){let{isDataRoute:e}=t.useContext(wn);return e?function(){let{router:e}=function(){let e=t.useContext(gn);return e||At(!1),e}(In.UseNavigateStable),n=An(Nn.UseNavigateStable),r=t.useRef(!1);return Sn(()=>{r.current=!0}),t.useCallback(function(t,s){void 0===s&&(s={}),r.current&&("number"==typeof t?e.navigate(t):e.navigate(t,fn({fromRouteId:n},s)))},[e,n])}():function(){_n()||At(!1);let e=t.useContext(gn),{basename:n,future:r,navigator:s}=t.useContext(yn),{matches:i}=t.useContext(wn),{pathname:a}=xn(),o=JSON.stringify(an(i,r.v7_relativeSplatPath)),l=t.useRef(!1);return Sn(()=>{l.current=!0}),t.useCallback(function(t,r){if(void 0===r&&(r={}),!l.current)return;if("number"==typeof t)return void s.go(t);let i=on(t,JSON.parse(o),a,"path"===r.relative);null==e&&"/"!==n&&(i.pathname="/"===i.pathname?n:ln([n,i.pathname])),(r.replace?s.replace:s.push)(i,r.state,r)},[n,s,o,a,e])}()}function jn(e,n){let{relative:r}=void 0===n?{}:n,{future:s}=t.useContext(yn),{matches:i}=t.useContext(wn),{pathname:a}=xn(),o=JSON.stringify(an(i,s.v7_relativeSplatPath));return t.useMemo(()=>on(e,JSON.parse(o),a,"path"===r),[e,o,a,r])}function En(e,n){return function(e,n,r,s){_n()||At(!1);let{navigator:i}=t.useContext(yn),{matches:a}=t.useContext(wn),o=a[a.length-1],l=o?o.params:{};!o||o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let u,d=xn();if(n){var h;let e="string"==typeof n?Dt(n):n;"/"===c||(null==(h=e.pathname)?void 0:h.startsWith(c))||At(!1),u=e}else u=d;let p=u.pathname||"/",f=p;if("/"!==c){let e=c.replace(/^\//,"").split("/");f="/"+p.replace(/^\//,"").split("/").slice(e.length).join("/")}let g=Bt(e,{pathname:f}),m=function(e,n,r,s){var i;void 0===n&&(n=[]);void 0===r&&(r=null);void 0===s&&(s=null);if(null==e){var a;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(a=s)&&a.v7_partialHydration&&0===n.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let o=e,l=null==(i=r)?void 0:i.errors;if(null!=l){let e=o.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||At(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,u=-1;if(r&&s&&s.v7_partialHydration)for(let t=0;t<o.length;t++){let e=o[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:n}=r,s=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||s){c=!0,o=u>=0?o.slice(0,u+1):[o[0]];break}}}return o.reduceRight((e,s,i)=>{let a,d=!1,h=null,p=null;var f;r&&(a=l&&s.route.id?l[s.route.id]:void 0,h=s.route.errorElement||Rn,c&&(u<0&&0===i?(Pn[f="route-fallback"]||(Pn[f]=!0),d=!0,p=null):u===i&&(d=!0,p=s.route.hydrateFallbackElement||null)));let g=n.concat(o.slice(0,i+1)),m=()=>{let n;return n=a?h:d?p:s.route.Component?t.createElement(s.route.Component,null):s.route.element?s.route.element:e,t.createElement(On,{match:s,routeContext:{outlet:e,matches:g,isDataRoute:null!=r},children:n})};return r&&(s.route.ErrorBoundary||s.route.errorElement||0===i)?t.createElement(Cn,{location:r.location,revalidation:r.revalidation,component:h,error:a,children:m(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):m()},null)}(g&&g.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:ln([c,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:ln([c,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),a,r,s);if(n&&m)return t.createElement(vn.Provider,{value:{location:fn({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:Ot.Pop}},m);return m}(e,n)}function Tn(){let e=function(){var e;let n=t.useContext(bn),r=function(){let e=t.useContext(mn);return e||At(!1),e}(),s=An();if(void 0!==n)return n;return null==(e=r.errors)?void 0:e[s]}(),n=function(e){return null!=e&&"number"==typeof e.status&&"string"==typeof e.statusText&&"boolean"==typeof e.internal&&"data"in e}(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},n),r?t.createElement("pre",{style:s},r):null,null)}const Rn=t.createElement(Tn,null);class Cn extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(wn.Provider,{value:this.props.routeContext},t.createElement(bn.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function On(e){let{routeContext:n,match:r,children:s}=e,i=t.useContext(gn);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(wn.Provider,{value:n},s)}var In=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(In||{}),Nn=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Nn||{});function An(e){let n=function(){let e=t.useContext(wn);return e||At(!1),e}(),r=n.matches[n.matches.length-1];return r.route.id||At(!1),r.route.id}const Pn={};function Un(e){let{to:n,replace:r,state:s,relative:i}=e;_n()||At(!1);let{future:a,static:o}=t.useContext(yn),{matches:l}=t.useContext(wn),{pathname:c}=xn(),u=kn(),d=on(n,an(l,a.v7_relativeSplatPath),c,"path"===i),h=JSON.stringify(d);return t.useEffect(()=>u(JSON.parse(h),{replace:r,state:s,relative:i}),[u,h,i,r,s]),null}function $n(e){At(!1)}function Ln(e){let{basename:n="/",children:r=null,location:s,navigationType:i=Ot.Pop,navigator:a,static:o=!1,future:l}=e;_n()&&At(!1);let c=n.replace(/^\/*/,"/"),u=t.useMemo(()=>({basename:c,navigator:a,static:o,future:fn({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);"string"==typeof s&&(s=Dt(s));let{pathname:d="/",search:h="",hash:p="",state:f=null,key:g="default"}=s,m=t.useMemo(()=>{let e=en(d,c);return null==e?null:{location:{pathname:e,search:h,hash:p,state:f,key:g},navigationType:i}},[c,d,h,p,f,g,i]);return null==m?null:t.createElement(yn.Provider,{value:u},t.createElement(vn.Provider,{children:r,value:m}))}function Dn(e){let{children:t,location:n}=e;return En(Mn(t),n)}function Mn(e,n){void 0===n&&(n=[]);let r=[];return t.Children.forEach(e,(e,s)=>{if(!t.isValidElement(e))return;let i=[...n,s];if(e.type===t.Fragment)return void r.push.apply(r,Mn(e.props.children,i));e.type!==$n&&At(!1),e.props.index&&e.props.children&&At(!1);let a={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Mn(e.props.children,i)),r.push(a)}),r}
/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bn(){return Bn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Bn.apply(this,arguments)}new Promise(()=>{});const Wn=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(bl){}const qn=n.startTransition;function Kn(e){let{basename:n,children:r,future:s,window:i}=e,a=t.useRef();null==a.current&&(a.current=Nt({window:i,v5Compat:!0}));let o=a.current,[l,c]=t.useState({action:o.action,location:o.location}),{v7_startTransition:u}=s||{},d=t.useCallback(e=>{u&&qn?qn(()=>c(e)):c(e)},[c,u]);return t.useLayoutEffect(()=>o.listen(d),[o,d]),t.useEffect(()=>{return null==(e=s)||e.v7_startTransition,void(null==e||e.v7_relativeSplatPath);var e},[s]),t.createElement(Ln,{basename:n,children:r,location:l.location,navigationType:l.action,navigator:o,future:s})}const zn="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement,Fn=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Hn=t.forwardRef(function(e,n){let r,{onClick:s,relative:i,reloadDocument:a,replace:o,state:l,target:c,to:u,preventScrollReset:d,viewTransition:h}=e,p=function(e,t){if(null==e)return{};var n,r,s={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,Wn),{basename:f}=t.useContext(yn),g=!1;if("string"==typeof u&&Fn.test(u)&&(r=u,zn))try{let e=new URL(window.location.href),t=u.startsWith("//")?new URL(e.protocol+u):new URL(u),n=en(t.pathname,f);t.origin===e.origin&&null!=n?u=n+t.search+t.hash:g=!0}catch(bl){}let m=function(e,n){let{relative:r}=void 0===n?{}:n;_n()||At(!1);let{basename:s,navigator:i}=t.useContext(yn),{hash:a,pathname:o,search:l}=jn(e,{relative:r}),c=o;return"/"!==s&&(c="/"===o?s:ln([s,o])),i.createHref({pathname:c,search:l,hash:a})}(u,{relative:i}),y=function(e,n){let{target:r,replace:s,state:i,preventScrollReset:a,relative:o,viewTransition:l}=void 0===n?{}:n,c=kn(),u=xn(),d=jn(e,{relative:o});return t.useCallback(t=>{if(function(e,t){return!(0!==e.button||t&&"_self"!==t||function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e))}(t,r)){t.preventDefault();let n=void 0!==s?s:Lt(u)===Lt(d);c(e,{replace:n,state:i,preventScrollReset:a,relative:o,viewTransition:l})}},[u,c,d,s,i,r,e,a,o,l])}(u,{replace:o,state:l,target:c,preventScrollReset:d,relative:i,viewTransition:h});return t.createElement("a",Bn({},p,{href:r||m,onClick:g||a?s:function(e){s&&s(e),e.defaultPrevented||y(e)},ref:n,target:c}))});var Gn,Jn,Vn,Yn;(Jn=Gn||(Gn={})).UseScrollRestoration="useScrollRestoration",Jn.UseSubmit="useSubmit",Jn.UseSubmitFetcher="useSubmitFetcher",Jn.UseFetcher="useFetcher",Jn.useViewTransitionState="useViewTransitionState",(Yn=Vn||(Vn={})).UseFetcher="useFetcher",Yn.UseFetchers="useFetchers",Yn.UseScrollRestoration="useScrollRestoration";var Zn=Object.defineProperty,Xn=(e,t,n)=>(((e,t,n)=>{t in e?Zn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,t+"",n),n);const Qn=new class{constructor(e,t){this.prefix=e,this.enabled=t}print(e,...t){if(!this.enabled)return;const n=new Date,r=Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",fractionalSecondDigits:3,timeZone:"UTC"}).format(n);console[e](`[${r}]`,this.prefix,...t)}disable(){this.enabled=!1}error(...e){this.print("error",...e)}enable(){this.enabled=!0}log(...e){this.print("log",...e)}warn(...e){this.print("warn",...e)}}("[SDK]",!1);let er=class e extends Error{constructor(t,{cause:n,type:r}={}){super("Unable to parse value"+(r?` as ${r}`:""),{cause:n}),Xn(this,"type"),this.value=t,Object.setPrototypeOf(this,e.prototype),this.type=r}};class tr extends Error{constructor(e,{cause:t,type:n}={}){super(`Unable to parse field "${e}"${n?` as ${n}`:""}`,{cause:t}),Object.setPrototypeOf(this,tr.prototype)}}function nr(e,t){const n={};for(const s in e){const i=e[s];if(!i)continue;let a,o,l;if("function"==typeof i||"parse"in i)a=s,o="function"==typeof i?i:i.parse.bind(i);else{const{type:e}=i;a=i.from||s,o="function"==typeof e?e:e.parse.bind(e)}const c=t(a);try{l=o(c)}catch(r){throw new tr(a,r instanceof er?{type:r.type,cause:r}:{cause:r})}void 0!==l&&(n[s]=l)}return n}function rr(){return new TypeError("Value has unexpected type")}function sr(e){let t=e;if("string"==typeof t&&(t=JSON.parse(t)),"object"!=typeof t||null===t||Array.isArray(t))throw rr();return t}class ir{constructor(e,t,n){this.parser=e,this.isOptional=t,this.type=n}parse(e){if(!this.isOptional||void 0!==e)try{return this.parser(e)}catch(t){throw new er(e,{type:this.type,cause:t})}}optional(){return this.isOptional=!0,this}}function ar(e,t){return new ir(t=>{const n=sr(t);return nr(e,e=>n[e])},!1,t)}function or(e,t){return()=>new ir(e,!1,t)}const lr=or(e=>{if("string"==typeof e||"number"==typeof e)return e.toString();throw rr()},"string");const cr=or(e=>function(e){const t=e.replace(/\s/g,"").toLowerCase();if(function(e){return/^#[\da-f]{6}$/i.test(e)}(t))return t;if(function(e){return/^#[\da-f]{3}$/i.test(e)}(t)){let e="#";for(let n=0;n<3;n+=1)e+=t[1+n].repeat(2);return e}const n=t.match(/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)$/)||t.match(/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),\d{1,3}\)$/);if(null===n)throw new Error(`Value "${e}" does not satisfy any of known RGB formats.`);return n.slice(1).reduce((e,t)=>{const n=parseInt(t,10).toString(16);return e+(1===n.length?"0":"")+n},"#")}(lr().parse(e)),"rgb"),ur=or(e=>{if("boolean"==typeof e)return e;const t=String(e);if("1"===t||"true"===t)return!0;if("0"===t||"false"===t)return!1;throw rr()},"boolean"),dr=or(e=>{if("number"==typeof e)return e;if("string"==typeof e){const t=Number(e);if(!Number.isNaN(t))return t}throw rr()},"number");function hr(){return ar({addedToAttachmentMenu:{type:ur().optional(),from:"added_to_attachment_menu"},allowsWriteToPm:{type:ur().optional(),from:"allows_write_to_pm"},firstName:{type:lr(),from:"first_name"},id:dr(),isBot:{type:ur().optional(),from:"is_bot"},isPremium:{type:ur().optional(),from:"is_premium"},languageCode:{type:lr().optional(),from:"language_code"},lastName:{type:lr().optional(),from:"last_name"},photoUrl:{type:lr().optional(),from:"photo_url"},username:lr().optional()},"User")}const pr=or(e=>e instanceof Date?e:new Date(1e3*dr().parse(e)),"Date");function fr(e,t){return new ir(t=>{if("string"!=typeof t&&!(t instanceof URLSearchParams))throw rr();const n="string"==typeof t?new URLSearchParams(t):t;return nr(e,e=>{const t=n.get(e);return null===t?void 0:t})},!1,t)}fr({contact:ar({userId:{type:dr(),from:"user_id"},phoneNumber:{type:lr(),from:"phone_number"},firstName:{type:lr(),from:"first_name"},lastName:{type:lr().optional(),from:"last_name"}}),authDate:{type:pr(),from:"auth_date"},hash:lr()});const gr=or(e=>{const t=cr().optional();return Object.entries(sr(e)).reduce((e,[n,r])=>(e[function(e){return e.replace(/(^|_)bg/,(e,t)=>`${t}background`).replace(/_([a-z])/g,(e,t)=>t.toUpperCase())}(n)]=t.parse(r),e),{})},"ThemeParams");function mr(e){return fr({botInline:{type:ur().optional(),from:"tgWebAppBotInline"},initData:{type:fr({authDate:{type:pr(),from:"auth_date"},canSendAfter:{type:dr().optional(),from:"can_send_after"},chat:ar({id:dr(),type:lr(),title:lr(),photoUrl:{type:lr().optional(),from:"photo_url"},username:lr().optional()},"Chat").optional(),chatInstance:{type:lr().optional(),from:"chat_instance"},chatType:{type:lr().optional(),from:"chat_type"},hash:lr(),queryId:{type:lr().optional(),from:"query_id"},receiver:hr().optional(),startParam:{type:lr().optional(),from:"start_param"},user:hr().optional()},"InitData").optional(),from:"tgWebAppData"},initDataRaw:{type:lr().optional(),from:"tgWebAppData"},platform:{type:lr(),from:"tgWebAppPlatform"},showSettings:{type:ur().optional(),from:"tgWebAppShowSettings"},startParam:{type:lr().optional(),from:"tgWebAppStartParam"},themeParams:{type:gr(),from:"tgWebAppThemeParams"},version:{type:lr(),from:"tgWebAppVersion"}},"LaunchParams").parse(e)}function yr(e){return mr(e.includes("?")?e.replace("#","&").slice(e.indexOf("?")+1):e.slice(e.indexOf("#")+1))}function vr(){return yr(window.location.href)}function wr(){const e=performance.getEntriesByType("navigation")[0];if(!e)throw new Error("Unable to get first navigation entry.");return yr(e.name)}function br(e){const{initDataRaw:t,themeParams:n,platform:r,version:s,showSettings:i,startParam:a,botInline:o}=e,l=new URLSearchParams;return t&&l.set("tgWebAppData",t),l.set("tgWebAppPlatform",r),l.set("tgWebAppThemeParams",function(e){return JSON.stringify(Object.entries(e).reduce((e,[t,n])=>(n&&(e[function(e){return e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`).replace(/(^|_)background/,(e,t)=>`${t}bg`)}(t)]=n),e),{}))}(n)),l.set("tgWebAppVersion",s),a&&l.set("tgWebAppStartParam",s),"boolean"==typeof i&&l.set("tgWebAppShowSettings",i?"1":"0"),"boolean"==typeof o&&l.set("tgWebAppBotInline",o?"1":"0"),l.toString()}const _r="telegram-mini-apps-launch-params";function xr(){return mr(sessionStorage.getItem(_r)||"")}function Sr(e){sessionStorage.setItem(_r,br(e))}function kr(){const e=[];for(const n of[vr,wr,xr])try{const e=n();return Sr(e),e}catch(t){e.push(t)}throw Qn.error("Unable to extract launch parameters. Received errors:",e),new Error("Unable to retrieve launch parameters from any known source.")}const jr=t.createContext({loading:!1});function Er(e){const{initResult:n}=t.useContext(jr);if(!n)throw new Error(`Unable to get init result key "${e}" as long as SDK is not initialized`);return n[e]}function Tr(e){return Object.create(Object.getPrototypeOf(e),Object.getOwnPropertyDescriptors(e))}function Rr(e,n){return n?()=>function(e){const n=Er(e),[r,s]=t.useState(Tr(n));return t.useEffect(()=>n.on("change",()=>{s(Tr(n))}),[n]),r}(e):()=>Er(e)}jr.displayName="SDKContext";const Cr=Rr("backButton",!0),Or=Rr("initData");function Ir(){return t.useMemo(kr,[])}const Nr=Rr("miniApp",!0),Ar=Rr("themeParams",!0),Pr=Rr("utils");function Ur(){return Ur=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ur.apply(this,arguments)}function $r(e){if(null==e)throw new TypeError("Cannot destructure "+e);return e}const Lr=()=>(()=>{const e=t.useContext(a);if(!e.isRendered)throw new Error("[TGUI] Wrap your app with <AppRoot> component");return e})().platform||"base",Dr=o?t.useLayoutEffect:t.useEffect,Mr=()=>{const[e,n]=t.useState([]),r=t.useMemo(()=>new Map,[]),s=((e,n)=>{const r=t.useRef({callbackFunction:e,duration:n});Dr(()=>{r.current.callbackFunction=e,r.current.duration=n},[e,n]);const s=t.useRef(),i=t.useCallback(()=>clearTimeout(null==s?void 0:s.current),[]);return{set:t.useCallback(()=>{i(),s.current=setTimeout(r.current.callbackFunction,r.current.duration)},[i]),clear:i}})(()=>n([]),225);return{clicks:e,onPointerDown:t=>{const{top:i,left:a}=t.currentTarget.getBoundingClientRect(),o=t.clientX-(null!=a?a:0),l=t.clientY-(null!=i?i:0);r.set(t.pointerId,setTimeout(()=>function(t,i,a){const o=Date.now(),l=e.filter(e=>e.date+225>o);n([...l,{x:t,y:i,date:o,pointerId:a}]),s.set(),r.delete(a)}(o,l,t.pointerId),70))},onPointerCancel:e=>{const t=r.get(e.pointerId);clearTimeout(t),r.delete(e.pointerId)}}},Br=({clicks:t})=>e.jsx("span",{"aria-hidden":!0,className:"tgui-8071f6e38c77bc0b",children:t.map(t=>e.jsx("span",{className:"tgui-e156954daf886976",style:{top:t.y,left:t.x}},t.date))}),Wr=t.forwardRef((t,n)=>{var{Component:r="div",children:s,className:i,interactiveAnimation:a="background",readOnly:o}=t,h=l(t,["Component","children","className","interactiveAnimation","readOnly"]);const p=Lr(),{clicks:f,onPointerCancel:g,onPointerDown:m}=Mr(),y="base"===p&&"background"===a&&!o;return e.jsxs(r,c(u({ref:n,className:d("tgui-b5d680db78c4cc2e","ios"===p&&"tgui-34eb6f8b96874d40","opacity"===a&&"tgui-7c5d6c1f6bbe3eaf",i),onPointerCancel:g,onPointerDown:m,readOnly:o},h),{children:[y&&e.jsx(Br,{clicks:f}),s]}))}),qr={1:"tgui-30064fce0d501f17",2:"tgui-8f63cd31b2513281"},Kr=t.forwardRef((t,n)=>{var{level:r="1",className:s,Component:i}=t,a=l(t,["level","className","Component"]);return e.jsx(h,c(u({},a),{ref:n,className:d("tgui-266b6ffdbad2b90e",qr[r],s),Component:i||"h6"}))}),zr={1:"tgui-2916d621b0ea5857",2:"tgui-937d123c23df98b3"},Fr=t=>{var{level:n="1",className:r,Component:s}=t,i=l(t,["level","className","Component"]);return e.jsx(h,c(u({},i),{className:d("tgui-f37a43dcc29ade55",zr[n],r),Component:s||"span"}))},Hr=t.forwardRef((n,r)=>{var{children:s,titleBadge:i,hint:a,subhead:o,subtitle:h,description:g,className:m,before:y,after:v,Component:w,hovered:b,multiline:_}=n,x=l(n,["children","titleBadge","hint","subhead","subtitle","description","className","before","after","Component","hovered","multiline"]);const S=Lr(),{Title:k,Description:j}=(()=>{const n="ios"===Lr();return{Title:t.useCallback(t=>n?e.jsx(p,u({},t)):e.jsx(Kr,u({level:"1"},t)),[n]),Description:t.useCallback(t=>n?e.jsx(Fr,u({},t)):e.jsx(Kr,u({level:"2"},t)),[n])}})(),E=f(s)||f(a)||f(i);return e.jsxs(Wr,c(u({ref:r,Component:w||"div",className:d("tgui-b8dfba0b5c3d054c","ios"===S&&"tgui-7b5bccbb645b495f",b&&"tgui-7edaaf0c57797623",_&&"tgui-6c49dadccf648a5b",m)},x),{children:[f(y)&&e.jsx("div",{className:"tgui-aaa795d78c356ac1",children:y}),e.jsxs("div",{className:"tgui-8735a62be5a8b8a7",children:[f(o)&&e.jsx(Kr,{className:"tgui-46dd90b57ffed25f",level:"2",weight:"3",children:o}),E&&e.jsxs(k,{className:"tgui-a894f59f4c5ad72f",children:[f(s)&&e.jsx("span",{className:"tgui-1c6d7865a76a19bc",children:s}),f(a)&&e.jsx("span",{className:"tgui-bb909928b48f948b",children:a}),f(i)&&i]}),f(h)&&e.jsx(Kr,{className:"tgui-d528ef65a8b76273",level:"2",weight:"3",children:h}),f(g)&&e.jsx(j,{className:"tgui-fc059ed3ac5799a6",children:g})]}),f(v)&&e.jsx("div",{className:"tgui-56b2e897ed7ccb22",children:v})]}))}),Gr={s:t=>{var{children:n}=t,r=l(t,["children"]);return e.jsxs("svg",c(u({width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),{children:[e.jsx("use",{xlinkHref:"#spinner_24",fill:"none",children:n}),e.jsx("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",id:"spinner_24",children:e.jsx("path",{d:"M12 3c1.5644 0 3.1018.40778 4.4605 1.18312 1.3588.77535 2.492 1.89147 3.2878 3.23831.7959 1.34683 1.2269 2.87787 1.2507 4.44207.0237 1.5642-.3607 3.1076-1.1154 4.478-.7546 1.3703-1.8534 2.5203-3.188 3.3365-1.3347.8162-2.859 1.2704-4.4227 1.3179-1.5636.0474-3.11269-.3136-4.49433-1.0473-1.38163-.7338-2.54815-1.8151-3.38448-3.1371",stroke:"currentColor",strokeWidth:"2.2",strokeLinecap:"round"})})]}))},m:t=>{var{children:n}=t,r=l(t,["children"]);return e.jsxs("svg",c(u({width:"36",height:"36",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),{children:[e.jsx("use",{xlinkHref:"#spinner_36",fill:"none",children:n}),e.jsx("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 36 36",id:"spinner_36",children:e.jsx("path",{d:"M18 4c2.4335 0 4.825.63432 6.9386 1.84041S28.815 8.7827 30.053 10.8778c1.238 2.0951 1.9085 4.4766 1.9454 6.9099.0369 2.4332-.5611 4.8341-1.735 6.9657-1.1739 2.1317-2.8831 3.9205-4.9592 5.1902-2.0761 1.2696-4.4472 1.9762-6.8796 2.05-2.4324.0738-4.842-.4877-6.9913-1.6292-2.14918-1.1414-3.96375-2.8234-5.26472-4.8799",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})})]}))},l:t=>{var{children:n}=t,r=l(t,["children"]);return e.jsxs("svg",c(u({width:"44",height:"44",viewBox:"0 0 44 44",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r),{children:[e.jsx("use",{xlinkHref:"#spinner_44",fill:"none",children:n}),e.jsx("symbol",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 44 44",id:"spinner_44",children:e.jsx("path",{d:"M22 4C25.1288 4 28.2036 4.81556 30.9211 6.36624C33.6386 7.91693 35.9049 10.1492 37.4967 12.8429C39.0884 15.5365 39.9505 18.5986 39.9979 21.727C40.0454 24.8555 39.2765 27.9423 37.7672 30.683C36.258 33.4237 34.0603 35.7236 31.3911 37.356C28.7219 38.9884 25.6733 39.8968 22.5459 39.9917C19.4185 40.0866 16.3204 39.3647 13.5571 37.8971C10.7939 36.4296 8.46085 34.2671 6.78817 31.6229",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"})})]}))}},Jr={s:12,m:18,l:22},Vr=({size:t})=>{const n=Gr[t],r=Jr[t];return e.jsx(n,{children:e.jsx("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",from:`0 ${r} ${r}`,to:`360 ${r} ${r}`,dur:"0.7s",repeatCount:"indefinite"})})},Yr=t=>{var{children:n}=t,r=l(t,["children"]);return e.jsxs("svg",c(u({id:"l151:1947",width:"44",height:"44",viewBox:"0 0 44 44",xmlns:"http://www.w3.org/2000/svg"},r),{children:[e.jsx("g",{transform:"matrix(1,0,0,1,0,0)",children:e.jsx("g",{id:"l151:1947",opacity:"1",style:{mixBlendMode:"normal"},children:e.jsxs("g",{children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"l151:1947_clipPath",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("path",{d:"M0,0h44v0v44v0h-44v0v-44z",fill:"white",clipRule:"nonzero"})})}),e.jsxs("g",{clipPath:"url(#l151:1947_clipPath)",children:[e.jsx("g",{transform:"matrix(-0.7071067811865475,-0.7071067811865476,0.7071067811865476,-0.7071067811865475,9.2715,37.5564)",children:e.jsx("g",{id:"l151:1985",opacity:"0.837",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1985_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v10c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-10c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,20,29)",children:e.jsx("g",{id:"l151:1980",opacity:"0.467",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1980_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v9c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-9c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(0.7071067811865476,-0.7071067811865475,0.7071067811865475,0.7071067811865476,24.8291,27.6569)",children:e.jsx("g",{id:"l151:1982",opacity:"0.153",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1982_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v10c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-10c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(6.123233995736766e-17,-1,1,6.123233995736766e-17,29,24)",children:e.jsx("g",{id:"l151:1984",opacity:"0.049",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1984_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v9c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-9c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(-0.7071067811865475,-0.7071067811865476,0.7071067811865476,-0.7071067811865475,27.6592,19.1716)",children:e.jsx("g",{id:"l151:1986",opacity:"0.01",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1986_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v10c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-10c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,20,2)",children:e.jsx("g",{id:"l151:1979",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1979_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v9c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-9c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(0.7071067811865476,-0.7071067811865475,0.7071067811865475,0.7071067811865476,6.4473,9.2721)",children:e.jsx("g",{id:"l151:1981",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1981_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v10c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-10c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(6.123233995736766e-17,-1,1,6.123233995736766e-17,2,24)",children:e.jsx("g",{id:"l151:1983",opacity:"1",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"l151:1983_fill_path",d:"M2,0v0c1.10457,0 2,0.89543 2,2v9c0,1.10457 -0.89543,2 -2,2v0c-1.10457,0 -2,-0.89543 -2,-2v-9c0,-1.10457 0.89543,-2 2,-2z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})})]})]})})}),e.jsx("animate",{href:"#l151:1985",attributeName:"opacity",values:"0.837;0;1;0.8366;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.75;0.87;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1980",attributeName:"opacity",values:"0.467;0;1;0.4669;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.63;0.75;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1982",attributeName:"opacity",values:"0.153;0.05;1;0.1534;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.5;0.63;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1984",attributeName:"opacity",values:"0.049;0;1;0.0493;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.37;0.5;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1986",attributeName:"opacity",values:"0.01;0;1;0.0099;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.25;0.37;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1979",attributeName:"opacity",values:"0;0;1;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.13;0.25;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1981",attributeName:"opacity",values:"0;1;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.13;0.89;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#l151:1983",attributeName:"opacity",values:"1;0;1",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.89;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"})]}))},Zr=t=>{var{children:n}=t,r=l(t,["children"]);return e.jsxs("svg",c(u({xmlns:"http://www.w3.org/2000/svg",id:"m151:1947",width:"32",height:"32",viewBox:"0 0 32 32"},r),{children:[e.jsx("g",{transform:"matrix(1,0,0,1,0,0)",children:e.jsx("g",{id:"m151:1947",opacity:"1",style:{mixBlendMode:"normal"},children:e.jsxs("g",{children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"m151:1947_clipPath",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("path",{d:"M0,0h32v0v32v0h-32v0v-32z",fill:"white",clipRule:"nonzero"})})}),e.jsxs("g",{clipPath:"url(#151:1947_clipPath)",children:[e.jsx("g",{transform:"matrix(-0.7071067811865475,-0.7071067811865476,0.7071067811865476,-0.7071067811865475,6.7429,27.3137)",children:e.jsx("g",{id:"m151:1985",opacity:"0.837",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1985_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v7.1818c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-7.1818c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,14.5454,21.0909)",children:e.jsx("g",{id:"m151:1980",opacity:"0.467",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1980_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v6.4545c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-6.4545c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(0.7071067811865476,-0.7071067811865475,0.7071067811865475,0.7071067811865476,18.0575,20.1141)",children:e.jsx("g",{id:"m151:1982",opacity:"0.153",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1982_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v7.1818c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-7.1818c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(6.123233995736766e-17,-1,1,6.123233995736766e-17,21.0909,17.4545)",children:e.jsx("g",{id:"m151:1984",opacity:"0.049",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1984_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v6.4545c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-6.4545c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(-0.7071067811865475,-0.7071067811865476,0.7071067811865476,-0.7071067811865475,20.1157,13.943)",children:e.jsx("g",{id:"m151:1986",opacity:"0.01",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1986_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v7.1818c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-7.1818c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,14.5454,1.4545)",children:e.jsx("g",{id:"m151:1979",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1979_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v6.4545c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-6.4545c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(0.7071067811865476,-0.7071067811865475,0.7071067811865475,0.7071067811865476,4.6889,6.7433)",children:e.jsx("g",{id:"m151:1981",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1981_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v7.1818c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-7.1818c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(6.123233995736766e-17,-1,1,6.123233995736766e-17,1.4545,17.4545)",children:e.jsx("g",{id:"m151:1983",opacity:"1",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"m151:1983_fill_path",d:"M1.5,0v0c0.82843,0 1.5,0.67157 1.5,1.5v6.4545c0,0.82843 -0.67157,1.5 -1.5,1.5v0c-0.82843,0 -1.5,-0.67157 -1.5,-1.5v-6.4545c0,-0.82843 0.67157,-1.5 1.5,-1.5z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})})]})]})})}),e.jsx("animate",{href:"#m151:1985",attributeName:"opacity",values:"0.837;0;1;0.8366;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.75;0.87;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1980",attributeName:"opacity",values:"0.467;0;1;0.4669;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.63;0.75;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1982",attributeName:"opacity",values:"0.153;0.05;1;0.1534;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.5;0.63;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1984",attributeName:"opacity",values:"0.049;0;1;0.0493;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.37;0.5;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1986",attributeName:"opacity",values:"0.01;0;1;0.0099;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.25;0.37;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1979",attributeName:"opacity",values:"0;0;1;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.13;0.25;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1981",attributeName:"opacity",values:"0;1;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.13;0.89;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#m151:1983",attributeName:"opacity",values:"1;0;1",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.89;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"})]}))},Xr=t=>{var{children:n}=t,r=l(t,["children"]);return e.jsxs("svg",c(u({id:"s151:1947",width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},r),{children:[e.jsx("g",{transform:"matrix(1,0,0,1,0,0)",children:e.jsx("g",{id:"s151:1947",opacity:"1",style:{mixBlendMode:"normal"},children:e.jsxs("g",{children:[e.jsx("defs",{children:e.jsx("clipPath",{id:"s151:1947_clipPath",x:"-50%",y:"-50%",width:"200%",height:"200%",children:e.jsx("path",{d:"M0,0h24v0v24v0h-24v0v-24z",fill:"white",clipRule:"nonzero"})})}),e.jsxs("g",{clipPath:"url(#151:1947_clipPath)",children:[e.jsx("g",{transform:"matrix(-0.7071067811865475,-0.7071067811865476,0.7071067811865476,-0.7071067811865475,5.64,19.78)",children:e.jsx("g",{id:"s151:1985",opacity:"0.837",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1985_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,11,15)",children:e.jsx("g",{id:"s151:1980",opacity:"0.467",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1980_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(0.7071067811865476,-0.7071067811865475,0.7071067811865475,0.7071067811865476,13.41,14.83)",children:e.jsx("g",{id:"s151:1982",opacity:"0.153",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1982_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(6.123233995736766e-17,-1,1,6.123233995736766e-17,15,13)",children:e.jsx("g",{id:"s151:1984",opacity:"0.049",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1984_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,13.41,4.22)",children:e.jsx("g",{id:"s597:11660",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s597:11660_fill_path",d:"M2.0341,6.01101c-0.46533,0.46533 -1.21977,0.46533 -1.6851,0c-0.46533,-0.46533 -0.46533,-1.21977 0,-1.6851l3.97691,-3.97691c0.46533,-0.46533 1.21977,-0.46533 1.6851,0c0.46533,0.46533 0.46533,1.21977 0,1.6851z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(1,0,0,1,11,1.9998)",children:e.jsx("g",{id:"s151:1979",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1979_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(0.7071067811865476,-0.7071067811865475,0.7071067811865475,0.7071067811865476,4.22,5.64)",children:e.jsx("g",{id:"s151:1981",opacity:"0",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1981_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})}),e.jsx("g",{transform:"matrix(6.123233995736766e-17,-1,1,6.123233995736766e-17,2.0003,13)",children:e.jsx("g",{id:"s151:1983",opacity:"1",style:{mixBlendMode:"normal"},children:e.jsx("g",{children:e.jsx("g",{children:e.jsx("path",{id:"s151:1983_fill_path",d:"M1,0v0c0.55228,0 1,0.44772 1,1v5c0,0.55228 -0.44772,1 -1,1v0c-0.55228,0 -1,-0.44772 -1,-1v-5c0,-0.55228 0.44772,-1 1,-1z",fillRule:"nonzero",fill:"currentColor",fillOpacity:"1",style:{mixBlendMode:"normal"}})})})})})]})]})})}),e.jsx("animate",{href:"#s151:1985",attributeName:"opacity",values:"0.837;0;1;0.8366;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.75;0.87;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s151:1980",attributeName:"opacity",values:"0.467;0;1;0.4669;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.63;0.75;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s151:1982",attributeName:"opacity",values:"0.153;0.05;1;0.1534;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.5;0.63;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s151:1984",attributeName:"opacity",values:"0.049;0;1;0.0493;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.37;0.5;1;1;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s597:11660",attributeName:"opacity",values:"0;0;1;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.25;0.37;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s151:1979",attributeName:"opacity",values:"0;0;1;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.13;0.25;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s151:1981",attributeName:"opacity",values:"0;1;0;0",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.13;0.89;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"}),e.jsx("animate",{href:"#s151:1983",attributeName:"opacity",values:"1;0;1",dur:"0.8s",repeatCount:"indefinite",calcMode:"spline",keyTimes:"0;0.89;1",keySplines:"0.5 0.35 0.15 1;0.5 0.35 0.15 1",additive:"replace",fill:"freeze"})]}))},Qr=({size:t})=>{switch(t){case"l":return e.jsx(Yr,{});case"m":return e.jsx(Zr,{});default:return e.jsx(Xr,{})}},es={s:"tgui-421d6dab8d2c78c1",m:"tgui-a636342f03bb5c08",l:"tgui-a53583a4b6d8fde0"},ts=({size:t="m",className:n})=>{const r=Lr(),s="ios"===r?Qr:Vr;return e.jsx("div",{role:"status",className:d("tgui-0ac8c3540e603b63","ios"===r&&"tgui-562a3eae646b486d",es[t],n),children:e.jsx(s,{size:t})})},ns=t=>{var{size:n}=t,r=l(t,["size"]);return"l"===n?e.jsx(p,u({weight:"2"},r)):e.jsx(Kr,u({level:"2",weight:"2"},r))},rs={filled:"tgui-8a1ca9efa24f4809",bezeled:"tgui-91bda9a36246a33c",plain:"tgui-48956537c34690db",gray:"tgui-93106efd6b6d66ee",outline:"tgui-e884e36ff1faa596",white:"tgui-ba6d30cc81e39ae5"},ss={s:"tgui-13f23a224303ddaa",m:"tgui-1a16a49d89076ff4",l:"tgui-9cef742a22f195c9"},is=t.forwardRef((t,n)=>{var{type:r,size:s="m",before:i,after:a,stretched:o,children:h,className:p,mode:g="filled",loading:m,Component:y="button"}=t,v=l(t,["type","size","before","after","stretched","children","className","mode","loading","Component"]);const w=Lr();return e.jsxs(Wr,c(u({ref:n,type:r||"button",Component:y,className:d("tgui-117e77cd385a9c8d",g&&rs[g],s&&ss[s],"ios"===w&&"tgui-55e8aa7f5cea2280",o&&"tgui-726846958fe7f4a0",m&&"tgui-490cb0f5ec4998f3",p)},v),{children:[m&&e.jsx(ts,{className:"tgui-014f2b7d196b090d",size:"s"}),f(i)&&e.jsx("div",{className:"tgui-06cc94d03a7c4dd7",children:i}),e.jsx(ns,{className:"tgui-5f6014c0f063b6de",size:s,children:h}),f(a)&&e.jsx("div",{className:"tgui-8310172a5320ab71",children:a})]}))}),as=t=>{var{className:n,children:r,Component:s="div"}=t,i=l(t,["className","children","Component"]);const a=Lr();return e.jsx(s,c(u({className:d("tgui-389a43acd684137a","ios"===a&&"tgui-cfed40fe81d34ad5",n)},i),{children:r}))},os=t=>{var{className:n}=t,r=l(t,["className"]);return e.jsx("hr",u({className:d("tgui-8af0d10d5540c6cc",n)},r))},ls=t=>{var n=Ur({},$r(t));return"ios"===Lr()?e.jsx(Fr,u({},n)):e.jsx(Kr,u({level:"2"},n))},cs=t=>{var{className:n,children:r,centered:s}=t,i=l(t,["className","children","centered"]);const a=Lr();return e.jsx("footer",c(u({className:d("tgui-dbb364e8ced00cc8","ios"===a&&"tgui-8c4c6f82ba895475",s&&"tgui-8ebba379083b615a",n)},i),{children:e.jsx(ls,{className:"tgui-67471b69da3e3062",children:r})}))},us=t=>{var{large:n,className:r,children:s}=t,i=l(t,["large","className","children"]);const a=Lr(),{Default:o,Large:h}=(()=>{const t=Lr();return{Default:n=>{var r=Ur({},$r(n));return"ios"===t?e.jsx(Fr,u({caps:!0},r)):e.jsx(Kr,u({level:"2",weight:"2"},r))},Large:n=>{var r=Ur({},$r(n));return"ios"===t?e.jsx(Kr,u({level:"1",weight:"2"},r)):e.jsx(p,u({weight:"2"},r))}}})(),f=n?h:o;return e.jsx("header",c(u({className:d("tgui-d0251b46536ac046","ios"===a&&"tgui-b7217abb24e8763a",n&&"tgui-34fd1a25cc171439",r)},i),{children:e.jsx(f,{Component:"h1",className:"tgui-9c200683b316fde6",children:s})}))},ds=n=>{var{header:r,footer:s,className:i,children:a}=n,o=l(n,["header","footer","className","children"]);const h=Lr(),p=g(r)?e.jsx(us,{children:r}):r,f=g(s)?e.jsx(cs,{children:s}):s;return e.jsxs("section",c(u({className:d("tgui-3dfa44f9f78f9a22","base"===h&&"tgui-8e15431b81f6601e","ios"===h&&"tgui-97eca24324122dbc",i)},o),{children:[e.jsxs("div",{className:"tgui-db9be63c4fecf79b",children:[p,e.jsx("div",{className:"tgui-4b78bed6e925088e",children:t.Children.map(a,(n,r)=>e.jsxs(e.Fragment,{children:[n,r<t.Children.count(a)-1&&e.jsx(os,{className:"tgui-a6d406c4dc060899"})]}))})]}),f]}))};ds.Header=us,ds.Footer=cs;const hs=t.forwardRef((t,n)=>{var{Component:r="span",className:s}=t,i=l(t,["Component","className"]);return e.jsx(r,c(u({},i),{ref:n,className:d("tgui-b9fd8cdf929947df",s)}))}),ps=t=>{var n=Ur({},$r(t));return e.jsx("svg",c(u({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),{children:e.jsx("path",{d:"M6.4 1h7.2c1.14 0 1.93 0 2.55.05.6.05.95.14 1.21.28a3 3 0 0 1 1.31 1.3c.14.27.23.62.28 1.22.05.62.05 1.41.05 2.55v7.2c0 1.14 0 1.93-.05 2.55-.05.6-.14.95-.28 1.21a3 3 0 0 1-1.3 1.31c-.27.14-.62.23-1.22.28-.62.05-1.41.05-2.55.05H6.4c-1.14 0-1.93 0-2.55-.05-.6-.05-.95-.14-1.21-.28a3 3 0 0 1-1.31-1.3 3.2 3.2 0 0 1-.28-1.22A34.7 34.7 0 0 1 1 13.6V6.4c0-1.14 0-1.93.05-2.55.05-.6.14-.95.28-1.21a3 3 0 0 1 1.3-1.31 3.2 3.2 0 0 1 1.22-.28C4.47 1 5.26 1 6.4 1Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}))},fs=t=>{var n=Ur({},$r(t));return e.jsxs("svg",c(u({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),{children:[e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M.48 2.87C0 3.88 0 5.2 0 7.8v4.4c0 2.61 0 3.92.48 4.93a5 5 0 0 0 2.4 2.4c1 .47 2.3.47 4.92.47h4.4c2.61 0 3.92 0 4.93-.48a5 5 0 0 0 2.4-2.4c.47-1 .47-2.3.47-4.92V7.8c0-2.61 0-3.92-.48-4.93a5 5 0 0 0-2.4-2.4C16.13 0 14.83 0 12.2 0H7.8C5.19 0 3.88 0 2.87.48a5 5 0 0 0-2.4 2.4ZM15.7 7.46a1 1 0 0 0-1.42-1.42L8 12.34l-2.3-2.3a1 1 0 1 0-1.4 1.42l3 3a1 1 0 0 0 1.4 0l7-7Z",fill:"currentColor"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.7 7.46a1 1 0 0 0-1.4-1.42L8 12.34l-2.3-2.3a1 1 0 1 0-1.4 1.42l3 3a1 1 0 0 0 1.4 0l7-7Z",fill:"#fff"})]}))},gs=t=>{var n=Ur({},$r(t));return e.jsxs("svg",c(u({width:"20",height:"20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n),{children:[e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.4 0h7.2c2.24 0 3.36 0 4.22.44a4 4 0 0 1 1.74 1.74c.44.86.44 1.98.44 4.22v7.2c0 2.24 0 3.36-.44 4.22a4 4 0 0 1-1.74 1.74c-.86.44-1.98.44-4.22.44H6.4c-2.24 0-3.36 0-4.22-.44a4 4 0 0 1-1.74-1.74C0 16.96 0 15.84 0 13.6V6.4c0-2.24 0-3.36.44-4.22A4 4 0 0 1 2.18.44C3.04 0 4.16 0 6.4 0ZM4 10a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Z",fill:"currentColor"}),e.jsx("path",{d:"M4 10a1 1 0 0 1 1-1h10a1 1 0 1 1 0 2H5a1 1 0 0 1-1-1Z",fill:"#fff"})]}))},ms=t.forwardRef((t,n)=>{var{style:r,className:s,disabled:i,indeterminate:a}=t,o=l(t,["style","className","disabled","indeterminate"]);return e.jsxs("label",{className:d("tgui-abbb25a9ce45033e",i&&"tgui-6e9776e8c33b2626",s),children:[e.jsx(hs,c(u({},o),{ref:n,Component:"input",type:"checkbox",className:"tgui-60cf4cc79ba44c4f",disabled:i})),e.jsx(ps,{className:"tgui-21b20ecaad17ccf9","aria-hidden":!0}),e.jsx("div",{"aria-hidden":!0,className:"tgui-bca5056bf34297b0",children:a?e.jsx(gs,{}):e.jsx(fs,{})})]})});function ys(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}function vs(e,t,n,r){return new(n||(n=Promise))(function(s,i){function a(e){try{l(r.next(e))}catch(bl){i(bl)}}function o(e){try{l(r.throw(e))}catch(bl){i(bl)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})}function ws({className:t}){const n=Rt();return e.jsx("button",{className:t,onClick:()=>{n.connected?n.disconnect():n.connect()},style:{padding:"8px 16px",borderRadius:"8px",backgroundColor:n.connected?"#ff4444":"#0088cc",color:"white",border:"none",cursor:"pointer",fontSize:"14px"},children:n.connected?"Disconnect":"Connect Wallet"})}"function"==typeof SuppressedError&&SuppressedError;class bs extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class _s extends bs{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class xs extends bs{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ss extends bs{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var ks;!function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"}(ks||(ks={}));class js{constructor(e,{headers:t={},customFetch:n,region:r=ks.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return vs(this,arguments,void 0,function*(e,t={}){var n;let r,s;try{const{headers:i,method:a,body:o,signal:l,timeout:c}=t;let u={},{region:d}=t;d||(d=this.region);const h=new URL(`${this.url}/${e}`);let p;d&&"any"!==d&&(u["x-region"]=d,h.searchParams.set("forceFunctionRegion",d)),o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?"undefined"!=typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",p=o):"string"==typeof o?(u["Content-Type"]="text/plain",p=o):"undefined"!=typeof FormData&&o instanceof FormData?p=o:(u["Content-Type"]="application/json",p=JSON.stringify(o)):p=!o||"string"==typeof o||"undefined"!=typeof Blob&&o instanceof Blob||o instanceof ArrayBuffer||"undefined"!=typeof FormData&&o instanceof FormData?o:JSON.stringify(o);let f=l;c&&(s=new AbortController,r=setTimeout(()=>s.abort(),c),l?(f=s.signal,l.addEventListener("abort",()=>s.abort())):f=s.signal);const g=yield this.fetch(h.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),i),body:p,signal:f}).catch(e=>{throw new _s(e)}),m=g.headers.get("x-relay-error");if(m&&"true"===m)throw new xs(g);if(!g.ok)throw new Ss(g);let y,v=(null!==(n=g.headers.get("Content-Type"))&&void 0!==n?n:"text/plain").split(";")[0].trim();return y="application/json"===v?yield g.json():"application/octet-stream"===v||"application/pdf"===v?yield g.blob():"text/event-stream"===v?g:"multipart/form-data"===v?yield g.formData():yield g.text(),{data:y,error:null,response:g}}catch(i){return{data:null,error:i,response:i instanceof Ss||i instanceof xs?i.context:void 0}}finally{r&&clearTimeout(r)}})}}var Es=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}},Ts=class{constructor(e){var t,n,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(n=e.isMaybeSingle)&&void 0!==n&&n,this.urlLengthLimit=null!==(r=e.urlLengthLimit)&&void 0!==r?r:8e3,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){var n=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{let t=null,r=null,s=null,i=e.status,a=e.statusText;if(e.ok){var o,l;if("HEAD"!==n.method){var c;const t=await e.text();""===t||(r="text/csv"===n.headers.get("Accept")||n.headers.get("Accept")&&(null===(c=n.headers.get("Accept"))||void 0===c?void 0:c.includes("application/vnd.pgrst.plan+text"))?t:JSON.parse(t))}const u=null===(o=n.headers.get("Prefer"))||void 0===o?void 0:o.match(/count=(exact|planned|estimated)/),d=null===(l=e.headers.get("content-range"))||void 0===l?void 0:l.split("/");u&&d&&d.length>1&&(s=parseInt(d[1])),n.isMaybeSingle&&"GET"===n.method&&Array.isArray(r)&&(r.length>1?(t={code:"PGRST116",details:`Results contain ${r.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},r=null,s=null,i=406,a="Not Acceptable"):r=1===r.length?r[0]:null)}else{var u;const s=await e.text();try{t=JSON.parse(s),Array.isArray(t)&&404===e.status&&(r=[],t=null,i=200,a="OK")}catch(d){404===e.status&&""===s?(i=204,a="No Content"):t={message:s}}if(t&&n.isMaybeSingle&&(null==t||null===(u=t.details)||void 0===u?void 0:u.includes("0 rows"))&&(t=null,i=200,a="OK"),t&&n.shouldThrowOnError)throw new Es(t)}return{error:t,data:r,count:s,status:i,statusText:a}});return this.shouldThrowOnError||(r=r.catch(e=>{var t;let n="",r="",s="";const i=null==e?void 0:e.cause;if(i){var a,o,l,c;const t=null!==(a=null==i?void 0:i.message)&&void 0!==a?a:"",r=null!==(o=null==i?void 0:i.code)&&void 0!==o?o:"";n=`${null!==(l=null==e?void 0:e.name)&&void 0!==l?l:"FetchError"}: ${null==e?void 0:e.message}`,n+=`\n\nCaused by: ${null!==(c=null==i?void 0:i.name)&&void 0!==c?c:"Error"}: ${t}`,r&&(n+=` (${r})`),(null==i?void 0:i.stack)&&(n+=`\n${i.stack}`)}else{var u;n=null!==(u=null==e?void 0:e.stack)&&void 0!==u?u:""}const d=this.url.toString().length;return"AbortError"===(null==e?void 0:e.name)||"ABORT_ERR"===(null==e?void 0:e.code)?(s="",r="Request was aborted (timeout or manual cancellation)",d>this.urlLengthLimit&&(r+=`. Note: Your request URL is ${d} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):"HeadersOverflowError"!==(null==i?void 0:i.name)&&"UND_ERR_HEADERS_OVERFLOW"!==(null==i?void 0:i.code)||(s="",r="HTTP headers exceeded server limits (typically 16KB)",d>this.urlLengthLimit&&(r+=`. Your request URL is ${d} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:n,hint:r,code:s},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}},Rs=class extends Ts{select(e){let t=!1;const n=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:r,referencedTable:s=r}={}){const i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===n?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const r=void 0===n?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:r=n}={}){const s=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:r=!1,wal:s=!1,format:i="text"}={}){var a;const o=[e?"analyze":null,t?"verbose":null,n?"settings":null,r?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=null!==(a=this.headers.get("Accept"))&&void 0!==a?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};const Cs=new RegExp("[,()]");var Os=class extends Rs{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(e=>"string"==typeof e&&Cs.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}notIn(e,t){const n=Array.from(new Set(t)).map(e=>"string"==typeof e&&Cs.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`not.in.(${n})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:r}={}){let s="";"plain"===r?s="pl":"phrase"===r?s="ph":"websearch"===r&&(s="w");const i=void 0===n?"":`(${n})`;return this.url.searchParams.append(e,`${s}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}},Is=class{constructor(e,{headers:t={},schema:n,fetch:r,urlLengthLimit:s=8e3}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=r,this.urlLengthLimit=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(e,t){const{head:n=!1,count:r}=null!=t?t:{},s=n?"HEAD":"GET";let i=!1;const a=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join(""),{url:o,headers:l}=this.cloneRequestState();return o.searchParams.set("select",a),r&&l.append("Prefer",`count=${r}`),new Os({method:s,url:o,headers:l,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(e,{count:t,defaultToNull:n=!0}={}){var r;const{url:s,headers:i}=this.cloneRequestState();if(t&&i.append("Prefer",`count=${t}`),n||i.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);s.searchParams.set("columns",e.join(","))}}return new Os({method:"POST",url:s,headers:i,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:r,defaultToNull:s=!0}={}){var i;const{url:a,headers:o}=this.cloneRequestState();if(o.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),void 0!==t&&a.searchParams.set("on_conflict",t),r&&o.append("Prefer",`count=${r}`),s||o.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);a.searchParams.set("columns",e.join(","))}}return new Os({method:"POST",url:a,headers:o,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch,urlLengthLimit:this.urlLengthLimit})}update(e,{count:t}={}){var n;const{url:r,headers:s}=this.cloneRequestState();return t&&s.append("Prefer",`count=${t}`),new Os({method:"PATCH",url:r,headers:s,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:e}={}){var t;const{url:n,headers:r}=this.cloneRequestState();return e&&r.append("Prefer",`count=${e}`),new Os({method:"DELETE",url:n,headers:r,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch,urlLengthLimit:this.urlLengthLimit})}};function Ns(e){return(Ns="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function As(e){var t=function(e,t){if("object"!=Ns(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Ns(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ns(t)?t:t+""}function Ps(e,t,n){return(t=As(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Us(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function $s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Us(Object(n),!0).forEach(function(t){Ps(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Us(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Ls=class e{constructor(e,{headers:t={},schema:n,fetch:r,timeout:s,urlLengthLimit:i=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.urlLengthLimit=i;const a=null!=r?r:globalThis.fetch;this.fetch=void 0!==s&&s>0?(e,t)=>{const n=new AbortController,r=setTimeout(()=>n.abort(),s),i=null==t?void 0:t.signal;if(i){if(i.aborted)return clearTimeout(r),a(e,t);const s=()=>{clearTimeout(r),n.abort()};return i.addEventListener("abort",s,{once:!0}),a(e,$s($s({},t),{},{signal:n.signal})).finally(()=>{clearTimeout(r),i.removeEventListener("abort",s)})}return a(e,$s($s({},t),{},{signal:n.signal})).finally(()=>clearTimeout(r))}:a}from(e){if(!e||"string"!=typeof e||""===e.trim())throw new Error("Invalid relation name: relation must be a non-empty string.");return new Is(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:n=!1,get:r=!1,count:s}={}){var i;let a;const o=new URL(`${this.url}/rpc/${e}`);let l;const c=e=>null!==e&&"object"==typeof e&&(!Array.isArray(e)||e.some(c)),u=n&&Object.values(t).some(c);u?(a="POST",l=t):n||r?(a=n?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{o.searchParams.append(e,t)})):(a="POST",l=t);const d=new Headers(this.headers);return u?d.set("Prefer",s?`count=${s},return=minimal`:"return=minimal"):s&&d.set("Prefer",`count=${s}`),new Os({method:a,url:o,headers:d,schema:this.schemaName,body:l,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch,urlLengthLimit:this.urlLengthLimit})}};class Ds{constructor(){}static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const e=t.versions;if(e&&e.node){const t=e.node,n=parseInt(t.replace(/^v/,"").split(".")[0]);return n>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const Ms="2.0.0",Bs=Ms,Ws=1e4;var qs,Ks,zs,Fs,Hs,Gs;!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(qs||(qs={})),function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"}(Ks||(Ks={})),function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"}(zs||(zs={})),function(e){e.websocket="websocket"}(Fs||(Fs={})),function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"}(Hs||(Hs={}));class Js{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=null!=e?e:[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&"string"==typeof e.payload.event)return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null===(t=e.payload)||void 0===t?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,r)}_encodeJsonUserBroadcastPush(e){var t,n;const r=null!==(n=null===(t=e.payload)||void 0===t?void 0:t.payload)&&void 0!==n?n:{},s=(new TextEncoder).encode(JSON.stringify(r)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,s)}_encodeUserBroadcastPush(e,t,n){var r,s;const i=e.topic,a=null!==(r=e.ref)&&void 0!==r?r:"",o=null!==(s=e.join_ref)&&void 0!==s?s:"",l=e.payload.event,c=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},u=0===Object.keys(c).length?"":JSON.stringify(c);if(o.length>255)throw new Error(`joinRef length ${o.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(i.length>255)throw new Error(`topic length ${i.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`userEvent length ${l.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`metadata length ${u.length} exceeds maximum of 255`);const d=this.USER_BROADCAST_PUSH_META_LENGTH+o.length+a.length+i.length+l.length+u.length,h=new ArrayBuffer(this.HEADER_LENGTH+d);let p=new DataView(h),f=0;p.setUint8(f++,this.KINDS.userBroadcastPush),p.setUint8(f++,o.length),p.setUint8(f++,a.length),p.setUint8(f++,i.length),p.setUint8(f++,l.length),p.setUint8(f++,u.length),p.setUint8(f++,t),Array.from(o,e=>p.setUint8(f++,e.charCodeAt(0))),Array.from(a,e=>p.setUint8(f++,e.charCodeAt(0))),Array.from(i,e=>p.setUint8(f++,e.charCodeAt(0))),Array.from(l,e=>p.setUint8(f++,e.charCodeAt(0))),Array.from(u,e=>p.setUint8(f++,e.charCodeAt(0)));var g=new Uint8Array(h.byteLength+n.byteLength);return g.set(new Uint8Array(h),0),g.set(new Uint8Array(n),h.byteLength),g.buffer}decode(e,t){if(this._isArrayBuffer(e)){return t(this._binaryDecode(e))}if("string"==typeof e){const n=JSON.parse(e),[r,s,i,a,o]=n;return t({join_ref:r,ref:s,topic:i,event:a,payload:o})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),r=new TextDecoder;if(n===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,r)}_decodeUserBroadcast(e,t,n){const r=t.getUint8(1),s=t.getUint8(2),i=t.getUint8(3),a=t.getUint8(4);let o=this.HEADER_LENGTH+4;const l=n.decode(e.slice(o,o+r));o+=r;const c=n.decode(e.slice(o,o+s));o+=s;const u=n.decode(e.slice(o,o+i));o+=i;const d=e.slice(o,e.byteLength),h=a===this.JSON_ENCODING?JSON.parse(n.decode(d)):d,p={type:this.BROADCAST_EVENT,event:c,payload:h};return i>0&&(p.meta=JSON.parse(u)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:p}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===(t=null==e?void 0:e.constructor)||void 0===t?void 0:t.name)}_pick(e,t){return e&&"object"==typeof e?Object.fromEntries(Object.entries(e).filter(([e])=>t.includes(e))):{}}}class Vs{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}!function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"}(Gs||(Gs={}));const Ys=(e,t,n={})=>{var r;const s=null!==(r=n.skipTypes)&&void 0!==r?r:[];return t?Object.keys(t).reduce((n,r)=>(n[r]=Zs(r,e,t,s),n),{}):{}},Zs=(e,t,n,r)=>{const s=t.find(t=>t.name===e),i=null==s?void 0:s.type,a=n[e];return i&&!r.includes(i)?Xs(i,a):Qs(a)},Xs=(e,t)=>{if("_"===e.charAt(0)){const n=e.slice(1,e.length);return ri(t,n)}switch(e){case Gs.bool:return ei(t);case Gs.float4:case Gs.float8:case Gs.int2:case Gs.int4:case Gs.int8:case Gs.numeric:case Gs.oid:return ti(t);case Gs.json:case Gs.jsonb:return ni(t);case Gs.timestamp:return si(t);case Gs.abstime:case Gs.date:case Gs.daterange:case Gs.int4range:case Gs.int8range:case Gs.money:case Gs.reltime:case Gs.text:case Gs.time:case Gs.timestamptz:case Gs.timetz:case Gs.tsrange:case Gs.tstzrange:default:return Qs(t)}},Qs=e=>e,ei=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ti=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ni=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},ri=(e,t)=>{if("string"!=typeof e)return e;const n=e.length-1,r=e[n];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,n);try{r=JSON.parse("["+i+"]")}catch(s){r=i?i.split(","):[]}return r.map(e=>Xs(t,e))}return e},si=e=>"string"==typeof e?e.replace(" ","T"):e,ii=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class ai{constructor(e,t,n={},r=1e4){this.channel=e,this.event=t,this.payload=n,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t(null===(n=this.receivedResp)||void 0===n?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var oi,li,ci,ui;!function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"}(oi||(oi={}));class di{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=di.syncState(this.state,e,t,n),this.pendingDiffs.forEach(e=>{this.state=di.syncDiff(this.state,e,t,n)}),this.pendingDiffs=[],r()}),this.channel._on(n.diff,{},e=>{const{onJoin:t,onLeave:n,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=di.syncDiff(this.state,e,t,n),r())}),this.onJoin((e,t,n)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:n})}),this.onLeave((e,t,n)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:n})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,r){const s=this.cloneDeep(e),i=this.transformState(t),a={},o={};return this.map(s,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{const n=s[e];if(n){const r=t.map(e=>e.presence_ref),s=n.map(e=>e.presence_ref),i=t.filter(e=>s.indexOf(e.presence_ref)<0),l=n.filter(e=>r.indexOf(e.presence_ref)<0);i.length>0&&(a[e]=i),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(s,{joins:a,leaves:o},n,r)}static syncDiff(e,t,n,r){const{joins:s,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),r||(r=()=>{}),this.map(s,(t,r)=>{var s;const i=null!==(s=e[t])&&void 0!==s?s:[];if(e[t]=this.cloneDeep(r),i.length>0){const n=e[t].map(e=>e.presence_ref),r=i.filter(e=>n.indexOf(e.presence_ref)<0);e[t].unshift(...r)}n(t,i,r)}),this.map(i,(t,n)=>{let s=e[t];if(!s)return;const i=n.map(e=>e.presence_ref);s=s.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=s,r(t,s,n),0===s.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const r=e[n];return t[n]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}!function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"}(li||(li={})),function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"}(ci||(ci={})),function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"}(ui||(ui={}));class hi{constructor(e,t={config:{}},n){var r,s;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Ks.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ai(this,zs.join,this.params,this.timeout),this.rejoinTimer=new Vs(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ks.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ks.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Ks.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ks.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=Ks.errored,this.rejoinTimer.scheduleTimeout())}),this._on(zs.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new di(this),this.broadcastEndpointURL=ii(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(s=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===s?void 0:s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,r,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Ks.closed){const{config:{broadcast:i,presence:a,private:o}}=this.params,l=null!==(r=null===(n=this.bindings.postgres_changes)||void 0===n?void 0:n.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[ci.PRESENCE]&&this.bindings[ci.PRESENCE].length>0||!0===(null===(s=this.params.config.presence)||void 0===s?void 0:s.enabled),u={},d={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(ui.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(ui.CLOSED)),this.updateJoinPayload(Object.assign({config:d},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var n;if(this.socket._isManualToken()||this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,s=null!==(n=null==r?void 0:r.length)&&void 0!==n?n:0,i=[];for(let n=0;n<s;n++){const s=r[n],{filter:{event:a,schema:o,table:l,filter:c}}=s,u=t&&t[n];if(!(u&&u.event===a&&hi.isFilterValueEqual(u.schema,o)&&hi.isFilterValueEqual(u.table,l)&&hi.isFilterValueEqual(u.filter,c)))return this.unsubscribe(),this.state=Ks.errored,void(null==e||e(ui.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},s),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(ui.SUBSCRIBED))}null==e||e(ui.SUBSCRIBED)}).receive("error",t=>{this.state=Ks.errored,null==e||e(ui.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(ui.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Ks.joined&&e===ci.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var r;if(null==t)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const i={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!==(r=n.timeout)&&void 0!==r?r:this.timeout);if(202===a.status)return{success:!0};let o=a.statusText;try{const e=await a.json();o=e.error||e.message||o}catch(l){}return Promise.reject(new Error(o))}async send(e,t={}){var n,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(n=>{var r,s,i;const a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(s=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===s?void 0:s.broadcast)||void 0===i?void 0:i.ack)||n("ok"),a.receive("ok",()=>n("ok")),a.receive("error",()=>n("error")),a.receive("timeout",()=>n("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=e,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,l,null!==(n=t.timeout)&&void 0!==n?n:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(s){return"AbortError"===s.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Ks.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(zs.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(r=>{n=new ai(this,zs.leave,{},e),n.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{null==n||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Ks.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const r=new AbortController,s=setTimeout(()=>r.abort(),n),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(s),i}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new ai(this,e,t,n);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var r,s;const i=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=zs;if(n&&[a,o,l,c].indexOf(i)>=0&&n!==this._joinRef())return;let u=this._onMessage(i,t,n);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,n,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(n=e.filter)||void 0===n?void 0:n.event)||void 0===r?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(u,n)):null===(s=this.bindings[i])||void 0===s||s.filter(e=>{var n,r,s,a,o,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,a=null===(n=e.filter)||void 0===n?void 0:n.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null===(s=t.data)||void 0===s?void 0:s.type.toLocaleLowerCase()))}{const n=null===(o=null===(a=null==e?void 0:e.filter)||void 0===a?void 0:a.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===n||n===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:n,commit_timestamp:r,type:s,errors:i}=e,a={schema:t,table:n,commit_timestamp:r,eventType:s,new:{},old:{},errors:i};u=Object.assign(Object.assign({},a),this._getPayloadRecords(e))}e.callback(u,n)})}_isClosed(){return this.state===Ks.closed}_isJoined(){return this.state===Ks.joined}_isJoining(){return this.state===Ks.joining}_isLeaving(){return this.state===Ks.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const r=e.toLocaleLowerCase(),s={type:r,filter:t,callback:n};return this.bindings[r]?this.bindings[r].push(s):this.bindings[r]=[s],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===n&&hi.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(null!=e?e:void 0)===(null!=t?t:void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(zs.close,{},e)}_onError(e){this._on(zs.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ks.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Ys(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Ys(e.columns,e.old_record)),t}}const pi=()=>{},fi=25e3,gi=10,mi=100,yi=[1e3,2e3,5e3,1e4];class vi{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ws,this.transport=null,this.heartbeatIntervalMs=fi,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=pi,this.ref=0,this.reconnectTimer=null,this.vsn=Bs,this.logger=pi,this.conn=null,this.sendBuffer=[],this.serializer=new Js,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null===(n=null==t?void 0:t.params)||void 0===n?void 0:n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Fs.websocket}`,this.httpEndpoint=ii(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Ds.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return"ok"===t&&this._remove(e),0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case qs.connecting:return Hs.Connecting;case qs.open:return Hs.Open;case qs.closing:return Hs.Closing;default:return Hs.Closed}}isConnected(){return this.connectionState()===Hs.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const n=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===n);if(r)return r;{const n=new hi(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:n,payload:r,ref:s}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${n} (${s})`,r),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(bl){this.log("error","error in heartbeat callback",bl)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},mi)}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(bl){this.log("error","error in heartbeat callback",bl)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(bl){this.log("error","error in heartbeat callback",bl)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event&&e.ref&&e.ref===this.pendingHeartbeatRef){const t=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error",t)}catch(bl){this.log("error","error in heartbeat callback",bl)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:t,event:n,payload:r,ref:s}=e,i=s?`(${s})`:"",a=r.status||"";this.log("receive",`${a} ${t} ${n} ${i}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(n,r,s)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===qs.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===qs.open||this.conn.readyState===qs.connecting)try{this.conn.close()}catch(bl){this.log("error","Error closing connection",bl)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`);(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this._terminateWorker()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(bl){this.log("error","error in heartbeat callback",bl)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(zs.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const n=e.match(/\?/)?"&":"?";return`${e}${n}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(bl){this.log("error","Error fetching access token from callback",bl),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const n={access_token:t,version:"realtime-js/2.95.3"};t&&e.updateJoinPayload(n),e.joinedOnce&&e._isJoined()&&e._push(zs.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(bl){this.log("error",`error in ${e} callback`,bl)}})}catch(bl){this.log("error",`error triggering ${e} callbacks`,bl)}}_setupReconnectionTimer(){this.reconnectTimer=new Vs(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},gi)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,r,s,i,a,o,l,c,u,d,h;switch(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(n=null==e?void 0:e.timeout)&&void 0!==n?n:Ws,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:fi,this.worker=null!==(s=null==e?void 0:e.worker)&&void 0!==s&&s,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(a=null==e?void 0:e.heartbeatCallback)&&void 0!==a?a:pi,this.vsn=null!==(o=null==e?void 0:e.vsn)&&void 0!==o?o:Bs,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null==e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>yi[e-1]||1e4,this.vsn){case"1.0.0":this.encode=null!==(c=null==e?void 0:e.encode)&&void 0!==c?c:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(u=null==e?void 0:e.decode)&&void 0!==u?u:(e,t)=>t(JSON.parse(e));break;case Ms:this.encode=null!==(d=null==e?void 0:e.encode)&&void 0!==d?d:this.serializer.encode.bind(this.serializer),this.decode=null!==(h=null==e?void 0:e.decode)&&void 0!==h?h:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var wi=class extends Error{constructor(e,t){super(e),this.name="IcebergError",this.status=t.status,this.icebergType=t.icebergType,this.icebergCode=t.icebergCode,this.details=t.details,this.isCommitStateUnknown="CommitStateUnknownException"===t.icebergType||[500,502,504].includes(t.status)&&!0===t.icebergType?.includes("CommitState")}isNotFound(){return 404===this.status}isConflict(){return 409===this.status}isAuthenticationTimeout(){return 419===this.status}};function bi(e){const t=e.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:s,body:i,headers:a}){const o=function(e,t,n){const r=new URL(t,e);if(n)for(const[s,i]of Object.entries(n))void 0!==i&&r.searchParams.set(s,i);return r.toString()}(e.baseUrl,r,s),l=await async function(e){return e&&"none"!==e.type?"bearer"===e.type?{Authorization:`Bearer ${e.token}`}:"header"===e.type?{[e.name]:e.value}:"custom"===e.type?await e.getHeaders():{}:{}}(e.auth),c=await t(o,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...l,...a},body:i?JSON.stringify(i):void 0}),u=await c.text(),d=(c.headers.get("content-type")||"").includes("application/json"),h=d&&u?JSON.parse(u):u;if(!c.ok){const e=d?h:void 0,t=e?.error;throw new wi(t?.message??`Request failed with status ${c.status}`,{status:c.status,icebergType:t?.type,icebergCode:t?.code,details:e})}return{status:c.status,headers:c.headers,data:h}}}}function _i(e){return e.join("")}var xi=class{constructor(e,t=""){this.client=e,this.prefix=t}async listNamespaces(e){const t=e?{parent:_i(e.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:t})).data.namespaces.map(e=>({namespace:e}))}async createNamespace(e,t){const n={namespace:e.namespace,properties:t?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${_i(e.namespace)}`})}async loadNamespaceMetadata(e){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${_i(e.namespace)}`})).data.properties}}async namespaceExists(e){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${_i(e.namespace)}`}),!0}catch(t){if(t instanceof wi&&404===t.status)return!1;throw t}}async createNamespaceIfNotExists(e,t){try{return await this.createNamespace(e,t)}catch(n){if(n instanceof wi&&409===n.status)return;throw n}}};function Si(e){return e.join("")}var ki=class{constructor(e,t="",n){this.client=e,this.prefix=t,this.accessDelegation=n}async listTables(e){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Si(e.namespace)}/tables`})).data.identifiers}async createTable(e,t){const n={};this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Si(e.namespace)}/tables`,body:t,headers:n})).data.metadata}async updateTable(e,t){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Si(e.namespace)}/tables/${e.name}`,body:t});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(e,t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Si(e.namespace)}/tables/${e.name}`,query:{purgeRequested:String(t?.purge??!1)}})}async loadTable(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Si(e.namespace)}/tables/${e.name}`,headers:t})).data.metadata}async tableExists(e){const t={};this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Si(e.namespace)}/tables/${e.name}`,headers:t}),!0}catch(n){if(n instanceof wi&&404===n.status)return!1;throw n}}async createTableIfNotExists(e,t){try{return await this.createTable(e,t)}catch(n){if(n instanceof wi&&409===n.status)return await this.loadTable({namespace:e.namespace,name:t.name});throw n}}},ji=class{constructor(e){let t="v1";e.catalogName&&(t+=`/${e.catalogName}`);const n=e.baseUrl.endsWith("/")?e.baseUrl:`${e.baseUrl}/`;this.client=bi({baseUrl:n,auth:e.auth,fetchImpl:e.fetch}),this.accessDelegation=e.accessDelegation?.join(","),this.namespaceOps=new xi(this.client,t),this.tableOps=new ki(this.client,t,this.accessDelegation)}async listNamespaces(e){return this.namespaceOps.listNamespaces(e)}async createNamespace(e,t){return this.namespaceOps.createNamespace(e,t)}async dropNamespace(e){await this.namespaceOps.dropNamespace(e)}async loadNamespaceMetadata(e){return this.namespaceOps.loadNamespaceMetadata(e)}async listTables(e){return this.tableOps.listTables(e)}async createTable(e,t){return this.tableOps.createTable(e,t)}async updateTable(e,t){return this.tableOps.updateTable(e,t)}async dropTable(e,t){await this.tableOps.dropTable(e,t)}async loadTable(e){return this.tableOps.loadTable(e)}async namespaceExists(e){return this.namespaceOps.namespaceExists(e)}async tableExists(e){return this.tableOps.tableExists(e)}async createNamespaceIfNotExists(e,t){return this.namespaceOps.createNamespaceIfNotExists(e,t)}async createTableIfNotExists(e,t){return this.tableOps.createTableIfNotExists(e,t)}},Ei=class extends Error{constructor(e,t="storage",n,r){super(e),this.__isStorageError=!0,this.namespace=t,this.name="vectors"===t?"StorageVectorsError":"StorageError",this.status=n,this.statusCode=r}};function Ti(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}var Ri=class extends Ei{constructor(e,t,n,r="storage"){super(e,r,t,n),this.name="vectors"===r?"StorageVectorsApiError":"StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Ci=class extends Ei{constructor(e,t,n="storage"){super(e,n),this.name="vectors"===n?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=t}};const Oi=e=>{if(Array.isArray(e))return e.map(e=>Oi(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,n])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Oi(n)}),t};function Ii(e){return(Ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ni(e){var t=function(e,t){if("object"!=Ii(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Ii(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Ii(t)?t:t+""}function Ai(e,t,n){return(t=Ni(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pi(Object(n),!0).forEach(function(t){Ai(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pi(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const $i=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null===(t=e.error)||void 0===t?void 0:t.message)||JSON.stringify(e)},Li=(e,t,n,r)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&"HEAD"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(s.headers=Ui({"Content-Type":"application/json"},null==t?void 0:t.headers),s.body=JSON.stringify(r)):s.body=r,(null==t?void 0:t.duplex)&&(s.duplex=t.duplex),Ui(Ui({},s),n)):Ui(Ui({},s),n)};async function Di(e,t,n,r,s,i,a){return new Promise((o,l)=>{e(n,Li(t,r,s,i)).then(e=>{if(!e.ok)throw e;if(null==r?void 0:r.noResolveJson)return e;if("vectors"===a){const t=e.headers.get("content-type");if("0"===e.headers.get("content-length")||204===e.status)return{};if(!t||!t.includes("application/json"))return{}}return e.json()}).then(e=>o(e)).catch(e=>(async(e,t,n,r)=>{if(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status&&!(null==n?void 0:n.noResolveJson)){const n=e,s=n.status||500;if("function"==typeof n.json)n.json().then(e=>{const n=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||s+"";t(new Ri($i(e),s,n,r))}).catch(()=>{if("vectors"===r){const e=s+"";t(new Ri(n.statusText||`HTTP ${s} error`,s,e,r))}else{const e=s+"";t(new Ri(n.statusText||`HTTP ${s} error`,s,e,r))}});else{const e=s+"";t(new Ri(n.statusText||`HTTP ${s} error`,s,e,r))}}else t(new Ci($i(e),e,r))})(e,l,r,a))})}function Mi(e="storage"){return{get:async(t,n,r,s)=>Di(t,"GET",n,r,s,void 0,e),post:async(t,n,r,s,i)=>Di(t,"POST",n,s,i,r,e),put:async(t,n,r,s,i)=>Di(t,"PUT",n,s,i,r,e),head:async(t,n,r,s)=>Di(t,"HEAD",n,Ui(Ui({},r),{},{noResolveJson:!0}),s,void 0,e),remove:async(t,n,r,s,i)=>Di(t,"DELETE",n,s,i,r,e)}}const Bi=Mi("storage"),{get:Wi,post:qi,put:Ki,head:zi,remove:Fi}=Bi,Hi=Mi("vectors");var Gi=class{constructor(e,t={},n,r="storage"){var s;this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.fetch=(s=n)?(...e)=>s(...e):(...e)=>fetch(...e),this.namespace=r}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(e){try{return{data:await e(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Ti(t))return{data:null,error:t};throw t}}},Ji=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}async execute(){try{return{data:(await this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ti(e))return{data:null,error:e};throw e}}};let Vi;Vi=Symbol.toStringTag;var Yi=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Vi]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ji(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){try{return{data:await(await this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ti(e))return{data:null,error:e};throw e}}};const Zi={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Qi=class extends Gi{constructor(e,t={},n,r){super(e,t,r,"storage"),this.bucketId=n}async uploadOrUpdate(e,t,n,r){var s=this;return s.handleOperation(async()=>{let i;const a=Ui(Ui({},Xi),r);let o=Ui(Ui({},s.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const l=a.metadata;"undefined"!=typeof Blob&&n instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=n,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=s.toBase64(s.encodeMetadata(l))),("undefined"!=typeof ReadableStream&&i instanceof ReadableStream||i&&"object"==typeof i&&"pipe"in i&&"function"==typeof i.pipe)&&!a.duplex&&(a.duplex="half")),(null==r?void 0:r.headers)&&(o=Ui(Ui({},o),r.headers));const c=s._removeEmptyFolders(t),u=s._getFinalPath(c),d=await("PUT"==e?Ki:qi)(s.fetch,`${s.url}/object/${u}`,i,Ui({headers:o},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{path:c,id:d.Id,fullPath:d.Key}})}async upload(e,t,n){return this.uploadOrUpdate("POST",e,t,n)}async uploadToSignedUrl(e,t,n,r){var s=this;const i=s._removeEmptyFolders(e),a=s._getFinalPath(i),o=new URL(s.url+`/object/upload/sign/${a}`);return o.searchParams.set("token",t),s.handleOperation(async()=>{let e;const t=Ui({upsert:Xi.upsert},r),a=Ui(Ui({},s.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&n instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",n)):"undefined"!=typeof FormData&&n instanceof FormData?(e=n,e.append("cacheControl",t.cacheControl)):(e=n,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType),{path:i,fullPath:(await Ki(s.fetch,o.toString(),e,{headers:a})).Key}})}async createSignedUploadUrl(e,t){var n=this;return n.handleOperation(async()=>{let r=n._getFinalPath(e);const s=Ui({},n.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const i=await qi(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(n.url+i.url),o=a.searchParams.get("token");if(!o)throw new Ei("No token returned by API");return{signedUrl:a.toString(),path:e,token:o}})}async update(e,t,n){return this.uploadOrUpdate("PUT",e,t,n)}async move(e,t,n){var r=this;return r.handleOperation(async()=>await qi(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==n?void 0:n.destinationBucket},{headers:r.headers}))}async copy(e,t,n){var r=this;return r.handleOperation(async()=>({path:(await qi(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==n?void 0:n.destinationBucket},{headers:r.headers})).Key}))}async createSignedUrl(e,t,n){var r=this;return r.handleOperation(async()=>{let s=r._getFinalPath(e),i=await qi(r.fetch,`${r.url}/object/sign/${s}`,Ui({expiresIn:t},(null==n?void 0:n.transform)?{transform:n.transform}:{}),{headers:r.headers});const a=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return{signedUrl:encodeURI(`${r.url}${i.signedURL}${a}`)}})}async createSignedUrls(e,t,n){var r=this;return r.handleOperation(async()=>{const s=await qi(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:t,paths:e},{headers:r.headers}),i=(null==n?void 0:n.download)?`&download=${!0===n.download?"":n.download}`:"";return s.map(e=>Ui(Ui({},e),{},{signedUrl:e.signedURL?encodeURI(`${r.url}${e.signedURL}${i}`):null}))})}download(e,t,n){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=s?`?${s}`:"",a=this._getFinalPath(e);return new Yi(()=>Wi(this.fetch,`${this.url}/${r}/${a}${i}`,{headers:this.headers,noResolveJson:!0},n),this.shouldThrowOnError)}async info(e){var t=this;const n=t._getFinalPath(e);return t.handleOperation(async()=>Oi(await Wi(t.fetch,`${t.url}/object/info/${n}`,{headers:t.headers})))}async exists(e){var t=this;const n=t._getFinalPath(e);try{return await zi(t.fetch,`${t.url}/object/${n}`,{headers:t.headers}),{data:!0,error:null}}catch(r){if(t.shouldThrowOnError)throw r;if(Ti(r)&&r instanceof Ci){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}}getPublicUrl(e,t){const n=this._getFinalPath(e),r=[],s=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==s&&r.push(s);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&r.push(a);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${o}`)}}}async remove(e){var t=this;return t.handleOperation(async()=>await Fi(t.fetch,`${t.url}/object/${t.bucketId}`,{prefixes:e},{headers:t.headers}))}async list(e,t,n){var r=this;return r.handleOperation(async()=>{const s=Ui(Ui(Ui({},Zi),t),{},{prefix:e||""});return await qi(r.fetch,`${r.url}/object/list/${r.bucketId}`,s,{headers:r.headers},n)})}async listV2(e,t){var n=this;return n.handleOperation(async()=>{const r=Ui({},e);return await qi(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},t)})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}};const ea={"X-Client-Info":"storage-js/2.95.3"};var ta=class extends Gi{constructor(e,t={},n,r){const s=new URL(e);(null==r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."));super(s.href.replace(/\/$/,""),Ui(Ui({},ea),t),n,"storage")}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const n=t.listBucketOptionsToQueryString(e);return await Wi(t.fetch,`${t.url}/bucket${n}`,{headers:t.headers})})}async getBucket(e){var t=this;return t.handleOperation(async()=>await Wi(t.fetch,`${t.url}/bucket/${e}`,{headers:t.headers}))}async createBucket(e,t={public:!1}){var n=this;return n.handleOperation(async()=>await qi(n.fetch,`${n.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}))}async updateBucket(e,t){var n=this;return n.handleOperation(async()=>await Ki(n.fetch,`${n.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:n.headers}))}async emptyBucket(e){var t=this;return t.handleOperation(async()=>await qi(t.fetch,`${t.url}/bucket/${e}/empty`,{},{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Fi(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}listBucketOptionsToQueryString(e){const t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}},na=class extends Gi{constructor(e,t={},n){super(e.replace(/\/$/,""),Ui(Ui({},ea),t),n,"storage")}async createBucket(e){var t=this;return t.handleOperation(async()=>await qi(t.fetch,`${t.url}/bucket`,{name:e},{headers:t.headers}))}async listBuckets(e){var t=this;return t.handleOperation(async()=>{const n=new URLSearchParams;void 0!==(null==e?void 0:e.limit)&&n.set("limit",e.limit.toString()),void 0!==(null==e?void 0:e.offset)&&n.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&n.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&n.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&n.set("search",e.search);const r=n.toString(),s=r?`${t.url}/bucket?${r}`:`${t.url}/bucket`;return await Wi(t.fetch,s,{headers:t.headers})})}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Fi(t.fetch,`${t.url}/bucket/${e}`,{},{headers:t.headers}))}from(e){var t=this;if(!(e=>!(!e||"string"!=typeof e)&&!(0===e.length||e.length>100)&&e.trim()===e&&!e.includes("/")&&!e.includes("\\")&&/^[\w!.\*'() &$@=;:+,?-]+$/.test(e))(e))throw new Ei("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new ji({baseUrl:this.url,catalogName:e,auth:{type:"custom",getHeaders:async()=>t.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(e,t){const n=e[t];return"function"!=typeof n?n:async(...t)=>{try{return{data:await n.apply(e,t),error:null}}catch(s){if(r)throw s;return{data:null,error:s}}}}})}},ra=class extends Gi{constructor(e,t={},n){super(e.replace(/\/$/,""),Ui(Ui({},ea),{},{"Content-Type":"application/json"},t),n,"vectors")}async createIndex(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/CreateIndex`,e,{headers:t.headers})||{})}async getIndex(e,t){var n=this;return n.handleOperation(async()=>await Hi.post(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers}))}async listIndexes(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/ListIndexes`,e,{headers:t.headers}))}async deleteIndex(e,t){var n=this;return n.handleOperation(async()=>await Hi.post(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:n.headers})||{})}},sa=class extends Gi{constructor(e,t={},n){super(e.replace(/\/$/,""),Ui(Ui({},ea),{},{"Content-Type":"application/json"},t),n,"vectors")}async putVectors(e){var t=this;if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/PutVectors`,e,{headers:t.headers})||{})}async getVectors(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/GetVectors`,e,{headers:t.headers}))}async listVectors(e){var t=this;if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error("segmentIndex must be between 0 and "+(e.segmentCount-1))}return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/ListVectors`,e,{headers:t.headers}))}async queryVectors(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/QueryVectors`,e,{headers:t.headers}))}async deleteVectors(e){var t=this;if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/DeleteVectors`,e,{headers:t.headers})||{})}},ia=class extends Gi{constructor(e,t={},n){super(e.replace(/\/$/,""),Ui(Ui({},ea),{},{"Content-Type":"application/json"},t),n,"vectors")}async createBucket(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}async getBucket(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/GetVectorBucket`,{vectorBucketName:e},{headers:t.headers}))}async listBuckets(e={}){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/ListVectorBuckets`,e,{headers:t.headers}))}async deleteBucket(e){var t=this;return t.handleOperation(async()=>await Hi.post(t.fetch,`${t.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:t.headers})||{})}},aa=class extends ia{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new oa(this.url,this.headers,e,this.fetch)}async createBucket(e){return(()=>super.createBucket)().call(this,e)}async getBucket(e){return(()=>super.getBucket)().call(this,e)}async listBuckets(e={}){return(()=>super.listBuckets)().call(this,e)}async deleteBucket(e){return(()=>super.deleteBucket)().call(this,e)}},oa=class extends ra{constructor(e,t,n,r){super(e,t,r),this.vectorBucketName=n}async createIndex(e){return(()=>super.createIndex)().call(this,Ui(Ui({},e),{},{vectorBucketName:this.vectorBucketName}))}async listIndexes(e={}){return(()=>super.listIndexes)().call(this,Ui(Ui({},e),{},{vectorBucketName:this.vectorBucketName}))}async getIndex(e){return(()=>super.getIndex)().call(this,this.vectorBucketName,e)}async deleteIndex(e){return(()=>super.deleteIndex)().call(this,this.vectorBucketName,e)}index(e){return new la(this.url,this.headers,this.vectorBucketName,e,this.fetch)}},la=class extends sa{constructor(e,t,n,r,s){super(e,t,s),this.vectorBucketName=n,this.indexName=r}async putVectors(e){var t=this;return(()=>super.putVectors)().call(t,Ui(Ui({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(e){var t=this;return(()=>super.getVectors)().call(t,Ui(Ui({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(e={}){var t=this;return(()=>super.listVectors)().call(t,Ui(Ui({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(e){var t=this;return(()=>super.queryVectors)().call(t,Ui(Ui({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(e){var t=this;return(()=>super.deleteVectors)().call(t,Ui(Ui({},e),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},ca=class extends ta{constructor(e,t={},n,r){super(e,t,n,r)}from(e){return new Qi(this.url,this.headers,e,this.fetch)}get vectors(){return new aa(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new na(this.url+"/iceberg",this.headers,this.fetch)}};const ua="2.95.3",da=3e4,ha=9e4,pa={"X-Client-Info":`gotrue-js/${ua}`},fa="X-Supabase-Api-Version",ga={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},ma=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class ya extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function va(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class wa extends ya{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}class ba extends ya{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class _a extends ya{constructor(e,t,n,r){super(e,n,r),this.name=t,this.status=n}}class xa extends _a{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Sa(e){return va(e)&&"AuthSessionMissingError"===e.name}class ka extends _a{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ja extends _a{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ea extends _a{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ta extends _a{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ra extends _a{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ca extends _a{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Oa(e){return va(e)&&"AuthRetryableFetchError"===e.name}class Ia extends _a{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Na extends _a{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Aa="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Pa=" \t\n\r=".split(""),Ua=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Pa.length;t+=1)e[Pa[t].charCodeAt(0)]=-2;for(let t=0;t<Aa.length;t+=1)e[Aa[t].charCodeAt(0)]=t;return e})();function $a(e,t,n){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(Aa[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;n(Aa[e]),t.queuedBits-=6}}function La(e,t,n){const r=Ua[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Da(e){const t=[],n=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=e=>{!function(e,t,n){if(0===t.utf8seq){if(e<=127)return void n(e);for(let n=1;n<6;n+=1)if(!(e>>7-n&1)){t.utf8seq=n;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&n(t.codepoint)}}(e,r,n)};for(let a=0;a<e.length;a+=1)La(e.charCodeAt(a),s,i);return t.join("")}function Ma(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Ba(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let s=0;s<e.length;s+=1)La(e.charCodeAt(s),n,r);return new Uint8Array(t)}function Wa(e){const t=[];return function(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(n+1)-56320&65535|t),n+=1}Ma(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function qa(e){const t=[],n={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>$a(e,n,r)),$a(null,n,r),t.join("")}const Ka=()=>"undefined"!=typeof window&&"undefined"!=typeof document,za={tested:!1,writable:!1},Fa=()=>{if(!Ka())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(bl){return!1}if(za.tested)return za.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),za.tested=!0,za.writable=!0}catch(bl){za.tested=!0,za.writable=!1}return za.writable};const Ha=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),Ga=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},Ja=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch(r){return n}},Va=async(e,t)=>{await e.removeItem(t)};class Ya{constructor(){this.promise=new Ya.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Za(e){const t=e.split(".");if(3!==t.length)throw new Na("Invalid JWT structure");for(let n=0;n<t.length;n++)if(!ma.test(t[n]))throw new Na("JWT not in base64url format");return{header:JSON.parse(Da(t[0])),payload:JSON.parse(Da(t[1])),signature:Ba(t[2]),raw:{header:t[0],payload:t[1]}}}function Xa(e){return("0"+e.toString(16)).substr(-2)}async function Qa(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(n);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function eo(e,t,n=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let r=0;r<56;r++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(e),Array.from(e,Xa).join("")}();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await Ga(e,`${t}-code-verifier`,s);const i=await Qa(r);return[i,r===i?"plain":"s256"]}Ya.promiseConstructor=Promise;const to=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const no=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ro(e){if(!no.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function so(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function io(e){return JSON.parse(JSON.stringify(e))}const ao=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),oo=[502,503,504];async function lo(e){var t,n;if(!("object"==typeof(n=e)&&null!==n&&"status"in n&&"ok"in n&&"json"in n&&"function"==typeof n.json))throw new Ca(ao(e),0);if(oo.includes(e.status))throw new Ca(ao(e),e.status);let r,s;try{r=await e.json()}catch(bl){throw new ba(ao(bl),bl)}const i=function(e){const t=e.headers.get(fa);if(!t)return null;if(!t.match(to))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(bl){return null}}(e);if(i&&i.getTime()>=ga.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?s=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new Ia(ao(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===s)throw new xa}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Ia(ao(r),e.status,r.weak_password.reasons);throw new wa(ao(r),e.status||500,s)}async function co(e,t,n,r){var s;const i=Object.assign({},null==r?void 0:r.headers);i[fa]||(i[fa]=ga.name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);const a=null!==(s=null==r?void 0:r.query)&&void 0!==s?s:{};(null==r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await async function(e,t,n,r,s,i){const a=((e,t,n,r)=>{const s={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))})(t,r,s,i);let o;try{o=await e(n,Object.assign({},a))}catch(bl){throw console.error(bl),new Ca(ao(bl),0)}o.ok||await lo(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(bl){await lo(bl)}}(e,t,n+o,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function uo(e){var t;let n=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:n,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ho(e){const t=uo(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function po(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function fo(e){return{data:e,error:null}}function go(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=e,a=ys(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},user:Object.assign({},a)},error:null}}function mo(e){return e}const yo=["global","local","others"];class vo{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=Ha(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=yo[0]){if(yo.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${yo.join(", ")}`);try{return await co(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(va(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await co(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:po})}catch(n){if(va(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=ys(e,["options"]),r=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(r.new_email=null==n?void 0:n.newEmail,delete r.newEmail),await co(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:go,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(va(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await co(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:po})}catch(t){if(va(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,r,s,i,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await co(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(s=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==s?s:""},xform:mo});if(c.error)throw c.error;const u=await c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l[`${n}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(va(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){ro(e);try{return await co(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:po})}catch(t){if(va(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ro(e);try{return await co(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:po})}catch(n){if(va(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){ro(e);try{return await co(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:po})}catch(n){if(va(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){ro(e.userId);try{const{data:t,error:n}=await co(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:n}}catch(t){if(va(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ro(e.userId),ro(e.id);try{return{data:await co(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(va(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,r,s,i,a,o;try{const l={nextPage:null,lastPage:0,total:0},c=await co(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(s=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==s?s:""},xform:mo});if(c.error)throw c.error;const u=await c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(o=null===(a=c.headers.get("link"))||void 0===a?void 0:a.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),n=JSON.parse(e.split(";")[1].split("=")[1]);l[`${n}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(va(l))return{data:{clients:[]},error:l};throw l}}async _createOAuthClient(e){try{return await co(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(va(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await co(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(va(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await co(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(n){if(va(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await co(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(va(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await co(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(va(t))return{data:null,error:t};throw t}}}function wo(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const bo=!!(globalThis&&Fa()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class _o extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class xo extends _o{}async function So(e,t,n){bo&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),bo&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw bo&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new xo(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(bo)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(bl){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",bl)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}bo&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await n()}finally{bo&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}function ko(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function jo(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class Eo extends Error{constructor({message:e,code:t,cause:n,name:r}){var s;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=null!==(s=null!=r?r:n instanceof Error?n.name:void 0)&&void 0!==s?s:"Unknown Error",this.code=t}}class To extends Eo{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Ro({error:e,options:t}){var n,r,s;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Eo({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(n=i.authenticatorSelection)||void 0===n?void 0:n.requireResidentKey))return new Eo({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(r=i.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new Eo({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(s=i.authenticatorSelection)||void 0===s?void 0:s.userVerification))return new Eo({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new Eo({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new Eo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name){return 0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new Eo({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new Eo({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e})}if("SecurityError"===e.name){const t=window.location.hostname;if(!Uo(t))return new Eo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new Eo({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Eo({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new Eo({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Eo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Co({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new Eo({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new Eo({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Uo(t))return new Eo({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(n.rpId!==t)return new Eo({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new Eo({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new Eo({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}const Oo=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Io(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,s=ys(e,["challenge","user","excludeCredentials"]),i=Ba(t).buffer,a=Object.assign(Object.assign({},n),{id:Ba(n.id).buffer}),o=Object.assign(Object.assign({},s),{challenge:i,user:a});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:Ba(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function No(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=ys(e,["challenge","allowCredentials"]),s=Ba(t).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let e=0;e<n.length;e++){const t=n[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:Ba(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}function Ao(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:qa(new Uint8Array(e.response.attestationObject)),clientDataJSON:qa(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function Po(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const n=e,r=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:qa(new Uint8Array(s.authenticatorData)),clientDataJSON:qa(new Uint8Array(s.clientDataJSON)),signature:qa(new Uint8Array(s.signature)),userHandle:s.userHandle?qa(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=n.authenticatorAttachment)&&void 0!==t?t:void 0}}function Uo(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function $o(){var e,t;return!!(Ka()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const Lo={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Do={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Mo(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),n=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),r={};for(const s of e)if(s)for(const e in s){const i=s[e];if(void 0!==i)if(Array.isArray(i))r[e]=i;else if(n(i))r[e]=i;else if(t(i)){const n=r[e];t(n)?r[e]=Mo(n,i):r[e]=Mo(i)}else r[e]=i}return r}class Bo{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:r},s){var i;try{const{data:a,error:o}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!a)return{data:null,error:o};const l=null!=r?r:Oo.createNewAbortSignal();if("create"===a.webauthn.type){const{user:e}=a.webauthn.credential_options.publicKey;if(!e.name){const t=n;if(t)e.name=`${e.id}:${t}`;else{const t=(await this.client.getUser()).data.user,n=(null===(i=null==t?void 0:t.user_metadata)||void 0===i?void 0:i.name)||(null==t?void 0:t.email)||(null==t?void 0:t.id)||"User";e.name=`${e.id}:${n}`}}e.displayName||(e.displayName=e.name)}switch(a.webauthn.type){case"create":{const t=function(e,t){return Mo(Lo,e,t||{})}(a.webauthn.credential_options.publicKey,null==s?void 0:s.create),{data:n,error:r}=await async function(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new To("Browser returned unexpected credential type",t)}:{data:null,error:new To("Empty credential response",t)}}catch(t){return{data:null,error:Ro({error:t,options:e})}}}({publicKey:t,signal:l});return n?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:n}},error:null}:{data:null,error:r}}case"request":{const t=function(e,t){return Mo(Do,e,t||{})}(a.webauthn.credential_options.publicKey,null==s?void 0:s.request),{data:n,error:r}=await async function(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new To("Browser returned unexpected credential type",t)}:{data:null,error:new To("Empty credential response",t)}}catch(t){return{data:null,error:Co({error:t,options:e})}}}(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:t,signal:l}));return n?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:n}},error:null}:{data:null,error:r}}}}catch(a){return va(a)?{data:null,error:a}:{data:null,error:new ba("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:n=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}={}},s){if(!t)return{data:null,error:new ya("rpId is required for WebAuthn authentication")};try{if(!$o())return{data:null,error:new ba("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:r},{request:s});if(!i)return{data:null,error:a};const{webauthn:o}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:n,credential_response:o.credential_response}})}catch(i){return va(i)?{data:null,error:i}:{data:null,error:new ba("Unexpected error in authenticate",i)}}}async _register({friendlyName:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:n=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}={}},s){if(!t)return{data:null,error:new ya("rpId is required for WebAuthn registration")};try{if(!$o())return{data:null,error:new ba("Browser does not support WebAuthn",null)};const{data:i,error:a}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var n;return null===(n=t.data)||void 0===n?void 0:n.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:a};const{data:o,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:r},{create:s});return o?this._verify({factorId:i.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:n,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(i){return va(i)?{data:null,error:i}:{data:null,error:new ba("Unexpected error in register",i)}}}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(bl){"undefined"!=typeof self&&(self.globalThis=self)}}();const Wo={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:pa,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function qo(e,t,n){return await n()}const Ko={};class zo{get jwks(){var e,t;return null!==(t=null===(e=Ko[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Ko[this.storageKey]=Object.assign(Object.assign({},Ko[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Ko[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ko[this.storageKey]=Object.assign(Object.assign({},Ko[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},Wo),e);if(this.storageKey=s.storageKey,this.instanceID=null!==(t=zo.nextInstanceID[this.storageKey])&&void 0!==t?t:0,zo.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.instanceID>0&&Ka()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new vo({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Ha(s.fetch),this.lock=s.lock||qo,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,this.lockAcquireTimeout=s.lockAcquireTimeout,s.lock?this.lock=s.lock:this.persistSession&&Ka()&&(null===(n=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===n?void 0:n.locks)?this.lock=So:this.lock=qo,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Bo(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:Fa()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=wo(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=wo(this.memoryStorage)),Ka()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(bl){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",bl)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e);try{await this._notifyAllSubscribers(e.data.event,e.data.session,!1)}catch(t){this._debug("#broadcastChannel","error",t)}})}this.initialize().catch(e=>{this._debug("#initialize()","error",e)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${ua}) ${(new Date).toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},n="none";if(Ka()&&(t=function(e){const t={},n=new URL(e);if(n.hash&&"#"===n.hash[0])try{new URLSearchParams(n.hash.substring(1)).forEach((e,n)=>{t[n]=e})}catch(bl){}return n.searchParams.forEach((e,n)=>{t[n]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),Ka()&&this.detectSessionInUrl&&"none"!==n){const{data:r,error:s}=await this._getSessionFromURL(t,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),function(e){return va(e)&&"AuthImplicitGrantRedirectError"===e.name}(s)){const t=null===(e=s.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:s}}return{error:s}}const{session:i,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return va(t)?this._returnResult({error:t}):this._returnResult({error:new ba("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,r;try{const s=await co(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(n=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:uo}),{data:i,error:a}=s;if(a||!i)return this._returnResult({data:{user:null,session:null},error:a});const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(s){if(va(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var t,n,r;try{let s;if("email"in e){const{email:n,password:r,options:i}=e;let a=null,o=null;"pkce"===this.flowType&&([a,o]=await eo(this.storage,this.storageKey)),s=await co(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:n,password:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:a,code_challenge_method:o},xform:uo})}else{if(!("phone"in e))throw new ja("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:a}=e;s=await co(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(n=null==a?void 0:a.data)&&void 0!==n?n:{},channel:null!==(r=null==a?void 0:a.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:uo})}}const{data:i,error:a}=s;if(a||!i)return await Va(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(s){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:r,options:s}=e;t=await co(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:ho})}else{if(!("phone"in e))throw new ja("You must provide either an email or phone number and a password");{const{phone:n,password:r,options:s}=e;t=await co(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},xform:ho})}}const{data:n,error:r}=t;if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!n||!n.session||!n.user){const e=new ka;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:r})}catch(t){if(va(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,r,s;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(n=e.options)||void 0===n?void 0:n.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(s=e.options)||void 0===s?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,r,s,i,a,o,l,c,u,d;let h,p;if("message"in e)h=e.message,p=e.signature;else{const{chain:u,wallet:d,statement:f,options:g}=e;let m;if(Ka())if("object"==typeof d)m=d;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");m=e.ethereum}else{if("object"!=typeof d||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");m=d}const y=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),v=await m.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!v||0===v.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const w=ko(v[0]);let b=null===(n=null==g?void 0:g.signInWithEthereum)||void 0===n?void 0:n.chainId;if(!b){const e=await m.request({method:"eth_chainId"});b=parseInt(e,16)}h=function(e){var t;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:u,uri:d,version:h}=e;if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const p=`${u?`${u}://${r}`:r} wants you to sign in with your Ethereum account:\n${ko(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let f=`URI: ${d}\nVersion: ${h}\nChain ID: ${n}${a?`\nNonce: ${a}`:""}\nIssued At: ${i.toISOString()}`;if(s&&(f+=`\nExpiration Time: ${s.toISOString()}`),o&&(f+=`\nNot Before: ${o.toISOString()}`),l&&(f+=`\nRequest ID: ${l}`),c){let e="\nResources:";for(const t of c){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}f+=e}return`${p}\n${f}`}({domain:y.host,address:w,statement:f,uri:y.href,version:"1",chainId:b,nonce:null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(i=null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.issuedAt)&&void 0!==i?i:new Date,expirationTime:null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.expirationTime,notBefore:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==g?void 0:g.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.resources}),p=await m.request({method:"personal_sign",params:[jo(h),w]})}try{const{data:t,error:n}=await co(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:p},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:uo});if(n)throw n;if(!t||!t.session||!t.user){const e=new ka;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(f){if(va(f))return this._returnResult({data:{user:null,session:null},error:f});throw f}}async signInWithSolana(e){var t,n,r,s,i,a,o,l,c,u,d,h;let p,f;if("message"in e)p=e.message,f=e.signature;else{const{chain:d,wallet:h,statement:g,options:m}=e;let y;if(Ka())if("object"==typeof h)y=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");y=e.solana}else{if("object"!=typeof h||!(null==m?void 0:m.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=h}const v=new URL(null!==(t=null==m?void 0:m.url)&&void 0!==t?t:window.location.href);if("signIn"in y&&y.signIn){const e=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==m?void 0:m.signInWithSolana),{version:"1",domain:v.host,uri:v.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");p="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),f=t.signature}else{if(!("signMessage"in y&&"function"==typeof y.signMessage&&"publicKey"in y&&"object"==typeof y&&y.publicKey&&"toBase58"in y.publicKey&&"function"==typeof y.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${v.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${v.href}`,`Issued At: ${null!==(r=null===(n=null==m?void 0:m.signInWithSolana)||void 0===n?void 0:n.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(s=null==m?void 0:m.signInWithSolana)||void 0===s?void 0:s.notBefore)?[`Not Before: ${m.signInWithSolana.notBefore}`]:[],...(null===(i=null==m?void 0:m.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${m.signInWithSolana.expirationTime}`]:[],...(null===(a=null==m?void 0:m.signInWithSolana)||void 0===a?void 0:a.chainId)?[`Chain ID: ${m.signInWithSolana.chainId}`]:[],...(null===(o=null==m?void 0:m.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${m.signInWithSolana.nonce}`]:[],...(null===(l=null==m?void 0:m.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${m.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==m?void 0:m.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...m.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await y.signMessage((new TextEncoder).encode(p),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=e}}try{const{data:t,error:n}=await co(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:qa(f)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:uo});if(n)throw n;if(!t||!t.session||!t.user){const e=new ka;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:n})}catch(g){if(va(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async _exchangeCodeForSession(e){const t=await Ja(this.storage,`${this.storageKey}-code-verifier`),[n,r]=(null!=t?t:"").split("/");try{if(!n&&"pkce"===this.flowType)throw new Ra;const{data:t,error:s}=await co(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:uo});if(await Va(this.storage,`${this.storageKey}-code-verifier`),s)throw s;if(!t||!t.session||!t.user){const e=new ka;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:s})}catch(s){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:t,provider:n,token:r,access_token:s,nonce:i}=e,a=await co(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:r,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:uo}),{data:o,error:l}=a;if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!o||!o.session||!o.user){const e=new ka;return this._returnResult({data:{user:null,session:null},error:e})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:o,error:l})}catch(t){if(va(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,r,s,i;try{if("email"in e){const{email:r,options:s}=e;let i=null,a=null;"pkce"===this.flowType&&([i,a]=await eo(this.storage,this.storageKey));const{error:o}=await co(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==s?void 0:s.data)&&void 0!==t?t:{},create_user:null===(n=null==s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},code_challenge:i,code_challenge_method:a},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){const{phone:t,options:n}=e,{data:a,error:o}=await co(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==n?void 0:n.data)&&void 0!==r?r:{},create_user:null===(s=null==n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},channel:null!==(i=null==n?void 0:n.channel)&&void 0!==i?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o})}throw new ja("You must provide either an email or phone number.")}catch(a){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var t,n;try{let r,s;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,s=null===(n=e.options)||void 0===n?void 0:n.captchaToken);const{data:i,error:a}=await co(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:r,xform:uo});if(a)throw a;if(!i){throw new Error("An error occurred on token verification.")}const o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(r){if(va(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithSSO(e){var t,n,r,s,i;try{let a=null,o=null;"pkce"===this.flowType&&([a,o]=await eo(this.storage,this.storageKey));const l=await co(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(n=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==n?n:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:o}),headers:this.headers,xform:fo});return(null===(s=l.data)||void 0===s?void 0:s.url)&&Ka()&&!(null===(i=e.options)||void 0===i?void 0:i.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(a){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new xa;const{error:r}=await co(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:r})})}catch(e){if(va(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:r,options:s}=e,{error:i}=await co(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}},redirectTo:null==s?void 0:s.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){const{phone:n,type:r,options:s}=e,{data:i,error:a}=await co(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:r,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:a})}throw new ja("You must provide either an email or phone number and a type")}catch(t){if(va(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch(bl){}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(bl){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Ja(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=!!e.expires_at&&1e3*e.expires_at-Date.now()<ha;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const t=await Ja(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=so()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const t={value:this.suppressGetSessionWarning};e.user=function(e,t){return new Proxy(e,{get:(e,n,r)=>{if("__isInsecureUserWarningProxy"===n)return!0;if("symbol"==typeof n){const t=n.toString();if("Symbol(Symbol.toPrimitive)"===t||"Symbol(Symbol.toStringTag)"===t||"Symbol(util.inspect.custom)"===t||"Symbol(nodejs.util.inspect.custom)"===t)return Reflect.get(e,n,r)}return t.value||"string"!=typeof n||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(e,n,r)}})}(e.user,t),t.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:r},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await co(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:po}):await this._useSession(async e=>{var t,n,r;const{data:s,error:i}=e;if(i)throw i;return(null===(t=s.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await co(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(n=s.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0,xform:po}):{data:{user:null},error:new xa}})}catch(t){if(va(t))return Sa(t)&&(await this._removeSession(),await Va(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:r,error:s}=n;if(s)throw s;if(!r.session)throw new xa;const i=r.session;let a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await eo(this.storage,this.storageKey));const{data:l,error:c}=await co(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:i.access_token,xform:po});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(n){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new xa;const t=Date.now()/1e3;let n=t,r=!0,s=null;const{payload:i}=Za(e.access_token);if(i.exp&&(n=i.exp,r=n<=t),r){const{data:t,error:n}=await this._callRefreshToken(e.refresh_token);if(n)return this._returnResult({data:{user:null,session:null},error:n});if(!t)return{data:{user:null,session:null},error:null};s=t}else{const{data:r,error:i}=await this._getUser(e.access_token);if(i)return this._returnResult({data:{user:null,session:null},error:i});s={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(t){if(va(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:r,error:s}=t;if(s)throw s;e=null!==(n=r.session)&&void 0!==n?n:void 0}if(!(null==e?void 0:e.refresh_token))throw new xa;const{data:r,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):r?this._returnResult({data:{user:r.user,session:r},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(va(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!Ka())throw new Ea("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ea(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Ta("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Ea("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ta("No code detected.");const{data:t,error:n}=await this._exchangeCodeForSession(e.code);if(n)throw n;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:r,access_token:s,refresh_token:i,expires_in:a,expires_at:o,token_type:l}=e;if(!(s&&a&&i&&l))throw new Ea("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(a);let d=c+u;o&&(d=parseInt(o));const h=d-c;1e3*h<=da&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${u}s`);const p=d-u;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,c);const{data:f,error:g}=await this._getUser(s);if(g)throw g;const m={provider_token:n,provider_refresh_token:r,access_token:s,expires_in:u,expires_at:d,refresh_token:i,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:m,redirectType:e.type},error:null})}catch(n){if(va(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return"function"==typeof this.detectSessionInUrl?this.detectSessionInUrl(new URL(window.location.href),e):Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ja(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s&&!Sa(s))return this._returnResult({error:s});const i=null===(n=r.session)||void 0===n?void 0:n.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return va(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status)&&!Sa(t))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await Va(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=Symbol("auth-callback"),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>{await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,r;try{const{data:{session:r},error:s}=t;if(s)throw s;await(null===(n=this.stateChangeEmitters.get(e))||void 0===n?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(s){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let n=null,r=null;"pkce"===this.flowType&&([n,r]=await eo(this.storage,this.storageKey,!0));try{return await co(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:r}=await this._useSession(async t=>{var n,r,s,i,a;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:!0});return await co(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(a=null===(i=o.session)||void 0===i?void 0:i.access_token)&&void 0!==a?a:void 0})});if(r)throw r;return Ka()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==n?void 0:n.url),this._returnResult({data:{provider:e.provider,url:null==n?void 0:n.url},error:null})}catch(n){if(va(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:r,data:{session:s}}=t;if(r)throw r;const{options:i,provider:a,token:o,access_token:l,nonce:c}=e,u=await co(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(n=null==s?void 0:s.access_token)&&void 0!==n?n:void 0,body:{provider:a,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:uo}),{data:d,error:h}=u;return h?this._returnResult({data:{user:null,session:null},error:h}):d&&d.session&&d.user?(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("USER_UPDATED",d.session)),this._returnResult({data:d,error:h})):this._returnResult({data:{user:null,session:null},error:new ka})}catch(r){if(await Va(this.storage,`${this.storageKey}-code-verifier`),va(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,r;const{data:s,error:i}=t;if(i)throw i;return await co(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(n=s.session)||void 0===n?void 0:n.access_token)&&void 0!==r?r:void 0})})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await function(e,t){const n=new Promise((n,r)=>{(async()=>{for(let s=0;s<1/0;s++)try{const r=await e(s);if(!t(s,null,r))return void n(r)}catch(bl){if(!t(s,bl))return void r(bl)}})()});return n}(async n=>(n>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await co(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:uo})),(e,t)=>{const r=200*Math.pow(2,e);return t&&Oa(t)&&Date.now()+r-n<da})}catch(n){if(this._debug(t,"error",n),va(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Ka()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Ja(this.storage,this.storageKey);if(s&&this.userStorage){let t=await Ja(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:s.user},await Ga(this.userStorage,this.storageKey+"-user",t)),s.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:so()}else if(s&&!s.user&&!s.user){const e=await Ja(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(s.user=e.user,await Va(this.storage,this.storageKey+"-user"),await Ga(this.storage,this.storageKey,s)):s.user=so()}if(this._debug(n,"session from storage",s),!this._isValidSession(s))return this._debug(n,"session is not valid"),void(null!==s&&await this._removeSession());const i=1e3*(null!==(t=s.expires_at)&&void 0!==t?t:1/0)-Date.now()<ha;if(this._debug(n,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),Oa(e)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(n,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return this._debug(n,"error",s),void console.error(s)}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new xa;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Ya;const{data:t,error:n}=await this._refreshAccessToken(e);if(n)throw n;if(!t.session)throw new xa;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(s){if(this._debug(r,"error",s),va(s)){const e={data:null,error:s};return Oa(s)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(n=this.refreshingDeferred)||void 0===n||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,n=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],s=Array.from(this.stateChangeEmitters.values()).map(async n=>{try{await n.callback(e,t)}catch(bl){r.push(bl)}});if(await Promise.all(s),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Va(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!n&&t.user&&await Ga(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=io(e);await Ga(this.storage,this.storageKey,r)}else{const e=io(t);await Ga(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Va(this.storage,this.storageKey),await Va(this.storage,this.storageKey+"-code-verifier"),await Va(this.storage,this.storageKey+"-user"),this.userStorage&&await Va(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ka()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(bl){console.error("removing visibilitychange callback failed",bl)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),da);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*n.expires_at-e)/da);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(n.refresh_token)})}catch(bl){console.error("Auto refresh tick failed with error. This is likely a transient error.",bl)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(bl){if(!(bl.isAcquireTimeout||bl instanceof _o))throw bl;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ka()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const r=[`provider=${encodeURIComponent(t)}`];if((null==n?void 0:n.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),(null==n?void 0:n.scopes)&&r.push(`scopes=${encodeURIComponent(n.scopes)}`),"pkce"===this.flowType){const[e,t]=await eo(this.storage,this.storageKey),n=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(n.toString())}if(null==n?void 0:n.queryParams){const e=new URLSearchParams(n.queryParams);r.push(e.toString())}return(null==n?void 0:n.skipBrowserRedirect)&&r.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;return s?this._returnResult({data:null,error:s}):await co(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token})})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,r;const{data:s,error:i}=t;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await co(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null===(n=null==s?void 0:s.session)||void 0===n?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?Ao(e.webauthn.credential_response):Po(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:o}=await co(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:i,headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token});return o?this._returnResult({data:null,error:o}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:o}))})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:r,error:s}=t;if(s)return this._returnResult({data:null,error:s});const i=await co(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(n=null==r?void 0:r.session)||void 0===n?void 0:n.access_token});if(i.error)return i;const{data:a}=i;if("webauthn"!==a.type)return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Io(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:No(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const r={all:[],phone:[],totp:[],webauthn:[]};for(const s of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(s),"verified"===s.status&&r[s.factor_type].push(s);return{data:r,error:null}}async _getAuthenticatorAssuranceLevel(e){var t,n,r,s;if(e)try{const{payload:r}=Za(e);let s=null;r.aal&&(s=r.aal);let i=s;const{data:{user:a},error:o}=await this.getUser(e);if(o)return this._returnResult({data:null,error:o});(null!==(n=null===(t=null==a?void 0:a.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==n?n:[]).length>0&&(i="aal2");return{data:{currentLevel:s,nextLevel:i,currentAuthenticationMethods:r.amr||[]},error:null}}catch(u){if(va(u))return this._returnResult({data:null,error:u});throw u}const{data:{session:i},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Za(i.access_token);let l=null;o.aal&&(l=o.aal);let c=l;(null!==(s=null===(r=i.user.factors)||void 0===r?void 0:r.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(c="aal2");return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:o.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?await co(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new xa})})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!r)return this._returnResult({data:null,error:new xa});const i=await co(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&Ka()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(n){if(va(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!r)return this._returnResult({data:null,error:new xa});const i=await co(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:r.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&Ka()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(n){if(va(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await co(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new xa})})}catch(e){if(va(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;return r?this._returnResult({data:null,error:r}):n?(await co(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new xa})})}catch(t){if(va(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(t=>t.kid===e);if(n)return n;const r=Date.now();if(n=this.jwks.keys.find(t=>t.kid===e),n&&this.jwks_cached_at+6e5>r)return n;const{data:s,error:i}=await co(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return s.keys&&0!==s.keys.length?(this.jwks=s,this.jwks_cached_at=r,n=s.keys.find(t=>t.kid===e),n||null):null}async getClaims(e,t={}){try{let n=e;if(!n){const{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});n=e.session.access_token}const{header:r,payload:s,signature:i,raw:{header:a,payload:o}}=Za(n);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(s.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(n);if(e)throw e;return{data:{claims:s,header:r,signature:i},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),u=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,u,i,Wa(`${a}.${o}`))))throw new Na("Invalid JWT signature");return{data:{claims:s,header:r,signature:i},error:null}}catch(n){if(va(n))return this._returnResult({data:null,error:n});throw n}}}zo.nextInstanceID={};const Fo=zo;let Ho="";Ho="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Go={headers:{"X-Client-Info":`supabase-js-${Ho}/2.95.3`}},Jo={schema:"public"},Vo={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Yo={};function Zo(e){return(Zo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Xo(e){var t=function(e,t){if("object"!=Zo(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t);if("object"!=Zo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Zo(t)?t:t+""}function Qo(e,t,n){return(t=Xo(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function el(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?el(Object(n),!0).forEach(function(t){Qo(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):el(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}const nl=(e,t,n)=>{const r=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(n),s=Headers;return async(n,i)=>{var a;const o=null!==(a=await t())&&void 0!==a?a:e;let l=new s(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(n,tl(tl({},i),{},{headers:l}))}};var rl=class extends Fo{constructor(e){super(e)}},sl=class{constructor(e,t,n){var r,s;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((n=t).endsWith("/")?n:n+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var n}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const a=`sb-${i.hostname.split(".")[0]}-auth-token`,o=function(e,t){var n,r;const{db:s,auth:i,realtime:a,global:o}=e,{db:l,auth:c,realtime:u,global:d}=t,h={db:tl(tl({},l),s),auth:tl(tl({},c),i),realtime:tl(tl({},u),a),storage:{},global:tl(tl(tl({},d),o),{},{headers:tl(tl({},null!==(n=null==d?void 0:d.headers)&&void 0!==n?n:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=n?n:{},{db:Jo,realtime:Yo,auth:tl(tl({},Vo),{},{storageKey:a}),global:Go});var l;(this.storageKey=null!==(r=o.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(s=o.global.headers)&&void 0!==s?s:{},o.accessToken)?(this.accessToken=o.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(l=o.auth)&&void 0!==l?l:{},this.headers,o.global.fetch);this.fetch=nl(t,this._getAccessToken.bind(this),o.global.fetch),this.realtime=this._initRealtimeClient(tl({headers:this.headers,accessToken:this._getAccessToken.bind(this)},o.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new Ls(new URL("rest/v1",i).href,{headers:this.headers,schema:o.db.schema,fetch:this.fetch,timeout:o.db.timeout,urlLengthLimit:o.db.urlLengthLimit}),this.storage=new ca(this.storageUrl.href,this.headers,this.fetch,null==n?void 0:n.storage),o.accessToken||this._listenForAuthEvents()}get functions(){return new js(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t,n=this;if(n.accessToken)return await n.accessToken();const{data:r}=await n.auth.getSession();return null!==(e=null===(t=r.session)||void 0===t?void 0:t.access_token)&&void 0!==e?e:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:s,storageKey:i,flowType:a,lock:o,debug:l,throwOnError:c},u,d){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rl({url:this.authUrl.href,headers:tl(tl({},h),u),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:r,userStorage:s,flowType:a,lock:o,debug:l,throwOnError:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new vi(this.realtimeUrl.href,tl(tl({},e),{},{params:tl(tl({},{apikey:this.supabaseKey}),null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,n){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===n?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=n,this.realtime.setAuth(n))}};(function(){if("undefined"!=typeof window)return!1;const e=globalThis.process;if(!e)return!1;const t=e.version;if(null==t)return!1;const n=t.match(/^v(\d+)\./);return!!n&&parseInt(n[1],10)<=18})()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const il=((e,t,n)=>new sl(e,t,n))("https://vgsnxczxnrxuorfgtlgx.supabase.co","sb_publishable_FOi7EsAeShTCDLXtXayP_g_GrTcDm6Y",{realtime:{params:{eventsPerSecond:10}}});function al(){const n=Rt(),[r,s]=t.useState(null);t.useEffect(()=>{(()=>{const e=window.Telegram?.WebApp;e?.initDataUnsafe?.user&&s(e.initDataUnsafe.user)})()},[]),t.useEffect(()=>{if(n.account?.address&&r){(async()=>{try{const{data:e}=await il.from("users").select("id").eq("telegram_id",r.id.toString()).single();e&&await il.from("users").update({ton_address:n.account.address}).eq("id",e.id)}catch(e){console.error("Error saving wallet address:",e)}})()}},[n.account,r]);return e.jsx("div",{className:"wallet-connect",children:n.connected?e.jsxs("div",{className:"neon-text",children:[e.jsx("div",{className:"text-sm mb-2",children:" Wallet Connected"}),e.jsx("div",{className:"font-bold",children:(i=n.account.address,`${i.slice(0,4)}...${i.slice(-4)}`)}),e.jsx("button",{className:"neon-button pulse mt-2",onClick:()=>n.disconnect(),children:"Disconnect"})]}):e.jsx("button",{className:"neon-button pulse",onClick:()=>n.connect(),children:"Connect Wallet"})});var i}function ol(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function ll(...e){return e.map(e=>"string"==typeof e?e:ol(e)?ll(Object.entries(e).map(e=>e[1]&&e[0])):Array.isArray(e)?ll(...e):void 0).filter(Boolean).join(" ")}function cl(e,t){if(Array.isArray(t))return ll(t.map(t=>cl(e,t)));if(ol(t))return ll(Object.entries(t).map(([t,n])=>n&&cl(e,t)));const n=ll(t);return n&&`${e}--${n}`}function ul(e,...t){return ll(e,cl(e,t))}function dl(e){return[(...t)=>ul(e,t),(t,...n)=>ul(`${e}__${t}`,n)]}console.log("Supabase client ready  URL and key loaded successfully");const[hl,pl]=dl("rgb"),fl=({color:t,className:n,...r})=>e.jsxs("span",{...r,className:ll(hl(),n),children:[e.jsx("i",{className:pl("icon"),style:{backgroundColor:t}}),t]}),gl=({className:n,onClick:r,to:s,...i})=>{const a=Pr(),o=t.useCallback(e=>{let t;if(r?.(e),"string"==typeof s)t=s;else{const{search:e="",pathname:n="",hash:r=""}=s;t=`${n}?${e}#${r}`}const n=new URL(t,window.location.toString()),i=new URL(window.location.toString());(n.protocol!==i.protocol||n.host!==i.host)&&(e.preventDefault(),a.openLink(n.toString()))},[s,r,a]);return e.jsx(Hn,{...i,to:s,onClick:o,className:ll(n,"link")})},[,ml]=dl("display-data"),yl=({header:t,rows:n})=>e.jsx(ds,{header:t,children:n.map((t,n)=>{let r;if(void 0===t.value)r=e.jsx("i",{children:"empty"});else if("type"in t)r=e.jsx(gl,{to:t.value,children:"Open"});else if("string"==typeof t.value){r=/^rgb\(\d+,\s*\d+,\s*\d+\)$/.test(t.value)?e.jsx(fl,{color:t.value}):t.value}else r="boolean"==typeof t.value?e.jsx(ms,{checked:t.value,disabled:!0}):t.value;return e.jsx(Hr,{className:ml("line"),subhead:t.title,readOnly:!0,multiline:!0,children:e.jsx("span",{className:ml("line-value"),children:r})},n)})});function vl({children:n,back:r=!0}){const s=kn(),i=Cr();return t.useEffect(()=>{if(r)return i.show(),i.onClick(()=>{s(-1)});i.hide()},[r,i]),e.jsx(e.Fragment,{children:n})}function wl(e){return Object.entries(e).map(([e,t])=>({title:e,value:String(t)}))}const[,bl]=dl("ton-connect-page"),_l=[{path:"/",Component:function(){const{initData:n}=Ir(),[r,s]=t.useState(null),[i,a]=t.useState(!0),[o,l]=t.useState(!1),[c,u]=t.useState(0),[d,h]=t.useState(10),[p,f]=t.useState(100);!function(e,n){const[r,s]=t.useState(e?.last_energy_regen||(new Date).toISOString());t.useEffect(()=>{if(!e)return;const t=setInterval(async()=>{const t=new Date,r=new Date(e.last_energy_regen),i=Math.floor((t.getTime()-r.getTime())/6e4);if(i>=1&&e.energy<100){const r=Math.min(2*i,100-e.energy),o=e.energy+r;try{const{data:r}=await il.from("users").update({energy:o,last_energy_regen:t.toISOString()}).eq("id",e.id).select().single();r&&(n(r),s(r.last_energy_regen))}catch(a){console.error("Error regenerating energy:",a)}}},5e3);return()=>clearInterval(t)},[e,n])}(r,s),t.useEffect(()=>{g()},[]),t.useEffect(()=>{if(o&&d>0){const e=setTimeout(()=>h(d-1),1e3);return()=>clearTimeout(e)}o&&0===d&&y()},[o,d]);const g=async()=>{const e=n?.user;if(e?.id)try{const{data:t}=await il.from("users").select("*").eq("telegram_id",e.id.toString()).single();if(t)s(t),f(t.energy),localStorage.setItem("telegram_id",e.id.toString());else{const t={telegram_id:e.id.toString(),username:e.username||"Anonymous",score:0,energy:100,level:1,tap_multiplier:1,energy_boost:0},{data:n}=await il.from("users").insert(t).select().single();s(n),f(n.energy),localStorage.setItem("telegram_id",e.id.toString())}}catch(t){console.error("Error initializing user:",t)}finally{a(!1)}},y=async()=>{if(l(!1),r){const e=r.score+c,t=Math.floor(e/100)+1;await il.from("users").update({score:e,level:t}).eq("telegram_id",r.telegram_id),s(n=>n?{...n,score:e,level:t}:null)}alert(`Game Over! You scored ${c} taps!`)};if(i)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."});const v=100+(r?.energy_boost||0),w=p/v*100;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-black via-gray-900 to-black text-cyan-400 p-4 relative overflow-hidden font-orbitron",children:[e.jsx("div",{className:"absolute inset-0 cyberpunk-scanlines"}),e.jsx("div",{className:"absolute inset-0 cyberpunk-particles"}),e.jsxs("div",{className:"relative z-10 max-w-md mx-auto",children:[e.jsx(m,{className:"text-center mb-8 text-6xl font-black cyberpunk-title",children:" TAP DUEL "}),e.jsx("div",{className:"mb-8",children:e.jsx(al,{})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"cyberpunk-card",children:[e.jsx("div",{className:"text-sm cyberpunk-label mb-2",children:"PLAYER"}),e.jsx("div",{className:"text-xl font-bold cyberpunk-text",children:r?.username||"Anonymous"})]}),e.jsxs("div",{className:"cyberpunk-card",children:[e.jsx("div",{className:"text-sm cyberpunk-label mb-2",children:"LEVEL"}),e.jsx("div",{className:"text-xl font-bold cyberpunk-text",children:r?.level||1})]}),e.jsxs("div",{className:"cyberpunk-card",children:[e.jsx("div",{className:"text-sm cyberpunk-label mb-2",children:"SCORE"}),e.jsx("div",{className:"text-xl font-bold cyberpunk-text cyberpunk-glitch",children:r?.score||0})]}),e.jsxs("div",{className:"cyberpunk-card",children:[e.jsx("div",{className:"text-sm cyberpunk-label mb-2",children:"MULTI"}),e.jsxs("div",{className:"text-xl font-bold cyberpunk-text",children:["x",r?.tap_multiplier||1]})]})]}),e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"cyberpunk-card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"cyberpunk-label",children:"ENERGY"}),e.jsxs("span",{className:"cyberpunk-text",children:[p,"/",v]})]}),e.jsxs("div",{className:"relative w-24 h-24 mx-auto",children:[e.jsxs("svg",{className:"w-24 h-24 transform -rotate-90",children:[e.jsx("circle",{cx:"48",cy:"48",r:"36",stroke:"rgba(0, 255, 255, 0.2)",strokeWidth:"8",fill:"none"}),e.jsx("circle",{cx:"48",cy:"48",r:"36",stroke:"url(#energyGradient)",strokeWidth:"8",fill:"none",strokeDasharray:""+2*Math.PI*36,strokeDashoffset:""+2*Math.PI*36*(1-w/100),className:"transition-all duration-500"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"energyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#00ffff"}),e.jsx("stop",{offset:"50%",stopColor:"#00aaff"}),e.jsx("stop",{offset:"100%",stopColor:"#0044aa"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold cyberpunk-text",children:[Math.round(w),"%"]})})]})]})}),o?e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-9xl font-black mb-4 cyberpunk-text-cyber cyberpunk-glitch",children:c}),e.jsxs("div",{className:"text-4xl cyberpunk-text cyberpunk-breathe",children:[" TIME: ",d,"s "]})]}),e.jsx("div",{className:"relative inline-block",children:e.jsxs("button",{onClick:()=>{if(!o||0===d)return;const e=r?.tap_multiplier||1;u(t=>t+Math.floor(e))},className:"cyberpunk-tap-button",children:[e.jsx("span",{className:"cyberpunk-tap-text",children:"TAP!"}),e.jsx("div",{className:"cyberpunk-ripple"}),e.jsx("div",{className:"cyberpunk-particles-burst"})]})})]}):e.jsx("div",{className:"text-center mb-8",children:e.jsx("button",{onClick:()=>{p<10?alert(`Not enough energy! You need at least 10 energy to play. Current: ${p}/${100+(r?.energy_boost||0)}`):(l(!0),u(0),h(10),f(e=>e-10))},disabled:p<10,className:"cyberpunk-button-main w-full max-w-sm mx-auto disabled:opacity-50",children:" START TAPPING (10 Energy) "})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>window.location.href="/duel",className:"cyberpunk-button-nav",children:" DUEL"}),e.jsx("button",{onClick:()=>window.location.href="/leaderboard",className:"cyberpunk-button-nav",children:" LEADERBOARD"}),e.jsx("button",{onClick:()=>window.location.href="/rewards",className:"cyberpunk-button-nav",children:" REWARDS"}),e.jsx("button",{onClick:()=>window.location.href="/shop",className:"cyberpunk-button-nav",children:" UPGRADES"})]})]})]})}},{path:"/duel",Component:function(){const{initData:n}=Ir(),[r,s]=t.useState(null),[i,a]=t.useState(null),[o,l]=t.useState(!0),[c,u]=t.useState(!1),[d,h]=t.useState(0),[p,f]=t.useState(10),[g,y]=t.useState(!1),[v,w]=t.useState(0);t.useEffect(()=>{b()},[]),t.useEffect(()=>{if(g&&p>0){const e=setTimeout(()=>f(p-1),1e3);return()=>clearTimeout(e)}g&&0===p&&_()},[g,p]),t.useEffect(()=>{if(i&&"active"===i.status){const e=il.channel(`duel:${i.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"duels",filter:`id=eq.${i.id}`},e=>{const t=e.new;a(t),r&&(t.player1_id===r.id?w(t.player2_taps):w(t.player1_taps))}).subscribe();return()=>{il.removeChannel(e)}}},[i,r]);const b=async()=>{const e=n?.user;if(e?.id)try{const{data:t}=await il.from("users").select("*").eq("telegram_id",e.id.toString()).single();s(t)}catch(t){console.error("Error initializing user:",t)}finally{l(!1)}},_=async()=>{if(y(!1),!i||!r)return;const e=i.player1_id===r.id?d:i.player1_taps,t=i.player1_id===r.id?i.player2_taps:d;let n=null,s=0,o="",l=0;if(e>t){n=r.id,s=50;const i=e+s;l=Math.floor(.1*i);o=` VICTORY! You won with ${e} vs ${t} taps!\n +${e} taps + ${s} bonus = ${i} total\n 10% fee: -${l} points\n Net: +${i-l} points!`}else o=e<t?` DEFEAT! You lost with ${e} vs ${t} taps.`:` DRAW! Both players got ${e} taps!`;await il.from("duels").update({end_time:(new Date).toISOString(),winner_id:n,status:"completed",fee_amount:l}).eq("id",i.id);const c=r.score+e+s-l;await il.from("users").update({score:c}).eq("id",r.id),l>0&&await il.from("fee_transactions").insert({duel_id:i.id,winner_id:r.id,fee_amount:l,total_winnings:e+s,created_at:(new Date).toISOString()}),alert(o),a(null),h(0),w(0)};return o?e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):e.jsx("div",{className:"min-h-screen bg-black text-cyan-400 p-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(m,{className:"text-center mb-6 text-5xl font-black neon-text glitch",children:" DUEL ARENA "}),e.jsxs(ds,{className:"mb-4 neon-border",children:[e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"neon-text",children:[" Player: ",r?.username]}),e.jsxs("span",{className:"neon-text",children:[" Energy: ",r?.energy,"/100"]})]})}),e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"neon-text",children:[" Score: ",r?.score]}),e.jsxs("span",{className:"neon-text",children:[" Level: ",r?.level]})]})})]}),i?e.jsxs("div",{children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("div",{className:"text-3xl font-black neon-text glitch mb-4",children:"waiting"===i.status?" WAITING FOR OPPONENT... ":" DUEL IN PROGRESS! "})}),g&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"text-center neon-border p-4 rounded-lg transition-all duration-300 hover:scale-105",children:[e.jsx("div",{className:"text-lg neon-text mb-3 font-bold",children:" YOU"}),e.jsx("div",{className:"text-6xl font-black neon-text glitch animate-pulse",children:d})]}),e.jsxs("div",{className:"text-center neon-border p-4 rounded-lg transition-all duration-300 hover:scale-105",children:[e.jsx("div",{className:"text-lg neon-text mb-3 font-bold",children:" OPPONENT"}),e.jsx("div",{className:"text-6xl font-black neon-text glitch animate-pulse",children:v})]})]}),e.jsx("div",{className:"text-center mb-8",children:e.jsxs("div",{className:"text-5xl neon-text breathe font-black",children:[" TIME: ",p,"s "]})}),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>{if(!g||0===p||!i||!r)return;const e=r.tap_multiplier||1,t=d+Math.floor(e);h(t);const n=i.player1_id===r.id?{player1_taps:t}:{player2_taps:t};il.from("duels").update(n).eq("id",i.id)},className:"w-72 h-72 rounded-full transition-all duration-100 transform active:scale-95 text-white text-5xl font-black neon-border pulse breathe relative overflow-hidden",style:{background:"radial-gradient(circle, #00ffff 0%, #0088ff 30%, #0044aa 70%, #002255 100%)",boxShadow:"0 0 60px #00ffff, 0 0 120px #00ffff, 0 0 180px #0088ff, inset 0 0 60px rgba(0, 255, 255, 0.6)"},children:[e.jsx("span",{className:"relative z-10 drop-shadow-2xl animate-pulse",children:"TAP!"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-white opacity-0 animate-ping"}),e.jsx("div",{className:"absolute inset-0 rounded-full bg-cyan-400 opacity-20 animate-pulse"})]})})]})]}):e.jsxs("div",{className:"text-center",children:[e.jsx(is,{onClick:async()=>{if(!r||r.energy<20)alert("Not enough energy! You need at least 20 energy for a duel.");else{u(!0);try{const{data:e}=await il.from("duels").select("*").eq("status","waiting").neq("player1_id",r.id).limit(1);if(e&&e.length>0){const t=e[0],{data:n}=await il.from("duels").update({player2_id:r.id,status:"active",start_time:(new Date).toISOString()}).eq("id",t.id).select().single();a(n),y(!0),h(0),f(10),await il.from("users").update({energy:r.energy-20}).eq("id",r.id)}else{const{data:e}=await il.from("duels").insert({player1_id:r.id,status:"waiting"}).select().single();a(e);const t=setInterval(async()=>{const{data:n}=await il.from("duels").select("*").eq("id",e.id).single();n&&"active"===n.status&&(a(n),y(!0),h(0),f(10),clearInterval(t))},1e3);setTimeout(()=>{clearInterval(t),g||(alert("No opponent found. Try again!"),u(!1),a(null))},3e4)}}catch(e){console.error("Error finding duel:",e),alert("Error finding duel. Please try again.")}finally{u(!1)}}},disabled:c||(r?.energy||0)<20,className:"neon-button pulse font-bold py-6 px-12 rounded-lg text-xl transition-all duration-300 hover:scale-105 shadow-[0_0_30px_#00ffff,0_0_60px_#00aaff] ring-cyan-500/50",style:{background:"linear-gradient(135deg, #00ffff 0%, #0088ff 50%, #0044aa 100%)"},children:c?" SEARCHING... ":" FIND DUEL (20 Energy) "}),c&&e.jsx("div",{className:"mt-4 text-xl neon-text animate-pulse",children:" Looking for opponent... Please wait... "})]}),e.jsx("div",{className:"mt-8",children:e.jsx(is,{onClick:()=>window.location.href="/",className:"neon-button pulse font-bold py-4 px-8 rounded-lg w-full text-lg transition-all duration-300 hover:scale-105 shadow-[0_0_30px_#00ffff,0_0_60px_#00aaff] ring-cyan-500/50",style:{background:"linear-gradient(135deg, #00ffff 0%, #0088ff 50%, #0044aa 100%)"},children:" HOME"})})]})})}},{path:"/leaderboard",Component:function(){const[n,r]=t.useState([]),[s,i]=t.useState(!0);t.useEffect(()=>{a()},[]);const a=async()=>{try{const{data:e}=await il.from("users").select("*").order("score",{ascending:!1}).limit(20);r(e||[])}catch(e){console.error("Error fetching leaderboard:",e)}finally{i(!1)}},o=e=>{switch(e){case 1:return"";case 2:return"";case 3:return"";default:return`#${e}`}};return s?e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):e.jsx("div",{className:"min-h-screen bg-black text-cyan-400 p-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(m,{className:"text-center mb-6 text-cyan-400 font-bold",children:" LEADERBOARD "}),e.jsx(ds,{className:"mb-4",children:n.map((t,n)=>e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl font-bold",children:o(n+1)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:t.username}),e.jsxs("div",{className:"text-sm text-cyan-300",children:["Level ",t.level]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-bold text-cyan-300",children:t.score}),e.jsx("div",{className:"text-xs text-cyan-500",children:"points"})]})]})},t.id))}),e.jsx("div",{className:"mt-6",children:e.jsx(is,{onClick:()=>window.location.href="/",className:"bg-gray-600 hover:bg-gray-500 text-white w-full",children:" HOME"})})]})})}},{path:"/rewards",Component:function(){const[n,r]=t.useState(null),[s,i]=t.useState(!0),[a,o]=t.useState(!1);t.useEffect(()=>{l()},[]);const l=async()=>{try{const e=localStorage.getItem("telegram_id");if(!e)return;const{data:t}=await il.from("users").select("*").eq("telegram_id",e).single();r(t)}catch(e){console.error("Error initializing user:",e)}finally{i(!1)}};return s?e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."}):e.jsx("div",{className:"min-h-screen bg-black text-cyan-400 p-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(m,{className:"text-center mb-6 text-cyan-400 font-bold",children:" DAILY REWARDS "}),e.jsxs(ds,{className:"mb-4",children:[e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Player: ",n?.username]}),e.jsxs("span",{children:["Level: ",n?.level]})]})}),e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Current Score: ",n?.score]}),e.jsxs("span",{children:["Energy: ",n?.energy,"/100"]})]})})]}),e.jsx(ds,{className:"mb-4",children:e.jsx(Hr,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-xl font-bold mb-2 text-cyan-300",children:"Daily Reward"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-lg",children:"Base Reward: 50 points"}),e.jsxs("div",{className:"text-lg",children:["Level Bonus: +",n?.level||0,"0 points"]}),e.jsxs("div",{className:"text-lg font-bold text-cyan-300",children:["Total: ",50+10*(n?.level||0)," points"]}),e.jsx("div",{className:"text-sm text-cyan-500 mt-2",children:"+30 Energy Bonus"})]}),(()=>{if(!n)return!1;const e=new Date,t=new Date(n.updated_at);return e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()||e.getFullYear()!==t.getFullYear()||!n.daily_reward_claimed})()?e.jsx(is,{onClick:async()=>{if(n&&!n.daily_reward_claimed){o(!0);try{const e=50+10*n.level,{data:t}=await il.from("users").update({score:n.score+e,daily_reward_claimed:!0,energy:Math.min(n.energy+30,100)}).eq("id",n.id).select().single();r(t),alert(` Daily reward claimed! +${e} points and +30 energy!`)}catch(e){console.error("Error claiming daily reward:",e),alert("Error claiming reward. Please try again.")}finally{o(!1)}}},disabled:a,className:"bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-6 rounded-lg shadow-lg shadow-green-500/50 transition-all duration-200 transform hover:scale-105",children:a?"CLAIMING...":"CLAIM DAILY REWARD"}):e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-cyan-300 mb-2",children:" Already claimed today!"}),e.jsxs("div",{className:"text-sm text-cyan-500",children:["Next claim: ",(()=>{if(!n)return"";const e=new Date;return e.setDate(e.getDate()+1),e.setHours(0,0,0,0),e.toLocaleString()})()]})]})]})})}),e.jsx(ds,{className:"mb-4",children:e.jsx(Hr,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-2 text-cyan-300",children:"Level Progress"}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"text-sm",children:["Level ",n?.level||1]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-4 mt-2",children:e.jsx("div",{className:"bg-cyan-400 h-4 rounded-full transition-all duration-300",style:{width:(n?.score||0)%100+"%"}})}),e.jsxs("div",{className:"text-xs text-cyan-500 mt-1",children:[(n?.score||0)%100,"/100 to next level"]})]})]})})}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-4",children:[e.jsx(is,{onClick:()=>window.location.href="/shop",className:"bg-purple-600 hover:bg-purple-500 text-white",children:" UPGRADES"}),e.jsx(is,{onClick:()=>window.location.href="/",className:"bg-gray-600 hover:bg-gray-500 text-white",children:" HOME"})]})]})})}},{path:"/shop",Component:function(){const[n,r]=t.useState(null),[s,i]=t.useState(!0),[a,o]=t.useState(null);t.useEffect(()=>{l()},[]);const l=async()=>{try{const e=localStorage.getItem("telegram_id");if(!e)return;const{data:t}=await il.from("users").select("*").eq("telegram_id",e).single();r(t)}catch(e){console.error("Error initializing user:",e)}finally{i(!1)}},c=()=>n?[{id:"tap_multiplier",name:"Tap Multiplier",description:"Increase taps per click",cost:Math.floor(100*(n.tap_multiplier||1)),effect:`x${((n.tap_multiplier||1)+.1).toFixed(1)}`,maxLevel:5,currentLevel:10*Math.floor((n.tap_multiplier||1)-1)},{id:"energy_boost",name:"Energy Boost",description:"Increase max energy capacity",cost:200,effect:"+20 max energy",maxLevel:5,currentLevel:n.energy_boost||0},{id:"energy_regen",name:"Energy Regeneration",description:"Faster energy recovery",cost:150,effect:"+1 energy per minute",maxLevel:3,currentLevel:0}]:[];if(s)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Loading..."});const u=c();return e.jsx("div",{className:"min-h-screen bg-black text-cyan-400 p-4",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(m,{className:"text-center mb-6 text-cyan-400 font-bold",children:" UPGRADE SHOP "}),e.jsxs(ds,{className:"mb-4",children:[e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Player: ",n?.username]}),e.jsxs("span",{children:["Level: ",n?.level]})]})}),e.jsx(Hr,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{children:["Points: ",n?.score]}),e.jsxs("span",{children:["Energy: ",n?.energy,"/",100+(n?.energy_boost||0)]})]})})]}),e.jsx(ds,{className:"mb-4",children:u.map(t=>e.jsx(Hr,{children:e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-cyan-300",children:t.name}),e.jsx("p",{className:"text-sm text-cyan-500",children:t.description}),e.jsxs("div",{className:"text-xs text-cyan-400 mt-1",children:["Level: ",t.currentLevel,"/",t.maxLevel]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-cyan-400",children:[t.cost," pts"]}),e.jsx("div",{className:"text-xs text-cyan-500",children:t.effect})]})]}),e.jsx(is,{onClick:()=>(async e=>{if(!n)return;const t=c().find(t=>t.id===e);if(t)if(n.score<t.cost)alert("Not enough points!");else if(t.currentLevel>=t.maxLevel)alert("Maximum level reached!");else{o(e);try{let s={score:n.score-t.cost};switch(e){case"tap_multiplier":s.tap_multiplier=(n.tap_multiplier||1)+.1;break;case"energy_boost":s.energy_boost=(n.energy_boost||0)+20,s.energy=Math.min(n.energy+20,100+(n.energy_boost||0)+20)}const{data:i}=await il.from("users").update(s).eq("id",n.id).select().single();r(i),alert(` Upgrade purchased: ${t.name}!`)}catch(s){console.error("Error purchasing upgrade:",s),alert("Error purchasing upgrade. Please try again.")}finally{o(null)}}})(t.id),disabled:a===t.id||(n?.score||0)<t.cost||t.currentLevel>=t.maxLevel,className:`w-full ${t.currentLevel>=t.maxLevel?"bg-gray-600 text-gray-400":a===t.id?"bg-yellow-600 text-white":"bg-purple-600 hover:bg-purple-500 text-white"} font-bold py-2 px-4 rounded transition-all duration-200`,children:t.currentLevel>=t.maxLevel?"MAX LEVEL":a===t.id?"PURCHASING...":"PURCHASE"})]})},t.id))}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-4",children:[e.jsx(is,{onClick:()=>window.location.href="/rewards",className:"bg-green-600 hover:bg-green-500 text-white",children:" REWARDS"}),e.jsx(is,{onClick:()=>window.location.href="/",className:"bg-gray-600 hover:bg-gray-500 text-white",children:" HOME"})]})]})})}},{path:"/init-data",Component:()=>{const n=Or();if(!n)return e.jsx(vl,{children:e.jsx(y,{header:"Oops",description:"Application was launched with missing init data",children:e.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})})});const r=t.useMemo(()=>[{title:"raw",value:JSON.stringify(n)},...Object.entries(n).reduce((e,[t,n])=>(n instanceof Date?e.push({title:t,value:n.toISOString()}):n&&"object"==typeof n||e.push({title:t,value:String(n)}),e),[])],[n]),s=t.useMemo(()=>n.user?wl(n.user):void 0,[n]),i=t.useMemo(()=>n.receiver?wl(n.receiver):void 0,[n]),a=t.useMemo(()=>n.chat?Object.entries(n.chat).map(([e,t])=>({title:e,value:String(t)})):void 0,[n]);return e.jsx(vl,{children:e.jsxs(as,{children:[e.jsx(yl,{header:"Init Data",rows:r}),s&&e.jsx(yl,{header:"User",rows:s}),i&&e.jsx(yl,{header:"Receiver",rows:i}),a&&e.jsx(yl,{header:"Chat",rows:a})]})})},title:"Init Data"},{path:"/theme-params",Component:()=>{const t=Ar();return e.jsx(vl,{children:e.jsx(as,{children:e.jsx(yl,{rows:Object.entries(t||{}).map(([e,t])=>({title:e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`).replace(/background/,"bg"),value:String(t)}))})})})},title:"Theme Params"},{path:"/launch-params",Component:()=>{const t=Ir();return e.jsx(vl,{children:e.jsx(as,{children:e.jsx(yl,{rows:[{title:"tgWebAppPlatform",value:t.tgWebAppPlatform},{title:"tgWebAppShowSettings",value:t.tgWebAppShowSettings},{title:"tgWebAppVersion",value:t.tgWebAppVersion},{title:"tgWebAppBotInline",value:t.tgWebAppBotInline},{title:"tgWebAppStartParam",value:t.tgWebAppStartParam},{title:"tgWebAppData",type:"link",value:"/init-data"},{title:"tgWebAppThemeParams",type:"link",value:"/theme-params"}]})})})},title:"Launch Params"},{path:"/ton-connect",Component:()=>{const t=Rt();return Pr(),e.jsxs(vl,{children:[e.jsx(as,{children:e.jsx(y,{header:"TON Connect",description:t.connected?"You are already connected":"To display the data related to the TON Connect, it is required to connect your wallet",action:t.connected?e.jsx("button",{className:bl("button-connected"),onClick:()=>t.disconnect(),children:"Disconnect"}):e.jsx("button",{className:bl("button"),onClick:()=>t.connect(),children:"Connect Wallet"}),children:e.jsx("div",{style:{width:96,height:96,borderRadius:"50%",backgroundColor:t.connected?"#0088cc":"#ccc",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"24px"},children:t.connected?"":"?"})})}),t.connected&&e.jsxs(ds,{header:"Wallet",children:[e.jsx(Hr,{subtitle:"Connection status",children:"Connected"}),e.jsx(Hr,{subtitle:"Wallet address",children:t.account.address})]})]})},title:"TON Connect",icon:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"100%",height:"100%",viewBox:"0 0 56 56",fill:"none",children:[e.jsx("path",{d:"M28 56C43.464 56 56 43.464 56 28C56 12.536 43.464 0 28 0C12.536 0 0 12.536 0 28C0 43.464 12.536 56 28 56Z",fill:"#0098EA"}),e.jsx("path",{d:"M37.5603 15.6277H18.4386C14.9228 15.6277 12.6944 19.4202 14.4632 22.4861L26.2644 42.9409C27.0345 44.2765 28.9644 44.2765 29.7345 42.9409L41.5381 22.4861C43.3045 19.4251 41.0761 15.6277 37.5627 15.6277H37.5603ZM26.2548 36.8068L23.6847 31.8327L17.4833 20.7414C17.0742 20.0315 17.5795 19.1218 18.4362 19.1218H26.2524V36.8092L26.2548 36.8068ZM38.5108 20.739L32.3118 31.8351L29.7417 36.8068V19.1194H37.5579C38.4146 19.1194 38.9199 20.0291 38.5108 20.739Z",fill:"white"})]})}];function xl(e,n){const r=t.useRef(null),[s,i]=t.useState("waiting"),[a,o]=t.useState(null),[l,c]=t.useState([]),[u,d]=t.useState({}),[h,p]=t.useState(null);return t.useEffect(()=>{const t=new WebSocket(`wss://${window.location.host}`);return r.current=t,t.onopen=()=>{t.send(JSON.stringify({type:"join",duelId:e,playerId:n}))},t.onmessage=e=>{const t=JSON.parse(e.data);"players"===t.type&&(c(t.players),i(t.state)),"countdown"===t.type&&(o(t.value),i("countdown")),"start"===t.type&&(o(null),i("active")),"tap_update"===t.type&&d(e=>({...e,[t.playerId]:t.taps})),"result"===t.type&&(i("finished"),p(t))},()=>{t.close()}},[e,n]),{state:s,countdown:a,players:l,taps:u,result:h,sendTap:function(){r.current&&r.current.send(JSON.stringify({type:"tap",duelId:e,playerId:n}))}}}function Sl({duelId:n,playerId:r,walletAddress:s}){const i=kn(),{state:a,countdown:o,players:l}=xl(n,r),c=s?s.slice(0,4)+"..."+s.slice(-4):null,[u,d]=t.useState(null),[h,p]=t.useState("");return t.useEffect(()=>{s&&fetch(`/api/ton/balance?address=${s}`).then(e=>e.json()).then(e=>d(e.balance)).catch(e=>console.error("TON balance fetch error:",e))},[s]),t.useEffect(()=>{"active"===a&&i(`/duel/${n}?stake=${h}`)},[a,n,r,i,h]),e.jsxs("div",{style:{padding:20,textAlign:"center"},children:[c&&e.jsxs("div",{style:{marginBottom:12,fontSize:14,opacity:.8},children:["Wallet: ",c]}),null!==u&&e.jsxs("div",{style:{marginBottom:12,fontSize:14,opacity:.8},children:["Balance: ",u/1e9," TON"]}),s&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx("label",{style:{fontSize:14,opacity:.8},children:"Stake (TON):"}),e.jsx("input",{type:"number",value:h,onChange:e=>p(e.target.value),placeholder:"0.1",min:"0",step:"0.01",style:{width:"100%",padding:"10px",fontSize:16,borderRadius:8,border:"1px solid #ccc",marginTop:6}})]}),e.jsx("h2",{children:"Waiting for Opponent"}),e.jsxs("p",{children:["Duel ID: ",n]}),e.jsx("h3",{children:"Players Connected:"}),e.jsx("ul",{children:l.map(t=>e.jsx("li",{children:t},t))}),"countdown"===a&&e.jsx("h1",{style:{fontSize:48},children:o}),"waiting"===a&&e.jsx("p",{children:"Waiting for second player"})]})}function kl({duelId:t,playerId:n}){const{state:r,countdown:s,players:i,taps:a,result:o,sendTap:l}=xl(t,n);return"countdown"===r?e.jsx("div",{style:{padding:20,textAlign:"center"},children:e.jsx("h1",{style:{fontSize:48},children:s})}):"finished"===r&&o?e.jsxs("div",{style:{padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Duel Finished!"}),e.jsxs("h3",{children:["Winner: ",o.winner]}),e.jsxs("p",{children:["Your taps: ",a[n]||0]}),o.second&&e.jsxs("p",{children:["Opponent taps: ",a[o.second]||0]}),e.jsx("button",{onClick:()=>{const e=`https://t.me/tapduelbot?start=${"duel_"+Math.random().toString(36).slice(2,10)}`;window.Telegram?.WebApp?.openTelegramLink(e)},style:{marginTop:20,padding:"12px 24px",fontSize:18,borderRadius:8,cursor:"pointer"},children:"Challenge a Friend"})]}):e.jsxs("div",{style:{padding:20,textAlign:"center"},children:[e.jsx("h2",{children:"Duel Active!"}),e.jsxs("h3",{children:["Your taps: ",a[n]||0]}),e.jsx("h3",{children:"Opponent taps:"}),e.jsx("ul",{children:i.filter(e=>e!==n).map(t=>e.jsxs("li",{children:[t,": ",a[t]||0]},t))}),e.jsx("button",{onClick:l,style:{marginTop:40,padding:"20px 40px",fontSize:24,borderRadius:12,cursor:"pointer"},children:"TAP!"})]})}function jl(){const e=window.Telegram?.WebApp;return{tg:e,user:e?.initDataUnsafe?.user,init:()=>{e?.expand(),e?.disableVerticalSwipe(),e?.enableClosingConfirmation()}}}function El(){const e=kn();return jl(),t.useEffect(()=>{const t=Math.random().toString(36).slice(2,10);e(`/lobby/${t}`)},[e]),null}function Tl(){const n=Ir(),r=Nr().isDark,{tg:s,user:i,init:a}=jl(),o=Rt(),l=kn(),c=o.account?.address||null;t.useEffect(()=>{a()},[]);const u=i?.id?.toString()||"local_"+Math.random().toString(36).slice(2),d=c||u,h=s?.initDataUnsafe?.start_param;return t.useEffect(()=>{if(h&&h.startsWith("duel_")){const e=h.replace("duel_","");l(`/lobby/${e}`)}},[h,l]),e.jsxs(v,{appearance:r?"dark":"light",platform:["macos","ios"].includes(n.platform)?"ios":"base",children:[e.jsx("div",{style:{padding:12,display:"flex",justifyContent:"flex-end"},children:e.jsx(ws,{})}),e.jsx(Kn,{children:e.jsxs(Dn,{children:[_l.map(t=>e.jsx($n,{...t},t.path)),e.jsx($n,{path:"/lobby/:duelId",element:e.jsx(Sl,{playerId:d,walletAddress:c})}),e.jsx($n,{path:"/duel/:duelId",element:e.jsx(kl,{playerId:d,walletAddress:c})}),e.jsx($n,{path:"/lobby/new",element:e.jsx(El,{})}),e.jsx($n,{path:"*",element:e.jsx(Un,{to:"/"})})]})})]})}class Rl extends t.Component{state={};static getDerivedStateFromError=e=>({error:e});componentDidCatch(e){this.setState({error:e})}render(){const{state:{error:t},props:{fallback:n,children:r}}=this;return"error"in this.state?"function"==typeof n?e.jsx(n,{error:t}):n:r}}function Cl({error:t}){return e.jsxs("div",{children:[e.jsx("p",{children:"An unhandled error occurred:"}),e.jsx("blockquote",{children:e.jsx("code",{children:t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)})})]})}function Ol(){return e.jsx(Rl,{fallback:Cl,children:e.jsx(Tt,{children:e.jsx(Tl,{})})})}export{Ol as Root};
